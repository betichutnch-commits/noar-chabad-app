==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\dashboard\contact\page.tsx
==========================================
"use client"

import React, { useState } from 'react'
import { supabase } from '@/lib/supabaseClient'
import { Header } from '@/components/layout/Header'
import { Button } from '@/components/ui/Button'
import { Input } from '@/components/ui/Input'
import { Send, CheckCircle, HelpCircle, Image as ImageIcon, X, AlertTriangle, Info } from 'lucide-react'

export default function ContactPage() {
  const [loading, setLoading] = useState(false);
  const [success, setSuccess] = useState(false);
  
  // ׳¡׳•׳’ ׳”׳₪׳ ׳™׳™׳”: 'general' ׳׳• 'bug'
  const [type, setType] = useState<'general' | 'bug'>('general');
  const [screenshot, setScreenshot] = useState<File | null>(null);
  const [previewUrl, setPreviewUrl] = useState<string | null>(null);

  const [formData, setFormData] = useState({ subject: '', message: '' });

  // ׳˜׳™׳₪׳•׳ ׳‘׳”׳“׳‘׳§׳× ׳×׳׳•׳ ׳” (CTRL+V)
  const handlePaste = (e: React.ClipboardEvent) => {
    const items = e.clipboardData.items;
    for (let i = 0; i < items.length; i++) {
      if (items[i].type.indexOf('image') !== -1) {
        const blob = items[i].getAsFile();
        if (blob) {
            setScreenshot(blob);
            setPreviewUrl(URL.createObjectURL(blob));
        }
      }
    }
  };

  // ׳˜׳™׳₪׳•׳ ׳‘׳‘׳—׳™׳¨׳× ׳§׳•׳‘׳¥ ׳™׳“׳ ׳™׳×
  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
      if (e.target.files && e.target.files[0]) {
          const file = e.target.files[0];
          setScreenshot(file);
          setPreviewUrl(URL.createObjectURL(file));
      }
  };

  const removeImage = () => {
      setScreenshot(null);
      setPreviewUrl(null);
  };

  const handleSubmit = async () => {
    if (!formData.subject || !formData.message) return alert('׳ ׳ ׳׳׳׳ ׳ ׳•׳©׳ ׳•׳×׳•׳›׳. ׳׳ ׳–׳• ׳×׳§׳׳”, ׳׳ ׳ ׳₪׳¨׳˜ ׳׳” ׳ ׳™׳¡׳™׳× ׳׳¢׳©׳•׳×.');
    setLoading(true);

    const { data: { user } } = await supabase.auth.getUser();
    let imageUrl = null;

    // 1. ׳”׳¢׳׳׳× ׳¦׳™׳׳•׳ ׳׳¡׳ ׳׳ ׳™׳©
    if (screenshot && user) {
        const fileName = `bugs/${user.id}_${Date.now()}.png`;
        const { error: uploadError } = await supabase.storage.from('trip-files').upload(fileName, screenshot);
        if (!uploadError) {
            const { data } = supabase.storage.from('trip-files').getPublicUrl(fileName);
            imageUrl = data.publicUrl;
        }
    }
    
    // 2. ׳‘׳ ׳™׳™׳× ׳×׳•׳›׳ ׳”׳”׳•׳“׳¢׳” ׳”׳¡׳•׳₪׳™
    const finalMessage = imageUrl 
        ? `${formData.message}\n\n[׳¦׳•׳¨׳£ ׳¦׳™׳׳•׳ ׳׳¡׳]: ${imageUrl}`
        : formData.message;

    // 3. ׳©׳׳™׳¨׳” ׳‘׳“׳׳˜׳”׳‘׳™׳™׳¡
    const { error } = await supabase.from('contact_messages').insert([{
        user_id: user?.id,
        subject: `[${type === 'bug' ? '׳×׳§׳׳”' : '׳₪׳ ׳™׳™׳”'}] ${formData.subject}`,
        message: finalMessage,
        status: 'new'
    }]);

    setLoading(false);

    if (error) {
        alert('׳©׳’׳™׳׳” ׳‘׳©׳׳™׳—׳”: ' + error.message);
    } else {
        setSuccess(true);
        setFormData({ subject: '', message: '' });
        removeImage();
        setTimeout(() => setSuccess(false), 3000);
    }
  };

  return (
    <>
      <Header title="׳¦׳•׳¨ ׳§׳©׳¨ / ׳“׳™׳•׳•׳— ׳¢׳ ׳×׳§׳׳”" />

      <div className="max-w-3xl mx-auto p-8 animate-fadeIn pb-32">
         <div className="bg-white rounded-[32px] border border-gray-200 p-8 shadow-sm text-center md:text-right">
             
             {/* ׳‘׳—׳™׳¨׳× ׳¡׳•׳’ ׳₪׳ ׳™׳™׳” */}
             <div className="flex gap-4 mb-6">
                 <button 
                    onClick={() => setType('general')}
                    className={`flex-1 py-4 rounded-2xl border-2 flex flex-col items-center gap-2 transition-all font-bold
                    ${type === 'general' ? 'border-[#00BCD4] bg-cyan-50 text-[#00BCD4]' : 'border-gray-100 text-gray-400 hover:bg-gray-50'}`}
                 >
                     <HelpCircle size={28}/>
                     ׳©׳׳׳” ׳›׳׳׳™׳×
                 </button>
                 <button 
                    onClick={() => setType('bug')}
                    className={`flex-1 py-4 rounded-2xl border-2 flex flex-col items-center gap-2 transition-all font-bold
                    ${type === 'bug' ? 'border-[#E91E63] bg-pink-50 text-[#E91E63]' : 'border-gray-100 text-gray-400 hover:bg-gray-50'}`}
                 >
                     {/* ׳”׳—׳׳₪׳ ׳• ׳׳× ׳”׳¢׳›׳‘׳™׳© ׳‘׳׳©׳•׳׳© ׳׳–׳”׳¨׳” */}
                     <AlertTriangle size={28}/>
                     ׳“׳™׳•׳•׳— ׳¢׳ ׳×׳§׳׳”
                 </button>
             </div>

             <div className="space-y-6">
                 
                 {/* ׳×׳™׳‘׳× ׳”׳¡׳‘׳¨ ׳׳™׳•׳—׳“׳× ׳׳“׳™׳•׳•׳— ׳¢׳ ׳×׳§׳׳” */}
                 {type === 'bug' && (
                    <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-4 flex items-start gap-3 animate-fadeIn">
                        <Info size={22} className="text-yellow-600 shrink-0 mt-0.5"/>
                        <div>
                            <p className="text-sm font-bold text-yellow-800 mb-1">׳׳™׳ ׳׳“׳•׳•׳—׳™׳ ׳¢׳ ׳×׳§׳׳” ׳‘׳™׳¢׳™׳׳•׳×?</p>
                            <ul className="text-xs text-yellow-700 list-disc list-inside leading-relaxed space-y-1">
                                <li>׳—׳•׳‘׳” ׳׳¦׳¨׳£ <b>׳¦׳™׳׳•׳ ׳׳¡׳</b> ׳©׳ ׳”׳‘׳¢׳™׳”. ׳”׳“׳¨׳ ׳”׳›׳™ ׳§׳׳”: ׳¦׳׳׳• ׳׳× ׳”׳׳¡׳ (׳׳׳©׳ ׳¢׳ ׳”׳›׳׳™ `Snipping Tool` ׳‘׳•׳•׳™׳ ׳“׳•׳¡), ׳׳—׳¦׳• ׳›׳׳ ׳‘׳×׳•׳ ׳×׳™׳‘׳× ׳”׳˜׳§׳¡׳˜, ׳•׳”׳“׳‘׳™׳§׳• (Ctrl + V).</li>
                                <li>׳—׳•׳‘׳” ׳׳”׳•׳¡׳™׳£ <b>׳”׳¡׳‘׳¨ ׳׳™׳׳•׳׳™</b>: ׳׳” ׳ ׳™׳¡׳™׳×׳ ׳׳¢׳©׳•׳×? ׳¢׳ ׳׳” ׳׳—׳¦׳×׳ ׳׳₪׳ ׳™ ׳©׳§׳¨׳×׳” ׳”׳×׳§׳׳”?</li>
                            </ul>
                        </div>
                    </div>
                 )}

                 <Input 
                    label="׳ ׳•׳©׳" 
                    placeholder={type === 'bug' ? "׳‘׳§׳¦׳¨׳”: ׳׳” ׳”׳‘׳¢׳™׳”?" : "׳‘׳ ׳•׳©׳..."}
                    value={formData.subject}
                    onChange={e => setFormData({...formData, subject: e.target.value})}
                 />

                 <div>
                     <label className="text-xs font-bold text-gray-500 mb-1.5 mr-1 block">
                        {type === 'bug' ? '׳×׳™׳׳•׳¨ ׳”׳×׳§׳׳” ׳•׳”׳“׳‘׳§׳× ׳¦׳™׳׳•׳ ׳׳¡׳' : '׳×׳•׳›׳ ׳”׳”׳•׳“׳¢׳”'}
                     </label>
                     <div className="relative">
                        <textarea 
                            className="w-full p-4 rounded-xl border border-gray-200 outline-none focus:border-[#00BCD4] min-h-[150px] resize-none text-sm font-medium bg-gray-50 focus:bg-white transition-all"
                            placeholder={type === 'bug' ? "׳׳ ׳ ׳₪׳¨׳˜׳• ׳›׳׳ ׳׳× ׳”׳©׳׳‘׳™׳ ׳©׳’׳¨׳׳• ׳׳×׳§׳׳”...\n\n(׳ ׳™׳×׳ ׳׳”׳“׳‘׳™׳§ ׳›׳׳ ׳¦׳™׳׳•׳ ׳׳¡׳ ׳™׳©׳™׳¨׳•׳× ׳¢׳ CTRL+V)" : "׳×׳•׳›׳ ׳”׳₪׳ ׳™׳™׳”..."}
                            value={formData.message}
                            onChange={e => setFormData({...formData, message: e.target.value})}
                            onPaste={handlePaste} // ׳”׳׳–׳ ׳” ׳׳”׳“׳‘׳§׳”
                        ></textarea>
                        
                        {/* ׳›׳₪׳×׳•׳¨ ׳”׳¢׳׳׳” ׳™׳“׳ ׳™ */}
                        <label className="absolute bottom-3 left-3 text-gray-400 hover:text-[#00BCD4] cursor-pointer p-2 bg-white rounded-lg shadow-sm border border-gray-200 transition-all hover:scale-105" title="׳¦׳¨׳£ ׳§׳•׳‘׳¥ ׳×׳׳•׳ ׳”">
                            <ImageIcon size={20}/>
                            <input type="file" accept="image/*" className="hidden" onChange={handleFileChange}/>
                        </label>
                     </div>
                 </div>

                 {/* ׳×׳¦׳•׳’׳” ׳׳§׳“׳™׳׳” ׳©׳ ׳¦׳™׳׳•׳ ׳׳¡׳ */}
                 {previewUrl && (
                     <div className="bg-gray-50 p-3 rounded-xl border border-gray-200 relative w-fit animate-fadeIn">
                         <p className="text-xs font-bold text-gray-500 mb-2 flex items-center gap-1"><ImageIcon size={12}/> ׳¦׳™׳׳•׳ ׳׳¡׳ ׳׳¦׳•׳¨׳£:</p>
                         <img src={previewUrl} alt="Screenshot" className="max-h-48 rounded-lg border border-gray-200 shadow-sm"/>
                         <button onClick={removeImage} className="absolute -top-2 -left-2 bg-white text-red-500 rounded-full p-1 shadow-md hover:bg-red-50 border border-gray-200 transition-all hover:scale-110">
                             <X size={16}/>
                         </button>
                     </div>
                 )}

                 <div className="pt-4 flex items-center justify-end gap-4 border-t border-gray-100">
                     {success && (
                         <span className="text-[#8BC34A] font-bold text-sm flex items-center gap-2 animate-fadeIn">
                             <CheckCircle size={18}/> ׳ ׳©׳׳— ׳‘׳”׳¦׳׳—׳”!
                         </span>
                     )}
                     <Button 
                        onClick={handleSubmit} 
                        isLoading={loading}
                        className={`w-full md:w-auto px-12 shadow-lg ${type === 'bug' ? 'bg-[#E91E63] hover:bg-pink-600 shadow-pink-100' : 'bg-[#00BCD4] hover:bg-cyan-600 shadow-cyan-100'}`}
                        icon={<Send size={18}/>}
                     >
                         {type === 'bug' ? '׳©׳׳— ׳“׳™׳•׳•׳—' : '׳©׳׳— ׳”׳•׳“׳¢׳”'}
                     </Button>
                 </div>
             </div>
         </div>
      </div>
    </>
  )
}

==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\dashboard\inbox\page.tsx
==========================================
"use client"

import React, { useState, useEffect } from 'react'
import { supabase } from '@/lib/supabaseClient'
import { Header } from '@/components/layout/Header'
import { Button } from '@/components/ui/Button'
import { 
  Bell, CheckCircle, AlertTriangle, Info, X, Clock, MailOpen, Trash2 
} from 'lucide-react'

export default function InboxPage() {
  const [loading, setLoading] = useState(true);
  const [notifications, setNotifications] = useState<any[]>([]);

  // ׳˜׳¢׳™׳ ׳× ׳”׳•׳“׳¢׳•׳×
  const fetchNotifications = async () => {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) return;

    const { data } = await supabase
      .from('notifications')
      .select('*')
      .eq('user_id', user.id)
      .order('created_at', { ascending: false });
    
    setNotifications(data || []);
    setLoading(false);
  };

  useEffect(() => {
    fetchNotifications();
  }, []);

  // ׳¡׳™׳׳•׳ ׳›׳ ׳§׳¨׳
  const markAsRead = async (id: string) => {
      // ׳׳•׳₪׳˜׳™׳׳™׳¡׳˜׳™׳•׳× UI - ׳׳¢׳“׳›׳ ׳׳™׳“ ׳‘׳׳¡׳
      setNotifications(prev => prev.map(n => n.id === id ? { ...n, is_read: true } : n));
      
      // ׳¢׳“׳›׳•׳ ׳‘׳©׳¨׳×
      await supabase.from('notifications').update({ is_read: true }).eq('id', id);
  };

  // ׳׳—׳™׳§׳× ׳”׳•׳“׳¢׳”
  const deleteNotification = async (id: string, e: React.MouseEvent) => {
      e.stopPropagation(); // ׳©׳׳ ׳™׳₪׳×׳— ׳׳× ׳”׳”׳•׳“׳¢׳” ׳›׳©׳׳•׳—׳¦׳™׳ ׳¢׳ ׳׳—׳™׳§׳”
      setNotifications(prev => prev.filter(n => n.id !== id));
      await supabase.from('notifications').delete().eq('id', id);
  };

  // ׳׳™׳™׳§׳•׳ ׳׳₪׳™ ׳¡׳•׳’
  const getIcon = (type: string) => {
      switch (type) {
          case 'success': return <CheckCircle size={24} className="text-green-500" />;
          case 'warning': return <AlertTriangle size={24} className="text-orange-500" />;
          case 'error': return <X size={24} className="text-red-500" />;
          default: return <Info size={24} className="text-[#00BCD4]" />;
      }
  };

  return (
    <>
      <Header title="׳”׳•׳“׳¢׳•׳× ׳•׳¢׳“׳›׳•׳ ׳™׳" />

      <div className="max-w-5xl mx-auto p-8 animate-fadeIn pb-32">
        
        {/* ׳›׳•׳×׳¨׳× ׳׳©׳ ׳” ׳•׳¡׳˜׳˜׳™׳¡׳˜׳™׳§׳” */}
        <div className="flex items-center justify-between mb-6">
            <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                <Bell size={24} className="text-gray-400"/>
                ׳“׳•׳׳¨ ׳ ׳›׳ ׳¡
            </h2>
            <div className="text-sm font-bold text-gray-500 bg-white px-4 py-2 rounded-xl border border-gray-200 shadow-sm">
                {notifications.filter(n => !n.is_read).length} ׳”׳•׳“׳¢׳•׳× ׳—׳“׳©׳•׳×
            </div>
        </div>

        {/* ׳¨׳©׳™׳׳× ׳”׳”׳•׳“׳¢׳•׳× */}
        <div className="bg-white rounded-[32px] border border-gray-200 shadow-sm overflow-hidden min-h-[400px]">
            {notifications.length === 0 ? (
                <div className="flex flex-col items-center justify-center h-[400px] text-gray-400">
                    <MailOpen size={64} className="opacity-20 mb-4"/>
                    <p className="font-bold text-lg">׳׳™׳ ׳”׳•׳“׳¢׳•׳× ׳—׳“׳©׳•׳×</p>
                    <p className="text-sm">׳›׳©׳™׳”׳™׳• ׳¢׳“׳›׳•׳ ׳™׳ ׳¢׳ ׳˜׳™׳•׳׳™׳, ׳”׳ ׳™׳•׳₪׳™׳¢׳• ׳›׳׳.</p>
                </div>
            ) : (
                <div className="divide-y divide-gray-100">
                    {notifications.map((note) => (
                        <div 
                            key={note.id} 
                            onClick={() => markAsRead(note.id)}
                            className={`p-6 flex items-start gap-4 transition-all cursor-pointer hover:bg-gray-50
                            ${note.is_read ? 'opacity-60 bg-white' : 'bg-cyan-50/30'}`}
                        >
                            {/* ׳׳™׳™׳§׳•׳ */}
                            <div className={`mt-1 p-3 rounded-2xl shrink-0 ${note.is_read ? 'bg-gray-100 grayscale' : 'bg-white shadow-sm border border-gray-100'}`}>
                                {getIcon(note.type)}
                            </div>

                            {/* ׳×׳•׳›׳ */}
                            <div className="flex-1">
                                <div className="flex justify-between items-start mb-1">
                                    <h3 className={`text-base ${note.is_read ? 'font-medium text-gray-600' : 'font-black text-gray-800'}`}>
                                        {note.title}
                                    </h3>
                                    <span className="text-xs font-bold text-gray-400 flex items-center gap-1">
                                        <Clock size={12}/>
                                        {new Date(note.created_at).toLocaleDateString('he-IL')}
                                    </span>
                                </div>
                                <p className="text-sm text-gray-600 leading-relaxed max-w-2xl">
                                    {note.message}
                                </p>
                                {note.link && (
                                    <a href={note.link} className="text-xs font-bold text-[#00BCD4] mt-2 inline-block hover:underline">
                                        ׳׳—׳¥ ׳׳׳¢׳‘׳¨ ׳׳₪׳¨׳˜׳™׳
                                    </a>
                                )}
                            </div>

                            {/* ׳›׳₪׳×׳•׳¨ ׳׳—׳™׳§׳” */}
                            <button 
                                onClick={(e) => deleteNotification(note.id, e)}
                                className="p-2 text-gray-300 hover:text-red-500 hover:bg-red-50 rounded-xl transition-all"
                                title="׳׳—׳§ ׳”׳•׳“׳¢׳”"
                            >
                                <Trash2 size={18}/>
                            </button>
                        </div>
                    ))}
                </div>
            )}
        </div>
      </div>
    </>
  )
}

==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\dashboard\my-trips\page.tsx
==========================================
"use client"

import React, { useState, useEffect } from 'react'
import { supabase } from '@/lib/supabaseClient'
import { Header } from '@/components/layout/Header'
import { Button } from '@/components/ui/Button'
import { Input } from '@/components/ui/Input'
import { 
  Loader2, Search, MapPin, Calendar, CheckCircle, Clock, XCircle, ChevronLeft, FileText
} from 'lucide-react'

export default function MyTripsPage() {
  const [loading, setLoading] = useState(true);
  const [trips, setTrips] = useState<any[]>([]);
  const [searchTerm, setSearchTerm] = useState('');

  useEffect(() => {
    const fetchTrips = async () => {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;

      const { data } = await supabase
        .from('trips')
        .select('*')
        .eq('user_id', user.id)
        .order('created_at', { ascending: false });
      
      setTrips(data || []);
      setLoading(false);
    };
    fetchTrips();
  }, []);

  const getStatusBadge = (status: string) => {
      const styles: any = {
          approved: "bg-green-50 text-green-700 border-green-200",
          pending: "bg-orange-50 text-orange-700 border-orange-200",
          rejected: "bg-red-50 text-red-700 border-red-200"
      };
      const labels: any = { approved: '׳׳•׳©׳¨', pending: '׳‘׳‘׳“׳™׳§׳”', rejected: '׳׳ ׳׳•׳©׳¨' };
      const icons: any = { approved: <CheckCircle size={14}/>, pending: <Clock size={14}/>, rejected: <XCircle size={14}/> };

      return (
          <span className={`px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1.5 border w-fit ${styles[status] || styles.pending}`}>
              {icons[status] || icons.pending} {labels[status] || '׳‘׳‘׳“׳™׳§׳”'}
          </span>
      );
  };

  const filteredTrips = trips.filter(t => t.name.includes(searchTerm) || t.branch?.includes(searchTerm));

  if (loading) return <div className="h-screen flex items-center justify-center"><Loader2 className="animate-spin text-[#00BCD4]" size={40}/></div>;

  return (
    <>
      <Header title="׳”׳˜׳™׳•׳׳™׳ ׳©׳׳™" />

      <div className="max-w-6xl mx-auto p-8 space-y-6 animate-fadeIn pb-32">
        
        {/* ׳¡׳¨׳’׳ ׳›׳׳™׳ */}
        <div className="flex flex-col md:flex-row justify-between items-center gap-4 bg-white p-4 rounded-[24px] border border-gray-200 shadow-sm">
            <div className="relative w-full md:w-96">
                <Input 
                    placeholder="׳—׳™׳₪׳•׳© ׳׳₪׳™ ׳©׳ ׳˜׳™׳•׳..." 
                    value={searchTerm} 
                    onChange={e => setSearchTerm(e.target.value)}
                    icon={<Search size={20}/>}
                    className="bg-gray-50 border-transparent focus:bg-white"
                />
            </div>
            <div className="text-gray-500 text-sm font-bold">
                ׳¡׳”"׳› {filteredTrips.length} ׳˜׳™׳•׳׳™׳
            </div>
        </div>

        {/* ׳˜׳‘׳׳” */}
        <div className="bg-white rounded-[32px] border border-gray-200 overflow-hidden shadow-sm">
            {filteredTrips.length === 0 ? (
                <div className="p-16 text-center text-gray-400">
                    <FileText size={48} className="mx-auto mb-4 opacity-20"/>
                    <p className="font-bold text-lg">׳׳ ׳ ׳׳¦׳׳• ׳˜׳™׳•׳׳™׳</p>
                </div>
            ) : (
                <div className="overflow-x-auto">
                    <table className="w-full text-right">
                        <thead className="bg-gray-50 border-b border-gray-100 text-gray-500 text-xs font-bold uppercase">
                            <tr>
                                <th className="p-6">׳©׳ ׳”׳₪׳¢׳™׳׳•׳×</th>
                                <th className="p-6">׳×׳׳¨׳™׳›׳™׳</th>
                                <th className="p-6">׳׳™׳§׳•׳</th>
                                <th className="p-6">׳¡׳˜׳˜׳•׳¡</th>
                                <th className="p-6 text-left">׳₪׳¢׳•׳׳•׳×</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-gray-50">
                            {filteredTrips.map((trip) => (
                                <tr key={trip.id} className="hover:bg-cyan-50/30 transition-colors group">
                                    <td className="p-6 font-bold text-gray-800 text-base">{trip.name}</td>
                                    <td className="p-6">
                                        <div className="flex items-center gap-2 text-sm text-gray-600">
                                            <Calendar size={16} className="text-[#00BCD4]"/>
                                            {new Date(trip.start_date).toLocaleDateString('he-IL')}
                                        </div>
                                    </td>
                                    <td className="p-6">
                                        <div className="flex items-center gap-2 text-sm text-gray-600">
                                            <MapPin size={16} className="text-[#E91E63]"/>
                                            {trip.details?.timeline?.[0]?.finalLocation || '-'}
                                        </div>
                                    </td>
                                    <td className="p-6">{getStatusBadge(trip.status)}</td>
                                    <td className="p-6 text-left">
                                        <button className="text-[#00BCD4] hover:bg-cyan-50 p-2 rounded-xl transition-all">
                                            <ChevronLeft size={20}/>
                                        </button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            )}
        </div>
      </div>
    </>
  )
}

==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\dashboard\new-trip\page.tsx
==========================================
"use client"

import React, { useState, useEffect, useRef } from 'react'
import { supabase } from '@/lib/supabaseClient'
import { Button } from '@/components/ui/Button'
import { Input } from '@/components/ui/Input'
import { Header } from '@/components/layout/Header'
import { 
  Calendar, MapPin, Bus, Tent, Utensils, Ticket, 
  AlertTriangle, Save, CheckCircle, FileUp, 
  Flag, ChevronDown, ChevronUp, Lock, Unlock, HelpCircle, 
  Check, Trash2, Loader2, Link as LinkIcon,
  Home, Navigation, MessageSquare, X 
} from 'lucide-react'

// --- ׳§׳‘׳•׳¢׳™׳ ׳•׳¨׳©׳™׳׳•׳× ---
const ISRAEL_CITIES = ["׳™׳¨׳•׳©׳׳™׳", "׳×׳ ׳׳‘׳™׳‘", "׳—׳™׳₪׳”", "׳¨׳—׳•׳‘׳•׳×", "׳›׳₪׳¨ ׳—׳‘׳´׳“", "׳¦׳₪׳×", "׳׳™׳׳×", "׳˜׳‘׳¨׳™׳”", "׳ ׳×׳ ׳™׳”", "׳׳©׳“׳•׳“", "׳‘׳׳¨ ׳©׳‘׳¢", "׳׳•׳“", "׳§׳¨׳™׳™׳× ׳׳׳׳›׳™", "׳ ׳—׳׳× ׳”׳¨ ׳—׳‘׳´׳“", "׳ ׳•׳£ ׳”׳’׳׳™׳"].sort();
const GRADES = ['׳׳³', '׳‘׳³', '׳’׳³', '׳“׳³', '׳”׳³', '׳•׳³', '׳–׳³', '׳—׳³', '׳˜׳³', '׳™׳³', '׳™׳´׳', '׳™׳´׳‘'];
const STAFF_AGES = ['׳’׳™׳ 13-18 (׳׳“"׳¦׳™׳)', '׳׳¢׳ ׳’׳™׳ 18', '׳”׳•׳¨׳™׳ ׳׳׳•׳•׳™׳', '׳׳—׳¨'];

const TRIP_TYPES = [
    "׳˜׳™׳•׳ ׳׳—׳•׳¥ ׳׳¡׳ ׳™׳£", 
    "׳›׳ ׳¡/׳׳™׳¨׳•׳¢ ׳׳—׳•׳¥ ׳׳¡׳ ׳™׳£", 
    "׳₪׳¢׳™׳׳•׳× ׳׳ ׳©׳’׳¨׳×׳™׳× ׳‘׳¡׳ ׳™׳£", 
    "׳™׳¦׳™׳׳” ׳¨׳’׳׳™׳× ׳‘׳׳–׳•׳¨ ׳”׳¡׳ ׳™׳£", 
    "׳׳—׳¨"
];

const CATEGORIES: any = { 
  transport: { 
    label: '׳”׳×׳ ׳™׳™׳“׳•׳×', icon: Bus, color: 'blue', 
    options: [
      { label: '׳”׳׳™׳›׳” ׳‘׳™׳•׳', license: false }, { label: '׳”׳׳™׳›׳” ׳‘׳׳™׳׳”', license: false }, 
      { label: '׳ ׳¡׳™׳¢׳” ׳׳׳•׳¨׳’׳ ׳×', license: false }, { label: '׳×׳—׳‘׳•׳¨׳” ׳¦׳™׳‘׳•׳¨׳™׳×', license: false }, 
      { label: '׳¨׳›׳‘׳×', license: false }, { label: '׳¨׳›׳‘׳™׳ ׳₪׳¨׳˜׳™׳™׳', license: false }, 
      { label: '׳׳•׳₪׳ ׳™׳™׳', license: true }, { label: '׳’׳³׳™׳₪׳™׳', license: true }, { label: '׳׳—׳¨', license: false }
    ] 
  }, 
  hiking: { 
    label: '׳׳¡׳׳•׳ ׳‘׳˜׳‘׳¢', icon: Navigation, color: 'emerald', 
    options: [
      { label: '׳׳¡׳׳•׳ ׳™׳•׳', license: false }, { label: '׳׳¡׳׳•׳ ׳׳™׳׳”', license: false }, 
      { label: '׳˜׳™׳•׳ ׳’׳³׳™׳₪׳™׳', license: true }, { label: '׳׳—׳¨', license: false }
    ] 
  }, 
  attraction: { 
    label: '׳׳˜׳¨׳§׳¦׳™׳”', icon: Ticket, color: 'pink', 
    options: [
      { label: '׳₪׳׳¨׳§ ׳׳™׳', license: true }, { label: '׳§׳™׳׳§׳™׳/׳¨׳₪׳˜׳™׳ ׳’', license: true }, 
      { label: '׳©׳™׳™׳˜', license: true }, { label: '׳‘׳¨׳™׳›׳”', license: true }, 
      { label: '׳’׳׳™׳©׳”/׳¡׳׳₪', license: true }, { label: '׳₪׳׳¨׳§ ׳—׳‘׳׳™׳', license: true }, 
      { label: '׳§׳™׳¨ ׳˜׳™׳₪׳•׳¡', license: true }, { label: '׳˜׳¨׳§׳˜׳•׳¨׳•׳ ׳™׳', license: true }, 
      { label: '׳₪׳™׳™׳ ׳˜׳‘׳•׳', license: true }, { label: '׳׳•׳ ׳” ׳₪׳׳¨׳§', license: true }, 
      { label: '׳§׳׳¨׳˜׳™׳ ׳’', license: true }, { label: '׳׳×׳§׳ ׳™׳ ׳׳×׳ ׳₪׳—׳™׳', license: true }, 
      { label: '׳׳™׳™ ׳’\'׳׳׳₪', license: true }, { label: '׳׳™׳™׳–׳¨ ׳˜׳׳’', license: true }, 
      { label: '׳©׳™׳™׳˜ ׳˜׳•׳¨׳ ׳“׳•', license: true },
      { label: '׳׳•׳–׳™׳׳•׳', license: false }, { label: '׳׳¨׳›׳– ׳׳‘׳§׳¨׳™׳', license: false }, 
      { label: '׳׳×׳¨ ׳׳•׳¨׳©׳×', license: false }, { label: '׳§׳‘׳¨ ׳¦׳“׳™׳§', license: false }, { label: '׳׳—׳¨', license: false }
    ] 
  }, 
  food: { 
    label: '׳׳•׳›׳', icon: Utensils, color: 'yellow', 
    options: [
      { label: '׳”׳›׳ ׳” ׳¢׳¦׳׳™׳×', license: false }, { label: '׳׳•׳›׳ ׳§׳ ׳•׳™', license: false }, 
      { label: '׳׳׳¨׳–׳™׳ ׳¡׳’׳•׳¨׳™׳ ׳§׳ ׳•׳™׳™׳', license: false }, { label: '׳׳•׳›׳ ׳‘׳™׳×׳™ ׳׳‘׳•׳©׳', license: false },
      { label: '׳§׳™׳™׳˜׳¨׳™׳ ׳’', license: false }, { label: '׳¢׳ ׳”׳׳©', license: false }, { label: '׳׳—׳¨', license: false }
    ] 
  }, 
  settlement: { 
    label: '׳₪׳¢׳™׳׳•׳× ׳‘׳™׳™׳©׳•׳‘/׳׳‘׳ ׳”', icon: Home, color: 'indigo', 
    options: [
      { label: '׳₪׳¢׳™׳׳•׳× ׳‘׳¡׳ ׳™׳£', license: false },
      { label: '׳׳™׳¨׳•׳¢ ׳‘׳׳•׳׳', license: false }, 
      { label: '׳₪׳¢׳™׳׳•׳× ׳‘׳‘׳™׳× ׳›׳ ׳¡׳×', license: false }, 
      { label: '׳₪׳¢׳™׳׳•׳× ׳‘׳‘׳™׳× ׳—׳‘׳´׳“', license: false }, 
      { label: '׳₪׳¢׳™׳׳•׳× ׳‘׳׳×׳ ׳´׳¡', license: false }, 
      { label: '׳₪׳¢׳™׳׳•׳× ׳‘׳‘׳™׳× ׳₪׳¨׳˜׳™', license: false }, 
      { label: '׳₪׳¢׳™׳׳•׳× ׳‘׳©׳˜׳— ׳₪׳×׳•׳—', license: false }, 
      { label: '׳₪׳¢׳™׳׳•׳× ׳‘׳©׳˜׳— ׳׳’׳•׳“׳¨ ׳×׳—׳× ׳›׳™׳₪׳× ׳”׳©׳׳™׳™׳', license: false },
      { label: '׳₪׳׳¨׳§/׳’׳™׳ ׳”', license: false }, { label: '׳›׳ ׳¡', license: false }, { label: '׳׳—׳¨', license: false }
    ] 
  },
  sleeping: { 
    label: '׳׳™׳ ׳”', icon: Tent, color: 'purple', 
    options: [
      { label: '׳׳™׳ ׳× ׳׳‘׳ ׳”', license: false }, { label: '׳׳™׳ ׳× ׳©׳˜׳—', license: true }, { label: '׳׳—׳¨', license: false }
    ] 
  }, 
  other: { 
    label: '׳׳—׳¨', icon: HelpCircle, color: 'gray', 
    options: [
      { label: '׳₪׳¢׳™׳׳•׳× ׳›׳׳׳™׳×', license: false }, { label: '׳˜׳§׳¡ / ׳”׳×׳›׳ ׳¡׳•׳×', license: false }, 
      { label: '׳–׳׳ ׳—׳•׳₪׳©׳™', license: false }, { label: '׳׳—׳¨', license: false }
    ] 
  } 
};

// ׳₪׳•׳ ׳§׳¦׳™׳™׳× ׳¢׳–׳¨ ׳׳¦׳‘׳¢׳™׳
const getColorHex = (colorName: string) => {
  const map: any = {
    blue: '#00BCD4', emerald: '#8BC34A', pink: '#E91E63', yellow: '#FFC107',
    indigo: '#3F51B5', purple: '#9C27B0', gray: '#9E9E9E', cyan: '#00BCD4', green: '#8BC34A'
  };
  return map[colorName] || '#00BCD4';
};

export default function NewTripPage() {
  const [user, setUser] = useState<any>(null);
  const [loading, setLoading] = useState(false);
  
  // --- ׳ ׳™׳”׳•׳ ׳׳•׳“׳ ׳׳×׳§׳“׳ (׳›׳•׳׳ Confirm) ---
  const [modalState, setModalState] = useState<{
      show: boolean;
      message: string;
      type: 'error' | 'success' | 'confirm';
      onConfirm?: () => void; // ׳₪׳•׳ ׳§׳¦׳™׳” ׳©׳×׳¨׳•׳¥ ׳׳ ׳”׳׳©׳×׳׳© ׳™׳׳—׳¥ "׳›׳"
  }>({ show: false, message: '', type: 'error' });
  
  const showModal = (type: 'error' | 'success' | 'confirm', msg: string, onConfirm?: () => void) => {
      setModalState({ show: true, message: msg, type, onConfirm });
  };

  const handleModalClose = () => {
      setModalState(prev => ({ ...prev, show: false }));
      if (modalState.type === 'success') {
          window.location.href = '/dashboard';
      }
  };

  const handleModalConfirm = () => {
      if (modalState.onConfirm) {
          modalState.onConfirm();
      }
      setModalState(prev => ({ ...prev, show: false }));
  };

  // ׳׳©׳×׳ ׳™׳
  const [uploadingFileId, setUploadingFileId] = useState<string | null>(null); 
  const [isUploadingLicense, setIsUploadingLicense] = useState(false);
  const [isUploadingInsurance, setIsUploadingInsurance] = useState(false);
  
  const [expandedItem, setExpandedItem] = useState<string | null>(null);
  const [isRowsLocked, setIsRowsLocked] = useState(false);
  const [showDateToast, setShowDateToast] = useState(false);
  
  // ׳׳©׳×׳ ׳™׳ ׳׳×׳₪׳¨׳™׳˜׳™׳
  const [showLocationSuggestions, setShowLocationSuggestions] = useState(false);
  const [showCategoryDropdown, setShowCategoryDropdown] = useState(false);
  const [showSubCategoryDropdown, setShowSubCategoryDropdown] = useState(false);

  // Refs for Inputs
  const startDateRef = useRef<HTMLInputElement>(null);
  const startTimeRef = useRef<HTMLInputElement>(null);
  const endDateRef = useRef<HTMLInputElement>(null);
  const endTimeRef = useRef<HTMLInputElement>(null);

  const [generalInfo, setGeneralInfo] = useState({ 
      name: '', 
      tripType: '', 
      tripTypeOther: '',
      startDate: '', 
      startTime: '08:00', 
      endDate: '', 
      endTime: '18:00', 
      gradeFrom: '׳', 
      gradeTo: '׳—', 
      chanichimCount: '', 
      totalTravelers: '', 
      staffAges: [] as string[], 
      staffOther: '', 
      generalComments: '' 
  });

  const [timeline, setTimeline] = useState<any[]>([]);
  
  const [currentLine, setCurrentLine] = useState({ 
    date: '', locationType: 'custom', locationValue: '', category: '', subCategory: '', 
    otherDetail: '', details: '', 
    licenseFile: null as {url: string, name: string} | null,
    insuranceFile: null as {url: string, name: string} | null
  });

  const [startHebrewDate, setStartHebrewDate] = useState('');
  const [endHebrewDate, setEndHebrewDate] = useState('');
  const [isUrgentError, setIsUrgentError] = useState(false);

  const getHebrewDateString = (dateString: string) => {
      if (!dateString) return '';
      try {
          const date = new Date(dateString);
          const weekday = new Intl.DateTimeFormat('he-IL', { weekday: 'long' }).format(date);
          const days = ["", "׳׳³", "׳‘׳³", "׳’׳³", "׳“׳³", "׳”׳³", "׳•׳³", "׳–׳³", "׳—׳³", "׳˜׳³", "׳™׳³", "׳™׳´׳", "׳™׳´׳‘", "׳™׳´׳’", "׳™׳´׳“", "׳˜׳´׳•", "׳˜׳´׳–", "׳™׳´׳–", "׳™׳´׳—", "׳™׳´׳˜", "׳›׳³", "׳›׳´׳", "׳›׳´׳‘", "׳›׳´׳’", "׳›׳´׳“", "׳›׳´׳”", "׳›׳´׳•", "׳›׳´׳–", "׳›׳´׳—", "׳›׳´׳˜", "׳׳³", "׳׳´׳"];
          const options: any = { calendar: 'hebrew', day: 'numeric', month: 'long', year: 'numeric' };
          const parts = new Intl.DateTimeFormat('he-IL', options).formatToParts(date);
          let hDay = '', hMonth = '', hYear = '';
          parts.forEach(p => {
              if (p.type === 'day') {
                  const num = parseInt(p.value);
                  hDay = !isNaN(num) && days[num] ? days[num] : p.value;
              }
              if (p.type === 'month') hMonth = p.value;
              if (p.type === 'year') {
                  const years: any = { '5785': '׳×׳©׳₪׳´׳”', '5786': '׳×׳©׳₪׳´׳•', '5787': '׳×׳©׳₪׳´׳–' };
                  hYear = years[p.value] || p.value;
              }
          });
          return `${weekday}, ${hDay} ׳‘${hMonth} ${hYear}`;
      } catch (e) { return ''; }
  };

  useEffect(() => {
    const checkUser = async () => {
        const { data } = await supabase.auth.getUser();
        if (data?.user) setUser(data.user);
        else window.location.href = '/';
    };
    checkUser();
  }, []);

  useEffect(() => { 
    setStartHebrewDate(getHebrewDateString(generalInfo.startDate));
    setEndHebrewDate(getHebrewDateString(generalInfo.endDate));

    if (generalInfo.startDate && !currentLine.date) {
        setCurrentLine(prev => ({ ...prev, date: generalInfo.startDate }));
    }

    if (generalInfo.startDate) {
        const dateObj = new Date(generalInfo.startDate);
        const now = new Date();
        const diffTime = dateObj.getTime() - now.getTime();
        const diffHours = diffTime / (1000 * 3600);

        if (diffHours < 48 && diffTime > -86400000) {
            setIsUrgentError(true);
        } else {
            setIsUrgentError(false);
        }
    } else {
        setIsUrgentError(false);
    }
  }, [generalInfo.startDate, generalInfo.endDate]);

  const getNextDate = (d: string) => { if(!d) return ''; const x=new Date(d); x.setDate(x.getDate()+1); return x.toISOString().split('T')[0]; };
  const toggleStaffAge = (age: string) => setGeneralInfo(prev => ({ ...prev, staffAges: prev.staffAges.includes(age) ? prev.staffAges.filter(a => a !== age) : [...prev.staffAges, age] }));
  const isLicenseRequired = (cat: string, sub: string) => CATEGORIES[cat]?.options.find((o: any) => o.label === sub)?.license || false;

  const handleAddLine = () => {
    if (!currentLine.category) return showModal('error', '׳ ׳ ׳׳‘׳—׳•׳¨ ׳§׳˜׳’׳•׳¨׳™׳”');
    if (!currentLine.subCategory) return showModal('error', '׳ ׳ ׳׳‘׳—׳•׳¨ ׳₪׳¢׳™׳׳•׳×');
    if (currentLine.locationType !== 'branch' && !currentLine.locationValue) return showModal('error', '׳ ׳ ׳׳”׳–׳™׳ ׳׳™׳§׳•׳');
    if (currentLine.subCategory === '׳׳—׳¨' && !currentLine.otherDetail) return showModal('error', '׳ ׳ ׳׳₪׳¨׳˜ ׳‘׳©׳“׳” "׳׳—׳¨"');
    if (currentLine.subCategory === '׳׳™׳ ׳× ׳׳‘׳ ׳”' && !currentLine.otherDetail) return showModal('error', '׳—׳•׳‘׳” ׳׳”׳–׳™׳ ׳›׳×׳•׳‘׳×/׳©׳ ׳׳§׳•׳ ׳׳׳™׳ ׳”');

    const needsLicense = isLicenseRequired(currentLine.category, currentLine.subCategory);
    
    const newLine = {
      id: Math.random().toString(36).substr(2, 9),
      ...currentLine,
      finalLocation: currentLine.locationType === 'branch' ? '׳‘׳¡׳ ׳™׳£ ׳”׳§׳‘׳•׳¢' : currentLine.locationValue,
      finalSubCategory: currentLine.subCategory === '׳׳—׳¨' ? currentLine.otherDetail : currentLine.subCategory,
      requiresLicense: needsLicense,
      licenseFile: currentLine.licenseFile,
      insuranceFile: currentLine.insuranceFile
    };
    
    setTimeline([...timeline, newLine]);
    setExpandedItem(null);

    let nextDate = currentLine.date;
    if (currentLine.category === 'sleeping') { 
        nextDate = getNextDate(currentLine.date); 
        setShowDateToast(true); 
        setTimeout(() => setShowDateToast(false), 3000); 
    }
    
    setCurrentLine({ 
        date: nextDate, locationType: 'custom', locationValue: '', category: '', subCategory: '', 
        otherDetail: '', details: '', licenseFile: null, insuranceFile: null
    });
  };

  const handleRemoveLine = (id: string, e: React.MouseEvent) => { e.stopPropagation(); setTimeline(timeline.filter(item => item.id !== id)); };

  const handleUpload = async (file: File, type: 'license' | 'insurance', itemId?: string) => {
    if(!file) return;
    
    if (itemId) {
        setUploadingFileId(`${itemId}_${type}`);
    } else {
        if(type === 'license') setIsUploadingLicense(true);
        else setIsUploadingInsurance(true);
    }

    try {
        const fileExt = file.name.split('.').pop();
        const storageName = `${user.id}/${Date.now()}_${type}_${Math.random().toString(36).substring(7)}.${fileExt}`;
        const { error } = await supabase.storage.from('trip-files').upload(storageName, file);
        if (error) throw error;
        const { data: { publicUrl } } = supabase.storage.from('trip-files').getPublicUrl(storageName);
        
        const fileObj = { url: publicUrl, name: file.name };
        
        if (itemId) {
            setTimeline(prev => prev.map(item => item.id === itemId ? { ...item, [type === 'license' ? 'licenseFile' : 'insuranceFile']: fileObj } : item));
        } else {
            setCurrentLine(prev => ({ ...prev, [type === 'license' ? 'licenseFile' : 'insuranceFile']: fileObj }));
        }
    } catch (e: any) { 
        showModal('error', '׳©׳’׳™׳׳” ׳‘׳”׳¢׳׳׳”: ' + e.message); 
    } finally { 
        if (itemId) {
            setUploadingFileId(null); 
        } else { 
            if(type === 'license') setIsUploadingLicense(false); 
            else setIsUploadingInsurance(false); 
        } 
    }
  };

  const handleCurrentLineDualUpload = async (event: any, type: 'license' | 'insurance') => {
    const file = event.target.files[0];
    if (!file) return;

    event.target.value = ''; // ׳׳™׳₪׳•׳¡ ׳”׳§׳•׳‘׳¥
    const setUploadingState = type === 'license' ? setIsUploadingLicense : setIsUploadingInsurance;
    setUploadingState(true);

    try {
        const fileExt = file.name.split('.').pop();
        const storageName = `${user.id}/${Date.now()}_${type}_${Math.random().toString(36).substring(7)}.${fileExt}`;
        const { error: uploadError } = await supabase.storage.from('trip-files').upload(storageName, file);
        if (uploadError) throw uploadError;
        const { data: { publicUrl } } = supabase.storage.from('trip-files').getPublicUrl(storageName);
        
        setCurrentLine(prev => ({ ...prev, [type === 'license' ? 'licenseFile' : 'insuranceFile']: { url: publicUrl, name: file.name } }));
    } catch (error: any) { showModal('error', '׳©׳’׳™׳׳” ׳‘׳”׳¢׳׳׳”: ' + error.message); } 
    finally { setUploadingState(false); }
  };

  const handleExistingLineDualUpload = async (event: any, itemId: string, type: 'license' | 'insurance') => {
    const file = event.target.files[0];
    if (!file) return;
    event.target.value = '';
    setUploadingFileId(`${itemId}_${type}`);

    try {
        const fileExt = file.name.split('.').pop();
        const storageName = `${user.id}/${Date.now()}_${type}_${Math.random().toString(36).substring(7)}.${fileExt}`;
        const { error: uploadError } = await supabase.storage.from('trip-files').upload(storageName, file);
        if (uploadError) throw uploadError;
        const { data: { publicUrl } } = supabase.storage.from('trip-files').getPublicUrl(storageName);
        
        setTimeline(prevTimeline => prevTimeline.map(item => {
            if (item.id === itemId) return { ...item, [type === 'license' ? 'licenseFile' : 'insuranceFile']: { url: publicUrl, name: file.name } };
            return item;
        }));
    } catch (error: any) { showModal('error', '׳©׳’׳™׳׳” ׳‘׳”׳¢׳׳׳”: ' + error.message); } 
    finally { setUploadingFileId(null); }
  };

  const handleLockToggle = () => {
      if (!isRowsLocked) {
          if (generalInfo.tripType !== "׳₪׳¢׳™׳׳•׳× ׳׳ ׳©׳’׳¨׳×׳™׳× ׳‘׳¡׳ ׳™׳£" && timeline.length < 2) {
              return showModal('error', '׳׳ ׳ ׳™׳×׳ ׳׳¡׳™׳™׳ ׳”׳•׳¡׳₪׳× ׳©׳•׳¨׳•׳×. ׳‘׳¡׳•׳’ ׳₪׳¢׳™׳׳•׳× ׳–׳” ׳ ׳“׳¨׳©׳•׳× ׳׳₪׳—׳•׳× 2 ׳©׳•׳¨׳•׳× ׳‘׳׳•"׳–.');
          }
      }
      setIsRowsLocked(!isRowsLocked);
  };

  const executeSubmission = async () => {
    setLoading(true);
    try {
        const { error } = await supabase.from('trips').insert([{
            user_id: user.id, coordinator_name: user.user_metadata.full_name, branch: user.user_metadata.branch, department: user.user_metadata.department,
            name: generalInfo.name, start_date: generalInfo.startDate, status: 'pending', details: { ...generalInfo, timeline }
        }]);
        if (error) throw error;
        showModal('success', '׳”׳˜׳™׳•׳ ׳ ׳©׳׳— ׳‘׳”׳¦׳׳—׳”! ׳×׳•׳ 48 ׳©׳¢׳•׳× ׳×׳×׳§׳‘׳ ׳×׳©׳•׳‘׳”.');
    } catch(e: any) { showModal('error', '׳©׳’׳™׳׳”: ' + e.message); } 
    finally { setLoading(false); }
  };

  const handleSubmit = async () => {
    if (isUrgentError) return;
    if (!generalInfo.tripType || !generalInfo.name || !generalInfo.startDate || !generalInfo.endDate || !generalInfo.chanichimCount || !generalInfo.totalTravelers) return showModal('error', '׳ ׳ ׳׳׳׳ ׳׳× ׳›׳ ׳©׳“׳•׳× ׳”׳—׳•׳‘׳” ׳‘׳₪׳¨׳˜׳™׳ ׳”׳›׳׳׳™׳™׳');
    if (timeline.length === 0) return showModal('error', '׳™׳© ׳׳”׳•׳¡׳™׳£ ׳׳₪׳—׳•׳× ׳©׳•׳¨׳” ׳׳—׳× ׳‘׳₪׳™׳¨׳•׳˜ ׳”׳˜׳™׳•׳');
    if (generalInfo.tripType !== "׳₪׳¢׳™׳׳•׳× ׳׳ ׳©׳’׳¨׳×׳™׳× ׳‘׳¡׳ ׳™׳£" && timeline.length < 2) return showModal('error', '׳ ׳“׳¨׳©׳•׳× ׳׳₪׳—׳•׳× 2 ׳©׳•׳¨׳•׳× ׳‘׳׳•"׳–.');
    if (timeline.some(item => item.requiresLicense && (!item.licenseFile || !item.insuranceFile))) {
        showModal('confirm', '׳™׳© ׳₪׳¢׳™׳׳•׳™׳•׳× ׳”׳“׳•׳¨׳©׳•׳× ׳׳™׳©׳•׳¨׳™׳ ׳©׳—׳¡׳¨׳™׳ ׳׳”׳ ׳׳¡׳׳›׳™׳. ׳׳©׳׳•׳— ׳‘׳›׳ ׳–׳׳×?', executeSubmission);
        return;
    }
    executeSubmission();
  };

  const currentLineNeedsLicense = isLicenseRequired(currentLine.category, currentLine.subCategory);

  return (
    <>
      <Header title="׳”׳’׳©׳× ׳˜׳™׳•׳ ׳—׳“׳©" />

      {/* ׳׳•׳“׳׳™׳ */}
      {modalState.show && (
          <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fadeIn p-4">
              <div className={`bg-white p-6 rounded-2xl shadow-2xl max-w-sm w-full text-center border-t-4 ${
                  modalState.type === 'success' ? 'border-[#8BC34A]' : 
                  modalState.type === 'confirm' ? 'border-[#FFC107]' : 'border-[#E91E63]'
              }`}>
                  <div className={`w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 ${
                      modalState.type === 'success' ? 'bg-green-50 text-[#8BC34A]' : 
                      modalState.type === 'confirm' ? 'bg-yellow-50 text-[#FFC107]' : 'bg-red-50 text-[#E91E63]'
                  }`}>
                      {modalState.type === 'success' ? <CheckCircle size={32} /> : 
                       modalState.type === 'confirm' ? <HelpCircle size={32} /> : <AlertTriangle size={32} />}
                  </div>
                  <h3 className="font-black text-xl mb-2 text-gray-800">{modalState.type === 'success' ? '׳׳™׳–׳” ׳™׳•׳₪׳™!' : modalState.type === 'confirm' ? '׳¨׳’׳¢ ׳׳—׳“...' : '׳©׳™׳ ׳׳‘'}</h3>
                  <p className="text-gray-600 mb-6 text-sm font-medium leading-relaxed whitespace-pre-line">{modalState.message}</p>
                  <div className="flex gap-3">
                      {modalState.type === 'confirm' ? (
                          <>
                              <button onClick={handleModalClose} className="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-3 rounded-xl font-bold transition-colors">׳׳, ׳׳ ׳™ ׳¨׳•׳¦׳” ׳׳×׳§׳</button>
                              <button onClick={handleModalConfirm} className="flex-1 bg-[#FFC107] hover:bg-yellow-500 text-white px-4 py-3 rounded-xl font-bold transition-colors shadow-lg shadow-yellow-100">׳›׳, ׳©׳׳— ׳‘׳›׳ ׳–׳׳×</button>
                          </>
                      ) : (
                          <button onClick={handleModalClose} className={`text-white px-6 py-3 rounded-xl font-bold w-full transition-colors ${modalState.type === 'success' ? 'bg-[#8BC34A] hover:bg-[#7CB342]' : 'bg-[#E91E63] hover:bg-pink-600'}`}>{modalState.type === 'success' ? '׳׳¢׳•׳׳”, ׳×׳•׳“׳”' : '׳”׳‘׳ ׳×׳™, ׳׳×׳§׳'}</button>
                      )}
                  </div>
              </div>
          </div>
      )}

      {showDateToast && <div className="fixed bottom-24 left-1/2 transform -translate-x-1/2 z-[100] bg-[#8BC34A] text-white px-8 py-4 rounded-full shadow-2xl animate-fadeIn flex items-center gap-3 border-2 border-white/20"><div className="bg-white/20 p-2 rounded-full"><Calendar size={24} /></div><div><p className="font-bold text-lg">׳©׳™׳׳• ׳׳‘: ׳”׳×׳׳¨׳™׳ ׳¢׳•׳“׳›׳ ׳׳™׳•׳ ׳”׳׳—׳¨׳×</p></div></div>}

      <main className="max-w-[1600px] mx-auto px-6 py-8 space-y-8 animate-fadeIn pb-32">
        
        {/* ׳—׳׳§ ׳: ׳₪׳¨׳˜׳™׳ ׳›׳׳׳™׳™׳ */}
        <section className="bg-white rounded-[32px] shadow-sm border border-gray-100 overflow-visible relative z-20">
          <div className="bg-[#00BCD4] text-white h-12 flex items-center px-6 font-bold text-lg shadow-sm gap-2 rounded-t-3xl">
                <Flag size={20} />
                <span>׳₪׳¨׳˜׳™׳ ׳›׳׳׳™׳™׳</span>
          </div>
          
          <div className="p-6 space-y-8">
            {/* ׳©׳•׳¨׳” ׳¢׳׳™׳•׳ ׳” - ׳”׳›׳ ׳‘׳©׳•׳¨׳” ׳׳—׳× ׳‘-Grid 12 */}
            <div className="grid grid-cols-1 md:grid-cols-12 gap-4 items-start">
                
                {/* 1. ׳¡׳•׳’ ׳”׳₪׳¢׳™׳׳•׳× (3 ׳¢׳׳•׳“׳•׳×) */}
                <div className="md:col-span-3 relative">
                      <label className="text-xs font-bold text-gray-500 block mb-1">׳¡׳•׳’ ׳”׳₪׳¢׳™׳׳•׳×</label>
                      <div className="relative group">
                          <select className="w-full px-3 rounded-xl border border-gray-200 focus:border-[#E91E63] focus:ring-1 focus:ring-[#E91E63] outline-none transition-all text-sm h-[60px] cursor-pointer appearance-none bg-white"
                             value={generalInfo.tripType} onChange={(e) => setGeneralInfo({...generalInfo, tripType: e.target.value})}>
                             <option value="">׳‘׳—׳¨ ׳¡׳•׳’...</option>
                             {TRIP_TYPES.map(t => <option key={t} value={t}>{t}</option>)}
                          </select>
                          <div className="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400"><ChevronDown size={16}/></div>
                      </div>
                      {generalInfo.tripType === '׳׳—׳¨' && (
                          <div className="absolute top-full left-0 mt-1 w-64 bg-white border border-pink-200 p-2 rounded-xl shadow-xl z-50 animate-fadeIn">
                              <label className="text-[10px] font-bold text-gray-400 mb-0.5 block">׳₪׳™׳¨׳•׳˜:</label>
                              <input type="text" className="w-full px-2 py-1 text-xs border-b border-gray-300 focus:border-[#E91E63] outline-none bg-gray-50 rounded" 
                                 value={generalInfo.tripTypeOther} onChange={(e) => setGeneralInfo({...generalInfo, tripTypeOther: e.target.value})} autoFocus />
                          </div>
                      )}
                </div>

                {/* 2. ׳©׳ ׳”׳₪׳¢׳™׳׳•׳× (3 ׳¢׳׳•׳“׳•׳×) */}
                <div className="md:col-span-3">
                      <label className="text-xs font-bold text-gray-500 block mb-1">׳©׳ ׳”׳₪׳¢׳™׳׳•׳×</label>
                      <input type="text" className="w-full px-3 rounded-xl border border-gray-200 focus:border-[#E91E63] focus:ring-1 focus:ring-[#E91E63] outline-none transition-all text-sm h-[60px]" 
                        value={generalInfo.name} onChange={(e) => setGeneralInfo({...generalInfo, name: e.target.value})} placeholder="׳׳“׳•׳’׳׳”: ׳˜׳™׳•׳ ׳׳¦׳₪׳•׳" />
                </div>

                {/* 3. ׳×׳׳¨׳™׳›׳™׳ ׳•׳©׳¢׳•׳× - ׳™׳¦׳™׳׳” ׳•׳—׳–׳¨׳” (6 ׳¢׳׳•׳“׳•׳×) */}
                <div className="md:col-span-6 grid grid-cols-2 gap-4">
                    {/* ׳™׳¦׳™׳׳” */}
                    <div>
                        <label className="text-xs font-bold text-gray-500 block mb-1">׳”׳×׳—׳׳”</label>
                        <div className="bg-gray-50 rounded-xl border border-gray-200 flex items-center h-[60px] focus-within:border-[#E91E63] focus-within:bg-white transition-colors overflow-hidden cursor-pointer" onClick={() => startDateRef.current?.showPicker()}>
                             <div className="flex-1 px-3 border-r border-gray-200 relative h-full flex flex-col justify-center">
                                 <input ref={startDateRef} type="date" className="w-full bg-transparent text-sm font-bold text-gray-800 outline-none z-10 relative" 
                                     value={generalInfo.startDate} onChange={(e) => setGeneralInfo({...generalInfo, startDate: e.target.value})} onClick={(e) => e.stopPropagation()} />
                                 <div className="text-[10px] text-[#00BCD4] font-bold leading-none mt-0.5 truncate">{startHebrewDate || '-'}</div>
                             </div>
                             <div className="w-24 h-full flex items-center justify-center bg-gray-50/50 relative z-20 hover:bg-gray-100 transition-colors" onClick={(e) => { e.stopPropagation(); startTimeRef.current?.showPicker(); }}>
                                 <input ref={startTimeRef} type="time" step="900" className="w-full h-full bg-transparent text-sm font-bold text-gray-800 outline-none text-center cursor-pointer" 
                                     value={generalInfo.startTime} onChange={(e) => setGeneralInfo({...generalInfo, startTime: e.target.value})} />
                             </div>
                        </div>
                    </div>
                    {/* ׳—׳–׳¨׳” */}
                    <div>
                        <label className="text-xs font-bold text-gray-500 block mb-1">׳¡׳™׳•׳</label>
                        <div className="bg-gray-50 rounded-xl border border-gray-200 flex items-center h-[60px] focus-within:border-[#E91E63] focus-within:bg-white transition-colors overflow-hidden cursor-pointer" onClick={() => endDateRef.current?.showPicker()}>
                             <div className="flex-1 px-3 border-r border-gray-200 relative h-full flex flex-col justify-center">
                                 <input ref={endDateRef} type="date" className="w-full bg-transparent text-sm font-bold text-gray-800 outline-none z-10 relative" 
                                     value={generalInfo.endDate} onChange={(e) => setGeneralInfo({...generalInfo, endDate: e.target.value})} onClick={(e) => e.stopPropagation()}/>
                                 <div className="text-[10px] text-[#00BCD4] font-bold leading-none mt-0.5 truncate">{endHebrewDate || '-'}</div>
                             </div>
                             <div className="w-24 h-full flex items-center justify-center bg-gray-50/50 relative z-20 hover:bg-gray-100 transition-colors" onClick={(e) => { e.stopPropagation(); endTimeRef.current?.showPicker(); }}>
                                 <input ref={endTimeRef} type="time" step="900" className="w-full h-full bg-transparent text-sm font-bold text-gray-800 outline-none text-center cursor-pointer" 
                                     value={generalInfo.endTime} onChange={(e) => setGeneralInfo({...generalInfo, endTime: e.target.value})} />
                             </div>
                        </div>
                    </div>
                </div>
            </div>
            
            {isUrgentError && (
                <div className="bg-red-50 border border-red-200 text-red-700 p-2 rounded-lg flex items-center gap-2 text-xs font-bold animate-fadeIn mt-2">
                    <AlertTriangle size={14} className="shrink-0"/>
                    <div>׳©׳’׳™׳׳”: ׳׳ ׳ ׳™׳×׳ ׳׳”׳’׳™׳© ׳˜׳™׳•׳ ׳₪׳—׳•׳× ׳-48 ׳©׳¢׳•׳× ׳׳₪׳ ׳™ ׳”׳™׳¦׳™׳׳”.</div>
                </div>
            )}

            <div className="h-px bg-gray-100"></div>

            {/* ׳©׳•׳¨׳” ׳©׳ ׳™׳” */}
            <div className="grid grid-cols-1 md:grid-cols-12 gap-4 items-start">
                
                <div className="md:col-span-3">
                    <label className="text-xs font-bold text-gray-500 block mb-1">׳©׳›׳‘׳•׳× ׳’׳™׳</label>
                    <div className="flex items-center gap-2 bg-gray-50 p-1 rounded-xl border border-gray-200 h-[60px] focus-within:border-[#E91E63] focus-within:bg-white transition-colors">
                        <select className="bg-transparent text-sm p-1 outline-none font-bold w-full cursor-pointer h-full text-gray-700" value={generalInfo.gradeFrom} onChange={(e) => setGeneralInfo({...generalInfo, gradeFrom: e.target.value})}>
                            <option value="">׳׳›׳™׳×׳”...</option>{GRADES.map(g => <option key={g} value={g}>׳›׳™׳×׳” {g}</option>)}
                        </select>
                        <span className="text-gray-300">-</span>
                        <select className="bg-transparent text-sm p-1 outline-none font-bold w-full cursor-pointer h-full text-gray-700" value={generalInfo.gradeTo} onChange={(e) => setGeneralInfo({...generalInfo, gradeTo: e.target.value})}>
                            <option value="">׳¢׳“ ׳›׳™׳×׳”...</option>{GRADES.map(g => <option key={g} value={g}>׳›׳™׳×׳” {g}</option>)}
                        </select>
                    </div>
                </div>

                <div className="md:col-span-2">
                    <label className="text-xs font-bold text-gray-500 block mb-1">׳¡"׳” ׳›׳׳•׳× ׳—׳ ׳™׳›׳™׳</label>
                    <input type="number" className="w-full px-3 rounded-xl border border-gray-200 text-sm outline-none focus:border-[#E91E63] focus:bg-white h-[60px] transition-colors" value={generalInfo.chanichimCount} onChange={(e) => setGeneralInfo({...generalInfo, chanichimCount: e.target.value})} />
                </div>

                <div className="md:col-span-5 relative bg-white rounded-xl border border-gray-100 p-2 min-h-[74px] flex flex-col justify-center group hover:border-pink-200 transition-colors">
                    <div className="flex items-center gap-2 px-1 mb-1">
                        <label className="text-xs font-bold text-gray-500 group-hover:text-[#E91E63] transition-colors">׳¦׳•׳•׳× ׳׳©׳×׳×׳£ ׳‘׳˜׳™׳•׳</label>
                        <span className="text-[10px] text-gray-400 font-normal">(׳ ׳™׳×׳ ׳׳‘׳—׳•׳¨ ׳׳¡' ׳׳₪׳©׳¨׳•׳™׳•׳×)</span>
                    </div>
                    
                    <div className="flex flex-wrap gap-1 items-center">
                        {STAFF_AGES.map(age => (
                            <button key={age} onClick={() => toggleStaffAge(age)} 
                                className={`px-2 py-1 rounded-full text-[10px] font-bold border transition-all flex items-center gap-1
                                ${generalInfo.staffAges.includes(age) ? 'bg-[#E91E63] text-white border-[#E91E63] shadow-sm' : 'bg-white text-gray-500 border-gray-100 hover:bg-gray-100'}`}>
                                {generalInfo.staffAges.includes(age) && <Check size={8}/>}
                                {age}
                            </button>
                        ))} 
                    </div>

                    {generalInfo.staffAges.includes('׳׳—׳¨') && (
                        <div className="absolute top-full left-0 right-0 mt-2 bg-white border border-pink-200 p-2 rounded-xl shadow-lg z-50 animate-fadeIn">
                            <input type="text" placeholder="׳ ׳ ׳׳₪׳¨׳˜ ׳›׳׳..." className="w-full p-2 text-xs border-b border-gray-300 focus:border-[#E91E63] outline-none bg-gray-50 rounded" value={generalInfo.staffOther} onChange={(e) => setGeneralInfo({...generalInfo, staffOther: e.target.value})} autoFocus />
                        </div>
                    )}
                </div>

                <div className="md:col-span-2">
                    <label className="text-xs font-bold text-gray-500 block mb-1">׳¡"׳” ׳׳©׳×׳×׳₪׳™׳</label>
                    <input type="number" className="w-full px-3 rounded-xl border border-gray-200 text-sm outline-none focus:border-[#E91E63] bg-[#E0F7FA] font-bold text-[#00BCD4] h-[60px] transition-colors" placeholder="׳—׳ ׳™׳›׳™׳ + ׳¦׳•׳•׳×" value={generalInfo.totalTravelers} onChange={(e) => setGeneralInfo({...generalInfo, totalTravelers: e.target.value})} />
                </div>

            </div>
          </div>
        </section>

        {/* === ׳—׳׳§ ׳‘': ׳₪׳™׳¨׳•׳˜ ׳”׳˜׳™׳•׳ === */}
        <section className="bg-white rounded-[32px] shadow-sm border border-gray-100 overflow-visible relative z-10">
           <div className="bg-[#00BCD4] text-white h-12 flex items-center px-6 font-bold text-lg shadow-sm justify-between rounded-t-3xl">
               <div className="flex items-center gap-2"><MapPin size={20}/> <span>׳₪׳™׳¨׳•׳˜ ׳”׳₪׳¢׳™׳׳•׳× / ׳˜׳™׳•׳</span></div>
               <span className="text-xs bg-white/20 px-3 py-1 rounded-full">{timeline.length} ׳©׳•׳¨׳•׳×</span>
           </div>
           
           <div className="p-6 space-y-4 bg-gray-50 rounded-b-3xl">
              {timeline.map((item) => {
                  const catConfig = CATEGORIES[item.category];
                  const CatIcon = catConfig?.icon || Flag;
                  const isExpanded = expandedItem === item.id;
                  const colorClass = getColorHex(catConfig?.color);
                  const isMissingLicense = item.requiresLicense && (!item.licenseFile || !item.insuranceFile);

                  return (
                    <div key={item.id} className={`border rounded-xl overflow-hidden bg-white transition-all group shadow-sm hover:shadow-md ${isMissingLicense ? 'border-red-300 ring-1 ring-red-100' : 'border-gray-200 hover:border-[#E91E63]'}`}>
                        
                        {/* ׳©׳•׳¨׳” ׳¡׳’׳•׳¨׳” */}
                        <div className="flex items-center gap-4 p-4 cursor-pointer" onClick={() => setExpandedItem(isExpanded ? null : item.id)}>
                            <div className={`p-3 rounded-xl text-white shadow-sm`} style={{backgroundColor: colorClass}}><CatIcon size={20} /></div>
                            <div className="text-xs font-bold w-24 text-gray-500 bg-gray-50 border px-2 py-1.5 rounded-lg text-center flex flex-col justify-center">
                                <span className="text-[10px] text-gray-400">׳×׳׳¨׳™׳</span>
                                {item.date ? `${item.date.split('-')[2]}/${item.date.split('-')[1]}` : '-'}
                            </div>
                            <div className="flex-1">
                                <div className="text-sm font-black text-gray-800">{item.finalSubCategory}</div>
                                <div className="text-xs text-gray-500 flex items-center gap-1 mt-0.5"><MapPin size={12} className="text-[#E91E63]"/> {item.finalLocation}</div>
                            </div>
                            
                            {item.requiresLicense && (
                             <div className={`hidden md:flex text-xs px-3 py-1 rounded-full border items-center gap-1.5 font-bold 
                                ${(item.licenseFile && item.insuranceFile) ? 'bg-green-50 text-green-700 border-green-200' : 'bg-red-50 text-red-700 border-red-200'}`}>
                                {(item.licenseFile && item.insuranceFile) ? <CheckCircle size={12}/> : <AlertTriangle size={12}/>}
                                <span>{(item.licenseFile && item.insuranceFile) ? '׳™׳© ׳׳™׳©׳•׳¨׳™׳' : '׳—׳¡׳¨׳™׳ ׳׳™׳©׳•׳¨׳™׳'}</span>
                             </div>
                            )}
                            <div className="text-gray-300 group-hover:text-[#E91E63] transition-colors">{isExpanded ? <ChevronUp size={20}/> : <ChevronDown size={20}/>}</div>
                        </div>

                        {/* ׳©׳•׳¨׳” ׳₪׳×׳•׳—׳” */}
                        {isExpanded && (
                            <div className="p-5 border-t border-gray-100 bg-white animate-fadeIn">
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm mb-4">
                                <div><span className="block text-xs font-bold text-gray-400 mb-1">׳׳™׳§׳•׳ ׳׳“׳•׳™׳§</span><div className="p-3 bg-white rounded-xl border border-gray-200 shadow-sm">{item.finalLocation}</div></div>
                                <div><span className="block text-xs font-bold text-gray-400 mb-1">׳₪׳¨׳˜׳™׳ ׳ ׳•׳¡׳₪׳™׳</span><div className="p-3 bg-white rounded-xl border border-gray-200 shadow-sm min-h-[46px]">{item.details || '-'}</div></div>
                              </div>
                              
                              {item.requiresLicense && (
                                <div className="bg-orange-50 border border-orange-200 rounded-xl p-4">
                                    <div className="flex items-center gap-2 text-orange-900 text-xs font-bold mb-3">
                                         <AlertTriangle size={16} className="text-orange-600"/>
                                         <span>׳׳¡׳׳›׳™׳ ׳׳¦׳•׳¨׳₪׳™׳ ׳׳₪׳¢׳™׳׳•׳× ׳–׳•:</span>
                                    </div>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                         <div className={`p-3 rounded-xl border flex items-center justify-between gap-2 ${item.licenseFile ? 'bg-green-50 border-green-200' : 'bg-white border-orange-200'}`}>
                                             <div className="text-xs truncate flex-1">
                                                 <span className="block font-bold text-gray-500 mb-0.5">׳¨׳™׳©׳•׳™ ׳¢׳¡׳§:</span>
                                                 {item.licenseFile ? <a href={item.licenseFile.url} target="_blank" rel="noreferrer" className="text-green-700 font-bold hover:underline flex items-center gap-1"><LinkIcon size={12}/> {item.licenseFile.name}</a> : <span className="text-red-500 font-bold">׳—׳¡׳¨ ׳§׳•׳‘׳¥!</span>}
                                             </div>
                                             <label className="cursor-pointer p-2 bg-white border border-gray-200 rounded-lg hover:border-[#E91E63] text-gray-400 hover:text-[#E91E63] transition-colors shadow-sm">
                                                 {uploadingFileId === `${item.id}_license` ? <Loader2 size={16} className="animate-spin"/> : <FileUp size={16}/>}
                                                 <input type="file" className="hidden" accept=".pdf,.jpg,.jpeg,.png" onChange={(e) => handleExistingLineDualUpload(e, item.id, 'license')} disabled={!!uploadingFileId} />
                                             </label>
                                         </div>

                                         <div className={`p-3 rounded-xl border flex items-center justify-between gap-2 ${item.insuranceFile ? 'bg-green-50 border-green-200' : 'bg-white border-orange-200'}`}>
                                             <div className="text-xs truncate flex-1">
                                                 <span className="block font-bold text-gray-500 mb-0.5">׳‘׳™׳˜׳•׳—:</span>
                                                 {item.insuranceFile ? <a href={item.insuranceFile.url} target="_blank" rel="noreferrer" className="text-green-700 font-bold hover:underline flex items-center gap-1"><LinkIcon size={12}/> {item.insuranceFile.name}</a> : <span className="text-red-500 font-bold">׳—׳¡׳¨ ׳§׳•׳‘׳¥!</span>}
                                             </div>
                                             <label className="cursor-pointer p-2 bg-white border border-gray-200 rounded-lg hover:border-[#E91E63] text-gray-400 hover:text-[#E91E63] transition-colors shadow-sm">
                                                 {uploadingFileId === `${item.id}_insurance` ? <Loader2 size={16} className="animate-spin"/> : <FileUp size={16}/>}
                                                 <input type="file" className="hidden" accept=".pdf,.jpg,.jpeg,.png" onChange={(e) => handleExistingLineDualUpload(e, item.id, 'insurance')} disabled={!!uploadingFileId} />
                                             </label>
                                         </div>
                                    </div>
                                </div>
                              )}
                              
                              <div className="mt-4 flex justify-end"><button onClick={(e) => handleRemoveLine(item.id, e)} className="text-[#E91E63] text-xs font-bold flex items-center gap-1 hover:bg-pink-50 px-3 py-1.5 rounded-lg transition-colors border border-transparent hover:border-pink-100"><Trash2 size={16} /> ׳”׳¡׳¨ ׳©׳•׳¨׳”</button></div>
                            </div>
                        )}
                    </div>
                  )
              })}

              {!isRowsLocked && (
                <div className="bg-white p-5 rounded-2xl border-2 border-[#E91E63] border-dashed shadow-sm animate-fadeIn mt-4 relative">
                    <div className="absolute -top-3 right-4 bg-white px-2 text-xs font-bold text-[#E91E63]">׳”׳•׳¡׳₪׳× ׳©׳•׳¨׳” ׳—׳“׳©׳”</div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-12 gap-2 items-end">
                        
                        {/* 1. ׳×׳׳¨׳™׳ */}
                        <div className="md:col-span-1">
                            <label className="text-[10px] font-bold text-gray-400 mb-1 block">׳×׳׳¨׳™׳</label>
                            <div className="w-full text-xs p-2 rounded-xl border border-gray-100 bg-gray-100 text-gray-500 h-[48px] flex items-center justify-center font-bold select-none cursor-default whitespace-nowrap overflow-hidden text-ellipsis">
                                {currentLine.date ? `${currentLine.date.split('-')[2]}/${currentLine.date.split('-')[1]}/${currentLine.date.split('-')[0]}` : '-'}
                            </div>
                        </div>
                        
                        {/* 2. ׳׳™׳§׳•׳ */}
                        <div className="md:col-span-2 relative">
                            <label className="text-[10px] font-bold text-gray-400 mb-1 block">׳׳™׳§׳•׳</label>
                            <div className="relative">
                                <input type="text" className={`w-full text-sm p-3 rounded-xl border outline-none h-[48px] transition-colors ${currentLine.locationType === 'branch' ? 'bg-pink-50 border-pink-200 text-[#E91E63] font-bold cursor-not-allowed' : 'bg-gray-50 border-gray-200 focus:border-[#E91E63] focus:bg-white'}`} placeholder="׳”׳–׳ ׳׳™׳§׳•׳" value={currentLine.locationValue} readOnly={currentLine.locationType === 'branch'} 
                                    onFocus={() => { if (currentLine.locationType !== 'branch') setShowLocationSuggestions(true); }}
                                    onChange={e => { setCurrentLine({...currentLine, locationValue: e.target.value, locationType: 'custom'}); setShowLocationSuggestions(true); }}
                                    onBlur={() => setTimeout(() => setShowLocationSuggestions(false), 200)}
                                />
                                {currentLine.locationType === 'branch' && (
                                    <div onClick={() => setCurrentLine({...currentLine, locationValue: '', locationType: 'custom'})} className="absolute top-full right-0 mt-1 text-[10px] text-red-400 font-bold cursor-pointer hover:text-red-600 hover:underline z-10 w-full text-center">׳׳—׳¥ ׳׳”׳–׳ ׳× ׳׳™׳§׳•׳ ׳׳—׳¨</div>
                                )}
                                {showLocationSuggestions && currentLine.locationType !== 'branch' && (
                                    <div className="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-xl shadow-xl z-50 max-h-48 overflow-y-auto">
                                        <div className="p-2 text-xs font-bold text-[#E91E63] hover:bg-pink-50 cursor-pointer border-b border-gray-100 flex items-center gap-2" onClick={() => setCurrentLine({...currentLine, locationValue: '׳‘׳¡׳ ׳™׳£ ׳”׳§׳‘׳•׳¢', locationType: 'branch'})}><Home size={14} />׳”׳¡׳ ׳™׳£ ׳”׳§׳‘׳•׳¢</div>
                                        {currentLine.locationValue.length >= 1 && ISRAEL_CITIES.filter(city => city.includes(currentLine.locationValue) && city !== currentLine.locationValue).map(city => (<div key={city} className="p-2 text-xs text-gray-700 hover:bg-gray-50 cursor-pointer border-b border-gray-50" onClick={() => setCurrentLine({...currentLine, locationValue: city, locationType: 'city'})}>{city}</div>))}
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* 3. ׳”׳×׳¨׳—׳©׳•׳× + ׳₪׳™׳¨׳•׳˜ */}
                        <div className="md:col-span-5 flex gap-2">
                            <div className="flex-1 relative">
                                <label className="text-[10px] font-bold text-gray-400 mb-1 block">׳”׳×׳¨׳—׳©׳•׳×</label>
                                <div className="w-full text-xs p-2 rounded-xl border border-gray-200 hover:border-[#E91E63] bg-gray-50 hover:bg-white cursor-pointer h-[48px] flex items-center justify-between px-3 transition-all" onClick={() => setShowCategoryDropdown(!showCategoryDropdown)}>
                                    <span className={`font-bold ${currentLine.category ? 'text-gray-800' : 'text-gray-400'}`}>{CATEGORIES[currentLine.category]?.label || '׳‘׳—׳¨...'}</span><ChevronDown size={16} className="text-gray-400" />
                                </div>
                                {showCategoryDropdown && (
                                    <div className="absolute top-full right-0 w-48 mt-1 bg-white border border-gray-200 rounded-xl shadow-2xl z-[100] overflow-hidden">
                                        {Object.entries(CATEGORIES).map(([key, val]: any, index) => {
                                            const Icon = val.icon; const colors = ['text-[#00BCD4]', 'text-[#8BC34A]', 'text-[#E91E63]']; const bgs = ['hover:bg-cyan-50', 'hover:bg-green-50', 'hover:bg-pink-50'];
                                            return (<div key={key} className={`p-3 text-xs text-gray-700 ${bgs[index % 3]} cursor-pointer border-b border-gray-50 flex items-center gap-3 transition-colors`} onClick={() => { setCurrentLine({...currentLine, category: key, subCategory: '', otherDetail: ''}); setShowCategoryDropdown(false); }}><Icon size={16} className={colors[index % 3]} /><span className="font-bold">{val.label}</span></div>)
                                        })}
                                    </div>
                                )}
                                {showCategoryDropdown && <div className="fixed inset-0 z-[90] cursor-default" onClick={() => setShowCategoryDropdown(false)}></div>}
                            </div>
                            <div className="flex-[1.5] relative">
                                <label className="text-[10px] font-bold text-gray-400 mb-1 block">׳₪׳™׳¨׳•׳˜ ׳”׳”׳×׳¨׳—׳©׳•׳×</label>
                                {currentLine.subCategory === '׳׳—׳¨' ? (
                                    <div className="relative"><input type="text" className="w-full text-xs p-2 rounded-xl border border-gray-200 focus:border-[#E91E63] outline-none bg-white h-[48px]" placeholder="׳₪׳¨׳˜..." autoFocus value={currentLine.otherDetail} onChange={e => setCurrentLine({...currentLine, otherDetail: e.target.value})} /><div className="absolute left-2 top-1/2 -translate-y-1/2 text-xs text-gray-400 cursor-pointer font-bold" onClick={() => setCurrentLine({...currentLine, subCategory: ''})}>X</div></div>
                                ) : (
                                    <><div className={`w-full text-xs p-2 rounded-xl border border-gray-200 h-[48px] flex items-center justify-between px-3 transition-all ${!currentLine.category ? 'bg-gray-100 cursor-not-allowed opacity-50' : 'hover:border-[#E91E63] bg-gray-50 hover:bg-white cursor-pointer'}`} onClick={() => { if(currentLine.category) setShowSubCategoryDropdown(!showSubCategoryDropdown) }}><span className={`font-bold ${currentLine.subCategory ? 'text-gray-800' : 'text-gray-400'}`}>{currentLine.subCategory || (currentLine.category ? '׳‘׳—׳¨ ׳₪׳™׳¨׳•׳˜...' : '-')}</span><ChevronDown size={16} className="text-gray-400" /></div>
                                    {showSubCategoryDropdown && currentLine.category && (
                                        <div className="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-xl shadow-2xl z-[100] overflow-hidden max-h-48 overflow-y-auto">{CATEGORIES[currentLine.category]?.options.map((opt: any) => (<div key={opt.label} className="p-3 text-xs text-gray-700 hover:bg-pink-50 hover:text-[#E91E63] cursor-pointer border-b border-gray-50 font-bold transition-colors" onClick={() => { setCurrentLine({...currentLine, subCategory: opt.label}); setShowSubCategoryDropdown(false); }}>{opt.label}</div>))}</div>
                                    )}
                                    {showSubCategoryDropdown && <div className="fixed inset-0 z-[90] cursor-default" onClick={() => setShowSubCategoryDropdown(false)}></div>}</>
                                )}
                            </div>
                        </div>

                        {/* 4. ׳₪׳¨׳˜׳™׳ ׳•׳›׳₪׳×׳•׳¨ ׳”׳•׳¡׳₪׳” */}
                        <div className="md:col-span-4 flex gap-2 items-end">
                            {currentLine.subCategory === '׳׳™׳ ׳× ׳׳‘׳ ׳”' ? (
                                <div className="flex-grow flex gap-2">
                                    <div className="flex-1"><label className="text-[10px] font-bold text-red-400 mb-1 block">׳©׳ ׳”׳׳§׳•׳/׳›׳×׳•׳‘׳× (׳—׳•׳‘׳”)</label><input type="text" className="w-full text-xs p-3 rounded-xl border border-red-200 bg-red-50 focus:border-red-400 focus:bg-white outline-none h-[48px]" placeholder="׳©׳ ׳”׳׳§׳•׳/׳›׳×׳•׳‘׳×" value={currentLine.otherDetail} onChange={e => setCurrentLine({...currentLine, otherDetail: e.target.value})} /></div>
                                    <div className="flex-1"><label className="text-[10px] font-bold text-gray-400 mb-1 block">׳₪׳¨׳˜׳™׳ ׳ ׳•׳¡׳₪׳™׳</label><input type="text" className="w-full text-xs p-3 rounded-xl border border-gray-200 focus:border-[#E91E63] outline-none bg-gray-50 focus:bg-white h-[48px]" placeholder="׳”׳¢׳¨׳•׳×..." value={currentLine.details} onChange={e => setCurrentLine({...currentLine, details: e.target.value})} /></div>
                                </div>
                            ) : (
                                <div className="flex-grow relative">
                                    <div className="flex justify-between items-end mb-1"><label className="text-[10px] font-bold text-gray-400 block">{currentLine.category === 'hiking' ? '׳₪׳™׳¨׳•׳˜ ׳”׳׳¡׳׳•׳' : '׳₪׳¨׳˜׳™׳ ׳ ׳•׳¡׳₪׳™׳'}</label>{currentLine.category === 'hiking' && (<a href="https://mokedteva.co.il/InfoCenter/TrackWizard" target="_blank" rel="noreferrer" className="text-[10px] font-bold text-[#E91E63] flex items-center gap-1 hover:underline"><LinkIcon size={10} />׳׳›׳ ׳™׳¡׳” ׳׳׳©׳£ ׳”׳׳¡׳׳•׳׳™׳ ׳©׳ ׳׳•׳§׳“ ׳˜׳‘׳¢</a>)}</div>
                                    <input type="text" className="w-full text-xs p-3 rounded-xl border border-gray-200 focus:border-[#E91E63] outline-none bg-gray-50 focus:bg-white h-[48px]" placeholder={currentLine.category === 'hiking' ? '׳׳¡\' ׳”׳׳¡׳׳•׳ ׳•׳›׳•\'' : '׳₪׳¨׳˜׳™׳ ׳ ׳•׳¡׳₪׳™׳...'} value={currentLine.details} onChange={e => setCurrentLine({...currentLine, details: e.target.value})} />
                                </div>
                            )}
                            <div>
                                <button onClick={handleAddLine} className="bg-[#8BC34A] hover:bg-[#7CB342] text-white h-[48px] w-[48px] rounded-xl flex items-center justify-center shadow-lg transition-all active:scale-95 flex-shrink-0 mb-[1px]" title="׳׳׳™׳©׳•׳¨ ׳”׳©׳•׳¨׳” ׳•׳₪׳×׳™׳—׳× ׳©׳•׳¨׳” ׳—׳“׳©׳”"><Check size={28} strokeWidth={3} /></button>
                            </div>
                        </div>
                    </div>
                    
                    {/* ׳׳–׳•׳¨ ׳”׳¢׳׳׳× ׳§׳‘׳¦׳™׳ ׳”׳—׳“׳© */}
                    {currentLineNeedsLicense && (
                        <div className="mt-3 bg-orange-50 border border-orange-200 rounded-xl p-3 flex flex-col gap-3 animate-fadeIn">
                            <div className="flex items-center gap-2 text-orange-900 text-xs font-bold">
                                <AlertTriangle size={18} className="text-orange-600"/>
                                <span>׳₪׳¢׳™׳׳•׳× ׳–׳• ׳“׳•׳¨׳©׳× ׳׳™׳©׳•׳¨׳™׳. ׳—׳•׳‘׳” ׳׳”׳¢׳׳•׳× ׳׳× ׳©׳ ׳™ ׳”׳׳¡׳׳›׳™׳ ׳”׳‘׳׳™׳:</span>
                            </div>
                            <div className="flex flex-col sm:flex-row gap-3">
                                <label className={`flex-1 cursor-pointer bg-white border px-4 py-3 rounded-xl text-xs font-bold hover:shadow-md transition-all flex items-center justify-center gap-2 shadow-sm ${currentLine.licenseFile ? 'border-green-300 text-green-700 bg-green-50' : 'border-orange-200 text-orange-700 hover:bg-orange-100'}`}>
                                    {isUploadingLicense ? <Loader2 size={16} className="animate-spin" /> : currentLine.licenseFile ? <CheckCircle size={16}/> : <FileUp size={16} />} 
                                    {isUploadingLicense ? '׳׳¢׳׳”...' : currentLine.licenseFile ? `׳¨׳™׳©׳•׳™: ${currentLine.licenseFile?.name}` : '׳”׳¢׳׳׳× ׳¨׳™׳©׳•׳™ ׳¢׳¡׳§ (׳—׳•׳‘׳”)'}
                                    <input type="file" className="hidden" accept=".pdf,.jpg,.jpeg,.png" onChange={(e) => handleUpload(e.target.files![0], 'license')} disabled={isUploadingLicense} />
                                </label>
                                <label className={`flex-1 cursor-pointer bg-white border px-4 py-3 rounded-xl text-xs font-bold hover:shadow-md transition-all flex items-center justify-center gap-2 shadow-sm ${currentLine.insuranceFile ? 'border-green-300 text-green-700 bg-green-50' : 'border-orange-200 text-orange-700 hover:bg-orange-100'}`}>
                                    {isUploadingInsurance ? <Loader2 size={16} className="animate-spin" /> : currentLine.insuranceFile ? <CheckCircle size={16}/> : <FileUp size={16} />} 
                                    {isUploadingInsurance ? '׳׳¢׳׳”...' : currentLine.insuranceFile ? `׳‘׳™׳˜׳•׳—: ${currentLine.insuranceFile?.name}` : '׳”׳¢׳׳׳× ׳‘׳™׳˜׳•׳— (׳—׳•׳‘׳”)'}
                                    <input type="file" className="hidden" accept=".pdf,.jpg,.jpeg,.png" onChange={(e) => handleUpload(e.target.files![0], 'insurance')} disabled={isUploadingInsurance} />
                                </label>
                            </div>
                        </div>
                    )}
                </div>
              )}
              
              <div className="flex justify-center pt-4">
                  <button onClick={handleLockToggle} className={`text-xs flex items-center gap-2 px-6 py-2 rounded-full border transition-all font-bold ${isRowsLocked ? 'bg-gray-800 text-white border-gray-800' : 'bg-white text-[#E91E63] border-[#E91E63] hover:bg-[#E91E63] hover:text-white'}`}>
                      {isRowsLocked ? <><Lock size={14}/> ׳׳¦׳‘ ׳¦׳₪׳™׳™׳” (׳׳—׳¥ ׳׳¢׳¨׳™׳›׳”)</> : <><Unlock size={14}/> ׳¡׳™׳•׳ ׳”׳•׳¡׳₪׳× ׳©׳•׳¨׳•׳×</>}
                  </button>
              </div>
           </div>
        </section>

        {/* === ׳—׳׳§ ׳’': ׳”׳¢׳¨׳•׳× ׳•׳¡׳™׳•׳ === */}
        <section className="bg-white rounded-[32px] shadow-sm border border-gray-100 overflow-hidden">
            <div className="bg-[#00BCD4] text-white h-12 flex items-center px-6 font-bold text-lg shadow-sm gap-2">
               <MessageSquare size={20} />
               <span>׳”׳¢׳¨׳•׳×</span>
            </div>
            
            <div className="p-6">
                 <label className="block text-sm font-bold text-gray-700 mb-2">׳׳©׳”׳• ׳©׳—׳©׳•׳‘ ׳׳ ׳©׳ ׳“׳¢</label>
                 <textarea className="w-full p-4 rounded-xl bg-gray-50 border border-gray-200 outline-none focus:border-[#E91E63] focus:ring-1 focus:ring-[#E91E63] min-h-[100px] resize-y" placeholder="׳“׳’׳©׳™׳ ׳׳™׳•׳—׳“׳™׳, ׳‘׳§׳©׳•׳× ׳•׳›׳•'..." value={generalInfo.generalComments} onChange={(e) => setGeneralInfo({...generalInfo, generalComments: e.target.value})}></textarea>
            </div>
        </section>
      </main>
      
      {/* Footer Actions */}
      <div className="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-md border-t border-gray-100 p-4 z-40 transition-all" style={{ right: 'var(--sidebar-width, 0)' }}>
          <div className="max-w-6xl mx-auto flex justify-end gap-4">
              {isUrgentError && <div className="bg-red-50 text-red-600 px-4 py-3 rounded-2xl text-xs font-bold flex items-center gap-2"><AlertTriangle size={16}/> ׳×׳׳¨׳™׳ ׳”׳™׳¦׳™׳׳” ׳§׳¨׳•׳‘ ׳׳“׳™!</div>}
              <button onClick={handleSubmit} disabled={loading || isUrgentError} className={`bg-[#8BC34A] hover:bg-[#7CB342] text-white px-8 py-3.5 rounded-2xl font-black text-lg shadow-lg hover:shadow-green-200 transition-all flex items-center gap-3 transform hover:-translate-y-1 ${loading || isUrgentError ? 'opacity-50 cursor-not-allowed grayscale' : ''}`}>
                  {loading ? '׳©׳•׳׳—...' : (<><span>׳¡׳™׳•׳ ׳•׳©׳׳™׳—׳× ׳‘׳§׳©׳”</span><Save size={20} /></>)}
              </button>
          </div>
      </div>

      <datalist id="cities">{ISRAEL_CITIES.map(c => <option key={c} value={c} />)}</datalist>
      <style jsx>{`@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } } .animate-fadeIn { animation: fadeIn 0.3s ease-out; }`}</style>
    </>
  )
}

==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\dashboard\profile\page.tsx
==========================================
"use client"

import React, { useState, useEffect } from 'react'
import { supabase } from '@/lib/supabaseClient'
import { Header } from '@/components/layout/Header'
import { Button } from '@/components/ui/Button'
import { Input } from '@/components/ui/Input'
import { 
  User, Mail, Building2, Save, CheckCircle, Loader2, Camera, ShieldCheck, Lock
} from 'lucide-react'

export default function ProfilePage() {
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [uploading, setUploading] = useState(false);
  const [user, setUser] = useState<any>(null);
  const [successMsg, setSuccessMsg] = useState('');

  const [formData, setFormData] = useState({
    // ׳ ׳×׳•׳ ׳™׳ ׳‘׳¡׳™׳¡׳™׳™׳
    officialName: '', // ׳©׳ ׳₪׳¨׳˜׳™ ׳׳₪׳™ ׳×"׳– (׳—׳“׳©)
    lastName: '',
    idNumber: '', 
    birthDate: '',
    nickname: '', // ׳›׳™׳ ׳•׳™ (׳—׳“׳©)
    
    // ׳ ׳×׳•׳ ׳™׳ ׳ ׳•׳¡׳₪׳™׳
    fullNameAndMother: '',
    contactEmail: '',
    phone: '',
    branchAddress: '',
    studentCount: '',
    staffCount: '',
    additionalStaff: '',
    profileImage: null as string | null
  });

  const isHQ = user?.user_metadata?.branch === '׳׳˜׳”' || !user?.user_metadata?.branch;

  useEffect(() => {
    const getUser = async () => {
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        setUser(user);
        const meta = user.user_metadata || {};
        
        // ׳—׳™׳׳•׳¥ ׳×"׳–
        let extractedId = meta.id_number || '';
        if (!extractedId && user.email?.includes('@')) {
            const possibleId = user.email.split('@')[0];
            if (/^\d+$/.test(possibleId)) extractedId = possibleId;
        }

        setFormData({
          // ׳׳•׳§׳—׳™׳ ׳׳× ׳”׳©׳ ׳”׳¨׳©׳׳™, ׳•׳׳ ׳׳™׳ - ׳׳ ׳¡׳™׳ ׳׳—׳׳¥ ׳׳”׳©׳ ׳”׳׳׳ ׳”׳™׳©׳
          officialName: meta.official_name || meta.first_name || meta.full_name?.split(' ')[0] || '',
          lastName: meta.last_name || meta.full_name?.split(' ').slice(1).join(' ') || '',
          idNumber: extractedId, 
          birthDate: meta.birth_date || '',
          nickname: meta.nickname || '', // ׳˜׳¢׳™׳ ׳× ׳”׳›׳™׳ ׳•׳™

          fullNameAndMother: meta.full_name_mother || meta.full_name || '',
          contactEmail: meta.contact_email || '', 
          phone: meta.phone || '',
          branchAddress: meta.branch_address || '',
          studentCount: meta.student_count || '',
          staffCount: meta.staff_count || '',
          additionalStaff: meta.additional_staff || '',
          profileImage: meta.avatar_url || null
        });
      }
      setLoading(false);
    };
    getUser();
  }, []);

  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    if (!e.target.files || !e.target.files[0]) return;
    const file = e.target.files[0];
    setUploading(true);

    try {
      const fileExt = file.name.split('.').pop();
      const fileName = `avatars/${user.id}_${Date.now()}.${fileExt}`;
      
      const { error: uploadError } = await supabase.storage
        .from('trip-files')
        .upload(fileName, file, { upsert: true });

      if (uploadError) throw uploadError;

      const { data: { publicUrl } } = supabase.storage
        .from('trip-files')
        .getPublicUrl(fileName);

      setFormData(prev => ({ ...prev, profileImage: publicUrl }));
    } catch (error: any) {
      alert('׳©׳’׳™׳׳” ׳‘׳”׳¢׳׳׳× ׳×׳׳•׳ ׳”: ' + error.message);
    } finally {
      setUploading(false);
    }
  };

  const handleSave = async () => {
    setSaving(true);
    setSuccessMsg('');

    try {
      const { error } = await supabase.auth.updateUser({
        data: {
          official_name: formData.officialName, // ׳©׳׳™׳¨׳× ׳”׳©׳ ׳”׳¨׳©׳׳™
          nickname: formData.nickname, // ׳©׳׳™׳¨׳× ׳”׳›׳™׳ ׳•׳™
          last_name: formData.lastName,
          id_number: formData.idNumber,
          birth_date: formData.birthDate,
          
          full_name_mother: formData.fullNameAndMother,
          contact_email: formData.contactEmail,
          phone: formData.phone,
          branch_address: formData.branchAddress,
          student_count: formData.studentCount,
          staff_count: formData.staffCount,
          additional_staff: formData.additionalStaff,
          avatar_url: formData.profileImage
        }
      });

      if (error) throw error;
      setSuccessMsg('׳”׳₪׳¨׳˜׳™׳ ׳ ׳©׳׳¨׳• ׳‘׳”׳¦׳׳—׳”!');
      setTimeout(() => { window.location.reload(); }, 1000);
    } catch (e: any) {
      alert('׳©׳’׳™׳׳” ׳‘׳©׳׳™׳¨׳”: ' + e.message);
    } finally {
      setSaving(false);
    }
  };

  if (loading) return <div className="h-screen flex items-center justify-center"><Loader2 className="animate-spin text-[#00BCD4]" size={40}/></div>;

  return (
    <>
      <Header title="׳₪׳¨׳•׳₪׳™׳ ׳׳™׳©׳™" />

      <div className="max-w-5xl mx-auto p-8 space-y-8 animate-fadeIn pb-32">
        
        {/* ׳›׳¨׳˜׳™׳¡ ׳¢׳׳™׳•׳ */}
        <section className="bg-white rounded-[32px] border border-gray-200 p-8 shadow-sm flex flex-col md:flex-row items-center gap-10 relative overflow-hidden">
            <div className="absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-[#00BCD4] to-[#8BC34A]"></div>
            
            {/* ׳×׳׳•׳ ׳× ׳₪׳¨׳•׳₪׳™׳ */}
            <div className="relative group cursor-pointer">
                <div className="w-32 h-32 rounded-[30px] bg-gradient-to-tr from-[#00BCD4] to-cyan-100 flex items-center justify-center text-white font-bold text-5xl shadow-xl shadow-cyan-100 border-[5px] border-white ring-1 ring-gray-100 overflow-hidden">
                    {uploading ? (
                       <Loader2 className="animate-spin text-[#00BCD4]" size={32}/>
                    ) : formData.profileImage ? (
                        <img src={formData.profileImage} alt="Profile" className="w-full h-full object-cover"/>
                    ) : (
                        formData.officialName?.[0] || <User size={48}/>
                    )}
                </div>
                <label className="absolute inset-0 bg-black/40 rounded-[30px] flex flex-col items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer transition-all">
                    <Camera size={24}/>
                    <span className="text-xs font-bold mt-1">׳©׳ ׳” ׳×׳׳•׳ ׳”</span>
                    <input type="file" className="hidden" accept="image/*" onChange={handleImageUpload} disabled={uploading}/>
                </label>
            </div>

            <div className="text-center md:text-right flex-1 space-y-3">
                <div className="flex flex-col md:items-start items-center">
                    <h2 className="text-3xl font-black text-gray-800">
                        {formData.officialName} {formData.lastName}
                    </h2>
                    {formData.nickname && (
                        <span className="text-lg text-gray-400 font-bold">({formData.nickname})</span>
                    )}
                </div>
                
                <div className="flex flex-wrap justify-center md:justify-start gap-3 mt-2">
                    <span className="bg-cyan-50 text-[#00BCD4] border border-cyan-100 px-4 py-2 rounded-xl text-sm font-bold flex items-center gap-2">
                        <Building2 size={16}/> {user?.user_metadata?.department} ג€¢ {user?.user_metadata?.branch || '׳׳˜׳”'}
                    </span>
                </div>
            </div>
        </section>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            {/* ׳¢׳׳•׳“׳” ׳™׳׳ ׳™׳×: ׳ ׳×׳•׳ ׳™׳ ׳׳¢׳¨׳›׳×׳™׳™׳ - ׳¨׳§׳¢ ׳™׳¨׳•׳§ ׳¢׳“׳™׳ */}
            <section className="bg-[#F1F8E9] rounded-[32px] border border-green-100 p-8 shadow-inner lg:col-span-1 h-fit">
                <div className="flex items-center gap-2 mb-6 text-[#8BC34A] font-bold text-sm uppercase tracking-wider">
                    <Lock size={14}/> ׳ ׳×׳•׳ ׳™׳ ׳׳¢׳¨׳›׳×׳™׳™׳ (׳×׳¦׳•׳’׳”)
                </div>
                <div className="space-y-6">
                    <div>
                        <label className="text-xs font-bold text-gray-400 block mb-1">׳©׳ (׳׳₪׳™ ׳×"׳–)</label>
                        <div className="font-bold text-gray-800 text-lg border-b border-green-200/50 pb-2">{formData.officialName || '-'}</div>
                    </div>
                    <div>
                        <label className="text-xs font-bold text-gray-400 block mb-1">׳©׳ ׳׳©׳₪׳—׳”</label>
                        <div className="font-bold text-gray-800 text-lg border-b border-green-200/50 pb-2">{formData.lastName || '-'}</div>
                    </div>
                    <div>
                        <label className="text-xs font-bold text-gray-400 block mb-1">׳×׳¢׳•׳“׳× ׳–׳”׳•׳×</label>
                        <div className="font-bold text-gray-800 text-lg border-b border-green-200/50 pb-2 tracking-wider">{formData.idNumber || '-'}</div>
                    </div>
                    <div>
                        <label className="text-xs font-bold text-gray-400 block mb-1">׳×׳׳¨׳™׳ ׳׳™׳“׳”</label>
                        <div className="font-bold text-gray-800 text-lg border-b border-green-200/50 pb-2">{formData.birthDate || '-'}</div>
                    </div>
                </div>
            </section>

            {/* ׳¢׳׳•׳“׳” ׳©׳׳׳׳™׳×: ׳˜׳•׳₪׳¡ ׳¢׳¨׳™׳›׳” */}
            <section className="bg-white rounded-[32px] border border-gray-200 p-8 shadow-sm lg:col-span-2">
                <div className="flex items-center gap-3 mb-8 border-b border-gray-100 pb-4">
                    <ShieldCheck size={24} className="text-[#00BCD4]"/>
                    <h3 className="text-xl font-bold text-gray-800">׳¢׳“׳›׳•׳ ׳₪׳¨׳˜׳™׳ ׳׳™׳©׳™׳™׳</h3>
                </div>

                <div className="space-y-6">
                    {/* ׳©׳“׳•׳× ׳©׳ ׳—׳“׳©׳™׳ */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <Input 
                            label="׳©׳ ׳₪׳¨׳˜׳™ (׳›׳₪׳™ ׳©׳׳•׳₪׳™׳¢ ׳‘׳×׳¢׳•׳“׳× ׳”׳–׳”׳•׳×)" 
                            value={formData.officialName} 
                            onChange={e => setFormData({...formData, officialName: e.target.value})}
                            placeholder="׳׳“׳•׳’׳׳”: ׳™׳•׳¡׳£ ׳—׳™׳™׳"
                        />
                        <Input 
                            label="׳›׳™׳ ׳•׳™ / ׳©׳ ׳—׳™׳‘׳”" 
                            value={formData.nickname} 
                            onChange={e => setFormData({...formData, nickname: e.target.value})}
                            placeholder="׳׳“׳•׳’׳׳”: ׳™׳•׳¡׳™"
                        />
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <Input 
                            label="׳©׳ ׳׳׳ + ׳©׳ ׳”׳׳" 
                            value={formData.fullNameAndMother} 
                            onChange={e => setFormData({...formData, fullNameAndMother: e.target.value})}
                        />
                        <Input 
                            label="׳˜׳׳₪׳•׳ ׳ ׳™׳™׳“" 
                            value={formData.phone} 
                            onChange={e => setFormData({...formData, phone: e.target.value})}
                        />
                    </div>

                    <Input 
                        label="׳׳™׳׳™׳™׳ ׳׳™׳¦׳™׳¨׳× ׳§׳©׳¨" 
                        value={formData.contactEmail} 
                        onChange={e => setFormData({...formData, contactEmail: e.target.value})} 
                        icon={<Mail size={18}/>}
                        placeholder="example@gmail.com"
                    />
                    <Input 
                        label="׳›׳×׳•׳‘׳× ׳”׳¡׳ ׳™׳£ ׳׳׳©׳׳•׳— ׳“׳•׳׳¨" 
                        value={formData.branchAddress} 
                        onChange={e => setFormData({...formData, branchAddress: e.target.value})}
                        placeholder="׳¨׳—׳•׳‘, ׳׳¡׳₪׳¨, ׳¢׳™׳¨..."
                    />

                    <div className="h-px bg-gray-100 my-2"></div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <Input label="׳›׳׳•׳× ׳—׳ ׳™׳›׳™׳" type="number" value={formData.studentCount} onChange={e => setFormData({...formData, studentCount: e.target.value})}/>
                        <Input label="׳›׳׳•׳× ׳׳ ׳©׳™ ׳¦׳•׳•׳×" type="number" value={formData.staffCount} onChange={e => setFormData({...formData, staffCount: e.target.value})}/>
                    </div>

                    <div className="bg-cyan-50/50 p-6 rounded-2xl border border-cyan-100">
                        <label className="text-sm font-bold text-gray-600 block mb-2">{isHQ ? '׳©׳׳•׳× ׳—׳‘׳¨׳™ ׳׳˜׳” ׳ ׳•׳¡׳₪׳™׳' : '׳©׳׳•׳× ׳¨׳›׳–׳™׳ ׳ ׳•׳¡׳₪׳™׳ ׳‘׳¡׳ ׳™׳£'}</label>
                        <textarea 
                            className="w-full p-4 rounded-xl bg-white border border-gray-200 outline-none focus:border-[#00BCD4] min-h-[80px] resize-none text-sm font-medium"
                            placeholder="׳”׳–׳ ׳©׳׳•׳× ׳׳•׳₪׳¨׳“׳™׳ ׳‘׳₪׳¡׳™׳§׳™׳..."
                            value={formData.additionalStaff}
                            onChange={e => setFormData({...formData, additionalStaff: e.target.value})}
                        ></textarea>
                    </div>
                </div>

                <div className="mt-10 flex items-center justify-end gap-4">
                    {successMsg && <div className="text-[#8BC34A] font-bold text-sm flex items-center gap-2 animate-fadeIn bg-green-50 px-4 py-2 rounded-xl"><CheckCircle size={18}/> {successMsg}</div>}
                    <Button onClick={handleSave} isLoading={saving} variant="secondary" className="w-full md:w-auto px-12 shadow-xl shadow-green-100" icon={<Save size={20}/>}>׳©׳׳•׳¨ ׳©׳™׳ ׳•׳™׳™׳</Button>
                </div>
            </section>
        </div>
      </div>
    </>
  )
}

==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\dashboard\trip\[id]\page.tsx
==========================================
"use client"

import React, { useState, useEffect, use } from 'react' // ׳”׳•׳¡׳₪׳× use
import { createClient } from '@supabase/supabase-js'
import { ArrowRight, Calendar, MapPin, CheckCircle, XCircle, Clock, AlertTriangle, FileText, Link as LinkIcon } from 'lucide-react'

const supabaseUrl = "https://ehndiifaaobawrnlcqld.supabase.co";
const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVobmRpaWZhYW9iYXdybmxjcWxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzMzY5NzAsImV4cCI6MjA4MzkxMjk3MH0.RjmlRJWHq7UXohiHPVk-Aeu34eneS5e_uBLnbA9-2X4";
const supabase = createClient(supabaseUrl, supabaseAnonKey);

export default function TripViewPage({ params }: { params: Promise<{ id: string }> }) {
  const { id } = use(params); // ׳₪׳×׳™׳—׳× ׳”׳₪׳¨׳׳˜׳¨׳™׳

  const [trip, setTrip] = useState<any>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchTrip = async () => {
      const { data, error } = await supabase
        .from('trips')
        .select('*')
        .eq('id', id)
        .single();
        
      if (error) {
        alert('׳˜׳™׳•׳ ׳׳ ׳ ׳׳¦׳');
        window.location.href = '/dashboard';
        return;
      }
      setTrip(data);
      setLoading(false);
    };
    
    if (id) fetchTrip();
  }, [id]);

  if (loading) return <div className="min-h-screen flex items-center justify-center"><div className="animate-spin h-10 w-10 border-4 border-[#00BCD4] rounded-full"></div></div>;

  const details = trip.details || {};
  const timeline = details.timeline || [];

  return (
    <div className="min-h-screen bg-[#F5F5F5] font-sans text-gray-800 pb-20" dir="rtl">
      <header className="bg-white shadow-sm sticky top-0 z-30 border-b-4 border-[#00BCD4]">
        <div className="max-w-5xl mx-auto px-6 h-16 flex items-center justify-between">
          <div className="flex items-center gap-4">
            <button onClick={() => window.history.back()} className="hover:bg-gray-100 p-2 rounded-full transition-colors"><ArrowRight size={20} /></button>
            <h1 className="font-bold text-lg">׳¦׳₪׳™׳™׳” ׳‘׳˜׳™׳•׳: {trip.name}</h1>
          </div>
          <div className={`px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1.5 
            ${trip.status === 'approved' ? 'bg-green-100 text-green-700' : trip.status === 'rejected' ? 'bg-red-100 text-red-700' : 'bg-orange-100 text-orange-700'}`}>
            {trip.status === 'approved' ? <CheckCircle size={14}/> : trip.status === 'rejected' ? <XCircle size={14}/> : <Clock size={14}/>}
            {trip.status === 'approved' ? '׳׳׳•׳©׳¨' : trip.status === 'rejected' ? '׳ ׳“׳—׳”' : '׳׳׳×׳™׳ ׳׳‘׳“׳™׳§׳”'}
          </div>
        </div>
      </header>

      <main className="max-w-5xl mx-auto p-6 space-y-6">
        <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
            <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
              <div><span className="text-xs font-bold text-gray-400 block mb-1">׳×׳׳¨׳™׳›׳™׳</span><div className="font-bold">{details.startDate} - {details.endDate}</div></div>
              <div><span className="text-xs font-bold text-gray-400 block mb-1">׳׳©׳×׳×׳₪׳™׳</span><div className="font-bold">{details.totalTravelers} (׳׳×׳•׳›׳ {details.chanichimCount} ׳—׳ ׳™׳›׳™׳)</div></div>
              <div><span className="text-xs font-bold text-gray-400 block mb-1">׳’׳™׳׳׳™׳</span><div className="font-bold">{details.gradeFrom} - {details.gradeTo}</div></div>
              <div><span className="text-xs font-bold text-gray-400 block mb-1">׳¡׳˜׳˜׳•׳¡</span><div className="font-bold">{trip.status === 'pending' ? '׳׳׳×׳™׳ ׳׳׳™׳©׳•׳¨' : trip.status === 'approved' ? '׳׳•׳©׳¨ ׳׳‘׳™׳¦׳•׳¢' : '׳׳ ׳׳•׳©׳¨'}</div></div>
            </div>
            {details.generalComments && <div className="mt-4 pt-4 border-t"><span className="text-xs font-bold text-gray-400 block mb-1">׳”׳¢׳¨׳•׳× ׳›׳׳׳™׳•׳×</span><p className="text-sm">{details.generalComments}</p></div>}
        </div>

        <section>
          <h3 className="text-xl font-black text-gray-800 mb-4">׳׳•"׳– ׳•׳₪׳¢׳™׳׳•׳™׳•׳×</h3>
          <div className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden divide-y divide-gray-100">
             {timeline.map((item: any, idx: number) => (
                   <div key={idx} className="p-5">
                      <div className="flex items-start gap-4">
                         <div className="bg-gray-100 text-gray-600 font-bold px-3 py-1 rounded-lg text-sm min-w-[60px] text-center mt-1">{item.date?.split('-').slice(1).reverse().join('/')}</div>
                         <div className="flex-1">
                            <div className="flex justify-between">
                               <h4 className="font-bold text-gray-900 text-lg">{item.finalSubCategory}</h4>
                               {item.requiresLicense && <span className="bg-orange-50 text-orange-700 px-2 py-0.5 rounded text-xs font-bold">׳“׳•׳¨׳© ׳¨׳™׳©׳•׳™</span>}
                            </div>
                            <div className="flex items-center gap-4 mt-1 text-sm text-gray-500">
                               <span className="flex items-center gap-1"><MapPin size={14} className="text-[#00BCD4]"/> {item.finalLocation}</span>
                               <span className="text-gray-400">{item.category}</span>
                            </div>
                            {item.details && <div className="mt-2 text-sm text-gray-600 bg-gray-50 p-2 rounded">{item.details}</div>}
                            {item.files && (
                              <a href={item.files.url} target="_blank" className="mt-2 inline-flex items-center gap-1 text-xs font-bold text-[#00BCD4] hover:underline">
                                <LinkIcon size={12}/> ׳¦׳₪׳™׳™׳” ׳‘׳§׳•׳‘׳¥ ׳׳¦׳•׳¨׳£ ({item.files.name})
                              </a>
                            )}
                         </div>
                      </div>
                   </div>
             ))}
          </div>
        </section>
      </main>
    </div>
  )
}

==========================================
FILE: layout.tsx
PATH: C:\Users\User\chabad-trips\app\dashboard\layout.tsx
==========================================
import React from 'react';
import { Sidebar } from '@/components/layout/Sidebar';

export default function DashboardLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="min-h-screen bg-[#F8F9FA] dir-rtl">
      {/* ׳”׳¡׳¨׳’׳ ׳”׳׳§׳•׳‘׳¢ */}
      <Sidebar />
      
      {/* ׳”׳×׳™׳§׳•׳ ׳”׳—׳©׳•׳‘: mr-64 
         ׳–׳” ׳“׳•׳—׳£ ׳׳× ׳›׳ ׳”׳×׳•׳›׳ ׳©׳׳׳׳” ׳‘׳¨׳•׳—׳‘ ׳”׳¡׳¨׳’׳ (256px), 
         ׳›׳ ׳©׳”׳ ׳׳ ׳™׳¢׳׳• ׳׳—׳“ ׳¢׳ ׳”׳©׳ ׳™.
      */}
      <div className="mr-64 transition-all duration-300">
        {children}
      </div>
    </div>
  );
}

==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\dashboard\page.tsx
==========================================
"use client"

import React, { useState, useEffect } from 'react'
import { supabase } from '@/lib/supabaseClient'
import { Header } from '@/components/layout/Header'
import { Button } from '@/components/ui/Button'
import { Input } from '@/components/ui/Input'
import { 
  Loader2, Clock, X, CheckCircle, Search, Calendar as CalendarIcon,
  MapPin, ShieldAlert, Sun, ArrowRight, User, Layout, Archive
} from 'lucide-react'

// --- ׳¢׳–׳¨׳™׳ ׳׳•׳’׳™׳™׳ ---
const getHebrewDateSimple = (dateString: string) => {
    if (!dateString) return '';
    try {
        return new Intl.DateTimeFormat('he-IL', { calendar: 'hebrew', day: 'numeric', month: 'long' }).format(new Date(dateString));
    } catch (e) { return ''; }
};

export default function DashboardPage() {
  const [user, setUser] = useState<any>(null);
  const [loading, setLoading] = useState(true);
  const [trips, setTrips] = useState<any[]>([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [activeFilter, setActiveFilter] = useState('all');

  // ׳˜׳¢׳™׳ ׳× ׳ ׳×׳•׳ ׳™׳
  useEffect(() => {
    const fetchData = async () => {
        setLoading(true);
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) { window.location.href = '/'; return; }
        setUser(user);

        try {
            const { data, error } = await supabase
                .from('trips')
                .select('*')
                .eq('user_id', user.id)
                .order('start_date', { ascending: false });
            if (error) throw error;
            setTrips(data || []);
        } catch (e) { console.error('Error fetching trips:', e); } 
        finally { setLoading(false); }
    };
    fetchData();
  }, []);

  const getStatusBadge = (status: string) => {
      const styles = {
          approved: "bg-green-50 text-green-700 border-green-200",
          pending: "bg-yellow-50 text-yellow-700 border-yellow-200",
          rejected: "bg-red-50 text-red-700 border-red-200"
      };
      const icons = {
          approved: <CheckCircle size={14}/>,
          pending: <Clock size={14}/>,
          rejected: <X size={14}/>
      };
      const labels = { approved: '׳׳•׳©׳¨', pending: '׳‘׳‘׳“׳™׳§׳”', rejected: '׳ ׳“׳—׳”' };
      
      // @ts-ignore
      return <span className={`px-3 py-1 rounded-lg text-xs font-bold flex items-center gap-1.5 border ${styles[status]}`}>{icons[status]} {labels[status]}</span>;
  };

  if (loading) return <div className="h-screen flex items-center justify-center"><Loader2 className="animate-spin text-[#00BCD4]" size={40}/></div>;

  // ׳—׳™׳©׳•׳‘׳™׳ ׳׳×׳¦׳•׳’׳”
  const today = new Date().toISOString().split('T')[0];
  const upcomingTrip = trips.filter(t => t.start_date >= today).sort((a,b) => a.start_date.localeCompare(b.start_date))[0];
  const displayTrips = trips.filter(t => {
      const matchesFilter = activeFilter === 'all' || t.status === activeFilter;
      const matchesSearch = t.name.toLowerCase().includes(searchTerm.toLowerCase());
      return matchesFilter && matchesSearch;
  });

  return (
    <>
      <Header title={`׳©׳׳•׳, ${user?.user_metadata?.full_name?.split(' ')[0]}`} />

      <div className="max-w-6xl mx-auto p-6 space-y-6 animate-fadeIn pb-32">
          
          {/* ׳©׳•׳¨׳× ׳¡׳˜׳˜׳•׳¡׳™׳ ׳§׳•׳׳₪׳§׳˜׳™׳× */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              {/* ׳›׳¨׳˜׳™׳¡ ׳”׳˜׳™׳•׳ ׳”׳‘׳ */}
              <div className="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm relative overflow-hidden group">
                  <div className="relative z-10">
                      <div className="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2">׳”׳₪׳¢׳™׳׳•׳× ׳”׳‘׳׳”</div>
                      {upcomingTrip ? (
                          <>
                            <h3 className="text-xl font-bold text-gray-800 truncate mb-1">{upcomingTrip.name}</h3>
                            <div className="flex items-center gap-2 text-sm text-gray-500 font-medium">
                                <Clock size={14} className="text-[#E91E63]"/>
                                <span>{new Date(upcomingTrip.start_date).toLocaleDateString('he-IL')}</span>
                            </div>
                          </>
                      ) : <div className="text-gray-400 font-medium text-sm">׳׳™׳ ׳₪׳¢׳™׳׳•׳™׳•׳× ׳׳×׳•׳›׳ ׳ ׳•׳× ׳‘׳§׳¨׳•׳‘</div>}
                  </div>
                  <div className="w-24 h-24 bg-[#E91E63]/5 rounded-full absolute -bottom-8 -left-8"></div>
              </div>

              {/* ׳›׳¨׳˜׳™׳¡ ׳—׳“׳¨ ׳׳¦׳‘ */}
              <div className="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm flex items-start gap-4">
                  <div className="w-10 h-10 bg-red-50 rounded-xl flex items-center justify-center text-red-500 shrink-0"><ShieldAlert size={20}/></div>
                  <div>
                      <h3 className="text-sm font-bold text-gray-800 mb-1">׳—׳“׳¨ ׳׳¦׳‘</h3>
                      <p className="text-xs text-gray-500 leading-relaxed">׳׳™׳ ׳”׳×׳¨׳׳•׳× ׳—׳¨׳™׳’׳•׳× ׳׳”׳™׳•׳. ׳ ׳™׳×׳ ׳׳§׳™׳™׳ ׳₪׳¢׳™׳׳•׳× ׳›׳¡׳“׳¨׳”.</p>
                  </div>
              </div>

              {/* ׳›׳¨׳˜׳™׳¡ ׳׳–׳’ ׳׳•׳•׳™׳¨ */}
              <div className="bg-gradient-to-br from-[#00BCD4] to-cyan-600 p-6 rounded-2xl text-white shadow-lg shadow-cyan-100 flex items-center justify-between relative overflow-hidden">
                  <div className="relative z-10">
                      <div className="text-xs font-bold opacity-80 mb-1">׳×׳—׳–׳™׳× ׳׳”׳™׳•׳</div>
                      <div className="text-3xl font-bold">24ֲ°C</div>
                      <div className="text-sm opacity-90">׳™׳¨׳•׳©׳׳™׳ ג€¢ ׳©׳׳©׳™</div>
                  </div>
                  <Sun size={80} className="absolute -bottom-4 -left-4 text-white opacity-20"/>
              </div>
          </div>

          {/* ׳׳–׳•׳¨ ׳”׳˜׳™׳•׳׳™׳ */}
          <div className="space-y-4">
              <div className="flex flex-col md:flex-row justify-between items-end gap-4">
                  <div className="flex gap-2 bg-gray-100 p-1 rounded-xl">
                      {['all', 'approved', 'pending', 'rejected'].map(f => {
                          const labels: any = { all: '׳”׳›׳', approved: '׳׳•׳©׳¨', pending: '׳‘׳‘׳“׳™׳§׳”', rejected: '׳ ׳“׳—׳”' };
                          return (
                            <button key={f} onClick={() => setActiveFilter(f)} 
                                className={`px-4 py-2 rounded-lg text-xs font-bold transition-all ${activeFilter === f ? 'bg-white text-[#00BCD4] shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}>
                                {labels[f]}
                            </button>
                          )
                      })}
                  </div>

                  <div className="relative w-full md:w-64">
                      <input 
                        type="text" 
                        placeholder="׳—׳™׳₪׳•׳©..." 
                        value={searchTerm} 
                        onChange={e => setSearchTerm(e.target.value)} 
                        className="w-full pl-4 pr-10 py-2.5 bg-white border border-gray-200 rounded-xl text-sm font-bold focus:border-[#00BCD4] outline-none transition-all"
                      />
                      <Search className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400" size={16}/>
                  </div>
              </div>

              {/* ׳¨׳©׳™׳׳× ׳”׳˜׳™׳•׳׳™׳ - ׳¢׳™׳¦׳•׳‘ ׳©׳•׳¨׳•׳× ׳§׳•׳׳₪׳§׳˜׳™ */}
              <div className="grid grid-cols-1 gap-3">
                  {displayTrips.length === 0 ? (
                      <div className="py-16 text-center bg-white rounded-2xl border border-dashed border-gray-200">
                          <span className="text-gray-300 font-bold">׳׳ ׳ ׳׳¦׳׳• ׳˜׳™׳•׳׳™׳</span>
                      </div>
                  ) : displayTrips.map(trip => (
                      <div key={trip.id} className="bg-white border border-gray-200 rounded-2xl p-4 hover:border-[#00BCD4] transition-all group flex flex-col md:flex-row items-center gap-4">
                          
                          {/* ׳×׳׳¨׳™׳ */}
                          <div className="flex flex-row md:flex-col items-center justify-center bg-gray-50 rounded-xl px-4 py-2 md:w-20 md:h-20 shrink-0 gap-2 md:gap-0 border border-gray-100">
                              <span className="text-xl font-bold text-gray-800">{trip.start_date.split('-')[2]}</span>
                              <span className="text-[10px] font-bold text-gray-400 uppercase">{new Date(trip.start_date).toLocaleString('en-US', { month: 'short' })}</span>
                          </div>

                          {/* ׳₪׳¨׳˜׳™׳ */}
                          <div className="flex-1 w-full text-center md:text-right">
                              <div className="flex justify-center md:justify-start items-center gap-2 mb-1">
                                  {getStatusBadge(trip.status)}
                                  <span className="text-[10px] font-bold text-gray-400 bg-gray-50 px-2 py-0.5 rounded border border-gray-100">{trip.details.tripType}</span>
                              </div>
                              <h3 className="text-lg font-bold text-gray-800 group-hover:text-[#00BCD4] transition-colors">{trip.name}</h3>
                              <div className="flex justify-center md:justify-start items-center gap-3 text-xs font-medium text-gray-500 mt-1">
                                  <span className="flex items-center gap-1"><MapPin size={12}/> {trip.details.timeline?.[0]?.finalLocation || '׳׳™׳§׳•׳ ׳׳ ׳”׳•׳’׳“׳¨'}</span>
                                  <span className="text-gray-300">ג€¢</span>
                                  <span>{getHebrewDateSimple(trip.start_date)}</span>
                              </div>
                          </div>

                          {/* ׳›׳₪׳×׳•׳¨ ׳₪׳¢׳•׳׳” */}
                          <div className="w-full md:w-auto">
                              <Button variant="ghost" className="w-full md:w-auto bg-gray-50 hover:bg-[#E0F7FA] text-[#00BCD4] rounded-xl h-10 px-4" icon={<ArrowRight size={18}/>}>
                                  ׳₪׳¨׳˜׳™׳
                              </Button>
                          </div>
                      </div>
                  ))}
              </div>
          </div>
      </div>
    </>
  )
}

==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\manager\approvals\[id]\page.tsx
==========================================
"use client"

import React, { useState, useEffect } from 'react'
import { useParams, useRouter } from 'next/navigation'
import { supabase } from '@/lib/supabaseClient'
import { Button } from '@/components/ui/Button'
import { 
  Loader2, ArrowRight, MapPin, Calendar, User, FileText, CheckCircle, XCircle, AlertTriangle, Send
} from 'lucide-react'
import Link from 'next/link'

export default function TripActionPage() {
  const { id } = useParams();
  const router = useRouter();
  
  const [trip, setTrip] = useState<any>(null);
  const [loading, setLoading] = useState(true);
  const [processing, setProcessing] = useState(false);
  
  // ׳ ׳™׳”׳•׳ ׳˜׳•׳₪׳¡ ׳“׳—׳™׳™׳”/׳”׳¢׳¨׳”
  const [actionType, setActionType] = useState<'approve' | 'reject' | null>(null);
  const [adminNote, setAdminNote] = useState('');

  useEffect(() => {
    const fetchTrip = async () => {
      const { data, error } = await supabase
        .from('trips')
        .select('*')
        .eq('id', id)
        .single();

      if (data) setTrip(data);
      setLoading(false);
    };
    fetchTrip();
  }, [id]);

  // ׳₪׳•׳ ׳§׳¦׳™׳™׳× ׳”׳׳™׳©׳•׳¨/׳“׳—׳™׳™׳”
  const handleAction = async () => {
    if (!actionType) return;
    if (actionType === 'reject' && !adminNote) return alert('׳—׳•׳‘׳” ׳׳›׳×׳•׳‘ ׳¡׳™׳‘׳× ׳“׳—׳™׳™׳”');

    setProcessing(true);

    try {
        const newStatus = actionType === 'approve' ? 'approved' : 'rejected';
        
        // 1. ׳¢׳“׳›׳•׳ ׳¡׳˜׳˜׳•׳¡ ׳”׳˜׳™׳•׳
        const { error: tripError } = await supabase
            .from('trips')
            .update({ status: newStatus })
            .eq('id', id);
        
        if (tripError) throw tripError;

        // 2. ׳©׳׳™׳—׳× ׳”׳×׳¨׳׳” ׳׳¨׳›׳– (Notification)
        const title = actionType === 'approve' ? '׳”׳˜׳™׳•׳ ׳©׳׳ ׳׳•׳©׳¨! נ‰' : '׳”׳˜׳™׳•׳ ׳׳ ׳׳•׳©׳¨ ג ן¸';
        const message = actionType === 'approve' 
            ? `׳©׳׳—׳™׳ ׳׳‘׳©׳¨ ׳›׳™ ׳”׳˜׳™׳•׳ "${trip.name}" ׳׳•׳©׳¨. ${adminNote ? `׳”׳¢׳¨׳•׳× ׳”׳׳˜׳”: ${adminNote}` : ''}`
            : `׳”׳˜׳™׳•׳ "${trip.name}" ׳׳ ׳׳•׳©׳¨. ׳¡׳™׳‘׳”: ${adminNote}`;

        await supabase.from('notifications').insert([{
            user_id: trip.user_id, // ׳©׳•׳׳—׳™׳ ׳׳׳™ ׳©׳™׳¦׳¨ ׳׳× ׳”׳˜׳™׳•׳
            title: title,
            message: message,
            type: actionType === 'approve' ? 'success' : 'error',
            link: `/dashboard/my-trips` // ׳§׳™׳©׳•׳¨ ׳׳¦׳₪׳™׳™׳” ׳‘׳˜׳™׳•׳
        }]);

        alert('׳”׳₪׳¢׳•׳׳” ׳‘׳•׳¦׳¢׳” ׳‘׳”׳¦׳׳—׳” ׳•׳”׳•׳“׳¢׳” ׳ ׳©׳׳—׳” ׳׳¨׳›׳–.');
        router.push('/manager/approvals'); // ׳—׳–׳¨׳” ׳׳˜׳‘׳׳”

    } catch (error: any) {
        alert('׳©׳’׳™׳׳”: ' + error.message);
    } finally {
        setProcessing(false);
    }
  };

  if (loading) return <div className="h-screen flex items-center justify-center"><Loader2 className="animate-spin"/></div>;
  if (!trip) return <div className="p-10">׳˜׳™׳•׳ ׳׳ ׳ ׳׳¦׳</div>;

  return (
    <div className="p-8 max-w-5xl mx-auto animate-fadeIn pb-32">
        
        {/* ׳›׳₪׳×׳•׳¨ ׳—׳–׳¨׳” */}
        <Link href="/manager/approvals" className="flex items-center gap-2 text-gray-500 hover:text-gray-800 mb-6 font-bold w-fit">
            <ArrowRight size={20}/> ׳—׳–׳¨׳” ׳׳¨׳©׳™׳׳”
        </Link>

        {/* ׳›׳•׳×׳¨׳× ׳¨׳׳©׳™׳× */}
        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
            <div>
                <h1 className="text-3xl font-black text-gray-800">{trip.name}</h1>
                <div className="flex items-center gap-2 text-gray-500 mt-2">
                    <User size={16}/> ׳”׳•׳’׳© ׳¢"׳™: <b>{trip.coordinator_name}</b> ({trip.branch})
                </div>
            </div>
            <div className={`px-4 py-2 rounded-xl text-sm font-bold border 
                ${trip.status === 'pending' ? 'bg-orange-50 text-orange-600 border-orange-200' : 
                  trip.status === 'approved' ? 'bg-green-50 text-green-600 border-green-200' : 'bg-red-50 text-red-600 border-red-200'}`}>
                ׳¡׳˜׳˜׳•׳¡ ׳ ׳•׳›׳—׳™: {trip.status === 'pending' ? '׳׳׳×׳™׳ ׳׳‘׳“׳™׳§׳”' : trip.status === 'approved' ? '׳׳•׳©׳¨' : '׳ ׳“׳—׳”'}
            </div>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            {/* ׳¦׳“ ׳™׳׳™׳: ׳₪׳¨׳˜׳™ ׳”׳˜׳™׳•׳ */}
            <div className="lg:col-span-2 space-y-6">
                
                {/* ׳§׳•׳‘׳™׳™׳× ׳₪׳¨׳˜׳™׳ */}
                <div className="bg-white p-6 rounded-3xl border border-gray-200 shadow-sm">
                    <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <FileText size={20} className="text-[#00BCD4]"/> ׳₪׳¨׳˜׳™ ׳”׳‘׳§׳©׳”
                    </h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label className="text-xs font-bold text-gray-400">׳×׳׳¨׳™׳ ׳™׳¦׳™׳׳”</label>
                            <div className="font-medium">{new Date(trip.start_date).toLocaleDateString('he-IL')}</div>
                        </div>
                        <div>
                            <label className="text-xs font-bold text-gray-400">׳™׳¢׳“ / ׳׳™׳§׳•׳</label>
                            <div className="font-medium">{trip.details?.timeline?.[0]?.finalLocation || '-'}</div>
                        </div>
                        <div>
                            <label className="text-xs font-bold text-gray-400">׳›׳׳•׳× ׳׳©׳×׳×׳₪׳™׳ ׳¦׳₪׳•׳™׳”</label>
                            <div className="font-medium">{trip.details?.participantsCount || '-'}</div>
                        </div>
                        <div>
                            <label className="text-xs font-bold text-gray-400">׳׳—׳¨׳׳™ ׳‘׳©׳˜׳—</label>
                            <div className="font-medium">{trip.details?.fieldContactName || '-'}</div>
                        </div>
                    </div>
                    
                    {/* ׳×׳™׳׳•׳¨ */}
                    <div className="mt-6 pt-6 border-t border-gray-100">
                         <label className="text-xs font-bold text-gray-400">׳×׳™׳׳•׳¨ ׳”׳₪׳¢׳™׳׳•׳× ׳•׳׳•"׳–</label>
                         <p className="text-sm text-gray-700 mt-2 leading-relaxed whitespace-pre-line">
                             {trip.details?.description || '׳׳™׳ ׳×׳™׳׳•׳¨ ׳ ׳•׳¡׳£'}
                         </p>
                    </div>
                </div>

                {/* ׳§׳‘׳¦׳™׳ ׳׳¦׳•׳¨׳₪׳™׳ */}
                {/* ׳›׳׳ ׳׳₪׳©׳¨ ׳׳”׳•׳¡׳™׳£ ׳¨׳©׳™׳׳× ׳§׳‘׳¦׳™׳ ׳׳”׳•׳¨׳“׳” ׳׳ ׳©׳׳¨׳ ׳• ׳׳•׳×׳ ׳‘׳׳¢׳¨׳ ׳‘-details */}
            </div>

            {/* ׳¦׳“ ׳©׳׳׳: ׳₪׳¢׳•׳׳•׳× ׳ ׳™׳”׳•׳ */}
            <div className="lg:col-span-1">
                <div className="bg-white p-6 rounded-3xl border border-gray-200 shadow-md sticky top-10">
                    <h3 className="text-lg font-bold text-gray-800 mb-6">׳‘׳™׳¦׳•׳¢ ׳₪׳¢׳•׳׳”</h3>
                    
                    {/* ׳׳ ׳”׳˜׳™׳•׳ ׳˜׳¨׳ ׳˜׳•׳₪׳ ׳׳• ׳©׳¨׳•׳¦׳™׳ ׳׳©׳ ׳•׳× ׳”׳—׳׳˜׳” */}
                    <div className="space-y-4">
                        <button 
                            onClick={() => setActionType('approve')}
                            className={`w-full py-4 rounded-xl border-2 font-bold flex items-center justify-center gap-2 transition-all
                            ${actionType === 'approve' 
                                ? 'border-green-500 bg-green-50 text-green-700' 
                                : 'border-gray-100 text-gray-500 hover:border-green-200 hover:text-green-600'}`}
                        >
                            <CheckCircle size={20}/> ׳׳©׳¨ ׳˜׳™׳•׳
                        </button>
                        
                        <button 
                            onClick={() => setActionType('reject')}
                            className={`w-full py-4 rounded-xl border-2 font-bold flex items-center justify-center gap-2 transition-all
                            ${actionType === 'reject' 
                                ? 'border-red-500 bg-red-50 text-red-700' 
                                : 'border-gray-100 text-gray-500 hover:border-red-200 hover:text-red-600'}`}
                        >
                            <XCircle size={20}/> ׳“׳—׳” ׳‘׳§׳©׳”
                        </button>
                    </div>

                    {/* ׳׳–׳•׳¨ ׳”׳¢׳¨׳•׳× (׳׳•׳₪׳™׳¢ ׳¨׳§ ׳›׳©׳‘׳•׳—׳¨׳™׳ ׳₪׳¢׳•׳׳”) */}
                    {actionType && (
                        <div className="mt-6 animate-fadeIn">
                            <label className="text-xs font-bold text-gray-500 mb-2 block">
                                {actionType === 'approve' ? '׳”׳¢׳¨׳•׳× ׳ ׳•׳¡׳₪׳•׳× ׳׳¨׳›׳– (׳׳•׳₪׳¦׳™׳•׳ ׳׳™)' : '׳¡׳™׳‘׳× ׳”׳“׳—׳™׳™׳” (׳—׳•׳‘׳”)'}
                            </label>
                            <textarea 
                                className="w-full p-3 rounded-xl border border-gray-300 text-sm min-h-[100px] outline-none focus:border-gray-800"
                                placeholder={actionType === 'approve' ? "׳׳׳©׳: ׳×׳”׳ ׳•! ׳ ׳ ׳׳©׳׳•׳— ׳×׳׳•׳ ׳•׳×." : "׳₪׳¨׳˜ ׳׳” ׳—׳¡׳¨ ׳׳• ׳׳׳” ׳”׳˜׳™׳•׳ ׳ ׳“׳—׳”..."}
                                value={adminNote}
                                onChange={e => setAdminNote(e.target.value)}
                            ></textarea>

                            <Button 
                                onClick={handleAction} 
                                isLoading={processing}
                                className={`w-full mt-4 shadow-lg ${actionType === 'approve' ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'}`}
                                icon={<Send size={18}/>}
                            >
                                {actionType === 'approve' ? '׳©׳׳— ׳׳™׳©׳•׳¨' : '׳©׳׳— ׳“׳—׳™׳™׳”'}
                            </Button>
                        </div>
                    )}
                </div>
            </div>
        </div>
    </div>
  )
}

==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\manager\approvals\page.tsx
==========================================
"use client"

import React, { useState, useEffect } from 'react'
import { supabase } from '@/lib/supabaseClient'
import { ManagerHeader } from '@/components/layout/ManagerHeader'
import { Loader2, MapPin, Search, Eye } from 'lucide-react'
import Link from 'next/link'
import { Input } from '@/components/ui/Input'

export default function ApprovalsPage() {
  const [loading, setLoading] = useState(true);
  const [trips, setTrips] = useState<any[]>([]);
  const [filter, setFilter] = useState('pending');
  const [searchTerm, setSearchTerm] = useState('');

  useEffect(() => {
    fetchTrips();
  }, []);

  const fetchTrips = async () => {
    const { data } = await supabase
      .from('trips')
      .select('*')
      .order('created_at', { ascending: false });

    if (data) setTrips(data);
    setLoading(false);
  };

  const filteredTrips = trips.filter(trip => {
      const matchesStatus = filter === 'all' ? true : trip.status === filter;
      const matchesSearch = trip.name?.includes(searchTerm) || 
                            trip.branch?.includes(searchTerm) || 
                            trip.coordinator_name?.includes(searchTerm);
      return matchesStatus && matchesSearch;
  });

  const getStatusBadge = (status: string) => {
      const styles: any = {
          approved: "bg-green-100 text-green-700 border-green-200",
          pending: "bg-orange-100 text-orange-700 border-orange-200",
          rejected: "bg-red-100 text-red-700 border-red-200"
      };
      const labels: any = { approved: '׳׳•׳©׳¨', pending: '׳׳׳×׳™׳', rejected: '׳ ׳“׳—׳”' };
      return (
          <span className={`px-3 py-1 rounded-full text-xs font-bold border ${styles[status] || styles.pending}`}>
              {labels[status]}
          </span>
      );
  };

  if (loading) return <div className="h-screen flex items-center justify-center"><Loader2 className="animate-spin text-gray-400"/></div>;

  return (
    <>
        <ManagerHeader title="׳׳™׳©׳•׳¨ ׳•׳‘׳§׳¨׳× ׳˜׳™׳•׳׳™׳" />

        <div className="p-8 animate-fadeIn pb-32">
            
            <div className="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
                <div className="flex bg-white p-1 rounded-xl border border-gray-200 shadow-sm">
                    {['pending', 'approved', 'rejected', 'all'].map((f) => (
                        <button
                            key={f}
                            onClick={() => setFilter(f)}
                            className={`px-4 py-2 rounded-lg text-sm font-bold transition-all
                            ${filter === f ? 'bg-gray-800 text-white shadow-md' : 'text-gray-500 hover:bg-gray-50'}`}
                        >
                            {f === 'pending' ? '׳׳׳×׳™׳ ׳™׳' : f === 'approved' ? '׳׳•׳©׳¨׳•' : f === 'rejected' ? '׳ ׳“׳—׳•' : '׳”׳›׳'}
                        </button>
                    ))}
                </div>

                <div className="relative w-full md:w-80">
                    <Input 
                        placeholder="׳—׳™׳₪׳•׳© ׳׳₪׳™ ׳©׳, ׳¡׳ ׳™׳£ ׳׳• ׳¨׳›׳–..." 
                        value={searchTerm}
                        onChange={e => setSearchTerm(e.target.value)}
                        icon={<Search size={18}/>}
                        className="bg-white"
                    />
                </div>
            </div>

            <div className="bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm">
                <div className="overflow-x-auto">
                    <table className="w-full text-right">
                        <thead className="bg-gray-50 border-b border-gray-100 text-gray-500 text-xs font-bold uppercase">
                            <tr>
                                <th className="p-5">׳©׳ ׳”׳˜׳™׳•׳</th>
                                <th className="p-5">׳¨׳›׳– / ׳¡׳ ׳™׳£</th>
                                <th className="p-5">׳×׳׳¨׳™׳›׳™׳</th>
                                <th className="p-5">׳¡׳˜׳˜׳•׳¡</th>
                                <th className="p-5 text-left">׳₪׳¢׳•׳׳•׳×</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-gray-50">
                            {filteredTrips.map((trip) => (
                                <tr key={trip.id} className="hover:bg-gray-50 transition-colors">
                                    <td className="p-5">
                                        <div className="font-bold text-gray-800">{trip.name}</div>
                                        <div className="text-xs text-gray-400 flex items-center gap-1 mt-1">
                                            <MapPin size={12}/> {trip.details?.timeline?.[0]?.finalLocation || '׳׳ ׳¦׳•׳™׳ ׳׳™׳§׳•׳'}
                                        </div>
                                    </td>
                                    <td className="p-5">
                                        <div className="flex items-center gap-2">
                                            <div className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 font-bold text-xs shrink-0">
                                                {trip.coordinator_name?.[0]}
                                            </div>
                                            <div>
                                                <div className="font-bold text-gray-700 text-sm">{trip.coordinator_name}</div>
                                                <div className="text-xs text-gray-400">{trip.branch}</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td className="p-5 text-sm font-medium text-gray-600">
                                        {new Date(trip.start_date).toLocaleDateString('he-IL')}
                                    </td>
                                    <td className="p-5">
                                        {getStatusBadge(trip.status)}
                                    </td>
                                    <td className="p-5 text-left">
                                        <Link href={`/manager/approvals/${trip.id}`}>
                                            <button className="bg-[#00BCD4] hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-md shadow-cyan-100 transition-all flex items-center gap-2 ml-auto">
                                                <Eye size={16}/> ׳¦׳₪׳” ׳•׳˜׳₪׳
                                            </button>
                                        </Link>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
                {filteredTrips.length === 0 && <div className="p-12 text-center text-gray-400 font-medium">׳׳ ׳ ׳׳¦׳׳• ׳˜׳™׳•׳׳™׳</div>}
            </div>
        </div>
    </>
  )
}

==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\manager\inbox\page.tsx
==========================================
"use client"

import React, { useState, useEffect } from 'react'
import { supabase } from '@/lib/supabaseClient'
import { ManagerHeader } from '@/components/layout/ManagerHeader'
import { Button } from '@/components/ui/Button'
import { Loader2, AlertTriangle, HelpCircle, CheckCircle, Bug, Reply, Send, X } from 'lucide-react'

export default function ManagerInbox() {
  const [loading, setLoading] = useState(true);
  const [messages, setMessages] = useState<any[]>([]);
  const [isSuperAdmin, setIsSuperAdmin] = useState(false);
  
  // ׳ ׳™׳”׳•׳ ׳×׳’׳•׳‘׳”
  const [replyingTo, setReplyingTo] = useState<string | null>(null);
  const [replyText, setReplyText] = useState('');
  const [sendingReply, setSendingReply] = useState(false);

  useEffect(() => {
    const init = async () => {
        // 1. ׳‘׳“׳™׳§׳× ׳׳ ׳”׳ ׳¢׳
        const { data: { user } } = await supabase.auth.getUser();
        
        // ---------------------------------------------------------
        // ׳—׳•׳‘׳” ׳׳©׳ ׳•׳× ׳›׳׳ ׳׳׳™׳׳™׳™׳ ׳©׳׳!
        const myEmail = 'avremihalperin@gmail.com'; 
        // ---------------------------------------------------------

        if (user?.email === myEmail) {
            setIsSuperAdmin(true);
        }

        // 2. ׳©׳׳™׳₪׳× ׳”׳•׳“׳¢׳•׳×
        fetchMessages();
    };
    init();
  }, []);

  const fetchMessages = async () => {
    const { data } = await supabase
      .from('contact_messages')
      .select('*, user:user_id ( email, raw_user_meta_data )') 
      .order('created_at', { ascending: false });
    
    if (data) setMessages(data);
    setLoading(false);
  };

  const markAsTreated = async (id: string) => {
      await supabase.from('contact_messages').update({ status: 'treated' }).eq('id', id);
      fetchMessages();
  };

  const sendReply = async (originalMsg: any) => {
      if (!replyText) return;
      setSendingReply(true);

      try {
          await supabase.from('notifications').insert([{
              user_id: originalMsg.user_id,
              title: `׳×׳©׳•׳‘׳” ׳׳₪׳ ׳™׳™׳×׳: ${originalMsg.subject}`,
              message: `׳׳˜׳” ׳‘׳˜׳™׳—׳•׳× ׳¢׳ ׳”:\n"${replyText}"`,
              type: 'info',
              link: '/dashboard/contact'
          }]);

          await markAsTreated(originalMsg.id);
          
          setReplyingTo(null);
          setReplyText('');
          alert('׳”׳×׳©׳•׳‘׳” ׳ ׳©׳׳—׳” ׳‘׳”׳¦׳׳—׳”!');

      } catch (e) {
          alert('׳©׳’׳™׳׳” ׳‘׳©׳׳™׳—׳”');
      } finally {
          setSendingReply(false);
      }
  };

  if (loading) return <div className="h-screen flex items-center justify-center"><Loader2 className="animate-spin text-gray-400"/></div>;

  return (
    <>
      <ManagerHeader title="׳“׳•׳׳¨ ׳ ׳›׳ ׳¡ ׳•׳”׳•׳“׳¢׳•׳×" />

      <div className="p-8 animate-fadeIn max-w-6xl mx-auto pb-32">
          
          <div className="bg-white rounded-3xl border border-gray-200 shadow-sm overflow-hidden">
              <div className="overflow-x-auto">
                <table className="w-full text-right">
                    <thead className="bg-gray-50 text-gray-500 text-xs font-bold uppercase border-b border-gray-100">
                        <tr>
                            <th className="p-5">׳ ׳•׳©׳</th>
                            <th className="p-5">׳׳׳×</th>
                            <th className="p-5">׳×׳•׳›׳</th>
                            <th className="p-5">׳¡׳˜׳˜׳•׳¡</th>
                            <th className="p-5 text-left">׳₪׳¢׳•׳׳•׳×</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-50">
                        {messages.map((msg) => {
                            const isBug = msg.subject?.includes('׳×׳§׳׳”') || msg.subject?.includes('׳‘׳׳’');
                            
                            // *** ׳›׳׳ ׳”׳¡׳™׳ ׳•׳ ׳”׳—׳›׳: ***
                            // ׳׳ ׳–׳” ׳‘׳׳’, ׳•׳׳ ׳™ ׳׳ ׳׳ ׳”׳ ׳¢׳ -> ׳׳ ׳×׳¦׳™׳’ ׳׳× ׳”׳©׳•׳¨׳” ׳”׳–׳• ׳‘׳›׳׳
                            if (isBug && !isSuperAdmin) return null;

                            const isReplying = replyingTo === msg.id;
                            const senderName = msg.user?.raw_user_meta_data?.full_name || '׳׳©׳×׳׳© ׳׳ ׳™׳“׳•׳¢';

                            return (
                                <React.Fragment key={msg.id}>
                                    <tr className={`transition-colors ${isReplying ? 'bg-blue-50' : 'hover:bg-gray-50'}`}>
                                        <td className="p-5 font-bold text-gray-800 flex items-center gap-2">
                                            {isBug ? <Bug size={16} className="text-red-500"/> : <HelpCircle size={16} className="text-blue-500"/>}
                                            {msg.subject}
                                        </td>
                                        <td className="p-5 text-sm text-gray-600">
                                            <div className="font-bold">{senderName}</div>
                                            <div className="text-xs text-gray-400">{new Date(msg.created_at).toLocaleDateString('he-IL')}</div>
                                        </td>
                                        <td className="p-5 text-sm text-gray-600 max-w-xs truncate cursor-pointer" title={msg.message} onClick={() => alert(msg.message)}>
                                            {msg.message}
                                        </td>
                                        <td className="p-5">
                                            {msg.status === 'treated' 
                                                ? <span className="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold border border-green-200">׳˜׳•׳₪׳</span>
                                                : <span className="bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-xs font-bold border border-yellow-200">׳—׳“׳©</span>
                                            }
                                        </td>
                                        <td className="p-5 text-left flex justify-end gap-2">
                                            {msg.status !== 'treated' && !isReplying && (
                                                <>
                                                    <button onClick={() => setReplyingTo(msg.id)} className="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-lg text-xs font-bold shadow-md transition-all flex items-center gap-1">
                                                        <Reply size={16}/> ׳¢׳ ׳”
                                                    </button>
                                                    <button onClick={() => markAsTreated(msg.id)} className="text-green-600 hover:bg-green-50 p-2 rounded-lg text-xs font-bold border border-transparent hover:border-green-200 transition-all">
                                                        <CheckCircle size={16}/>
                                                    </button>
                                                </>
                                            )}
                                        </td>
                                    </tr>
                                    
                                    {/* ׳©׳•׳¨׳× ׳×׳’׳•׳‘׳” ׳ ׳₪׳×׳—׳× */}
                                    {isReplying && (
                                        <tr className="bg-blue-50/50 animate-fadeIn">
                                            <td colSpan={5} className="p-5">
                                                <div className="bg-white border border-blue-100 rounded-xl p-4 shadow-sm max-w-2xl mr-auto">
                                                    <p className="text-xs font-bold text-blue-600 mb-2">׳×׳’׳•׳‘׳” ׳: {senderName}</p>
                                                    <textarea 
                                                        className="w-full p-3 border border-gray-200 rounded-lg text-sm focus:border-blue-500 outline-none"
                                                        placeholder="׳›׳×׳•׳‘ ׳׳× ׳×׳©׳•׳‘׳×׳ ׳›׳׳..."
                                                        rows={3}
                                                        value={replyText}
                                                        onChange={e => setReplyText(e.target.value)}
                                                    ></textarea>
                                                    <div className="flex justify-end gap-2 mt-2">
                                                        <Button variant="secondary" onClick={() => setReplyingTo(null)} className="bg-gray-200 text-gray-600 h-8 px-4"><X size={14}/></Button>
                                                        <Button onClick={() => sendReply(msg)} isLoading={sendingReply} icon={<Send size={14}/>} className="bg-blue-600 h-8 px-6 text-xs">׳©׳׳— ׳×׳©׳•׳‘׳” ׳•׳¡׳’׳•׳¨</Button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    )}
                                </React.Fragment>
                            )
                        })}
                    </tbody>
                </table>
              </div>
          </div>
      </div>
    </>
  )
}

==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\manager\profile\page.tsx
==========================================
"use client"

import React, { useState, useEffect } from 'react'
import { supabase } from '@/lib/supabaseClient'
import { ManagerHeader } from '@/components/layout/ManagerHeader'
import { Button } from '@/components/ui/Button'
import { Input } from '@/components/ui/Input'
import { Save, User, Mail, Lock, ShieldCheck, Camera, Loader2 } from 'lucide-react'

export default function ManagerProfile() {
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [uploading, setUploading] = useState(false);
  const [user, setUser] = useState<any>(null);

  const [formData, setFormData] = useState({
    officialName: '', // ׳©׳ ׳₪׳¨׳˜׳™ ׳׳₪׳™ ׳×"׳–
    lastName: '',
    idNumber: '', 
    birthDate: '',
    nickname: '',
    fullNameAndMother: '', // ׳”׳©׳“׳” ׳©׳”׳™׳” ׳—׳¡׳¨
    email: '',
    phone: '',
    profileImage: null as string | null
  });

  useEffect(() => {
    const getUser = async () => {
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        setUser(user);
        const meta = user.user_metadata || {};
        
        // ׳׳•׳’׳™׳§׳” ׳—׳›׳׳” ׳׳—׳™׳׳•׳¥ ׳×"׳–
        let extractedId = meta.id_number || '';
        if (!extractedId && user.email?.includes('@')) {
            const possibleId = user.email.split('@')[0];
            if (/^\d+$/.test(possibleId)) extractedId = possibleId;
        }

        // ׳׳•׳’׳™׳§׳” ׳—׳›׳׳” ׳׳—׳™׳׳•׳¥ ׳©׳ ׳₪׳¨׳˜׳™ ׳•׳׳©׳₪׳—׳” (׳׳׳§׳¨׳” ׳©׳”׳©׳“׳•׳× ׳”׳—׳“׳©׳™׳ ׳¨׳™׳§׳™׳)
        const fallbackFirstName = meta.full_name?.split(' ')[0] || '';
        const fallbackLastName = meta.full_name?.split(' ').slice(1).join(' ') || '';

        setFormData({
            officialName: meta.official_name || meta.first_name || fallbackFirstName,
            lastName: meta.last_name || fallbackLastName,
            idNumber: extractedId,
            birthDate: meta.birth_date || '', // ׳•׳•׳“׳ ׳©׳–׳” ׳§׳™׳™׳ ׳‘׳“׳׳˜׳” ׳‘׳™׳™׳¡, ׳׳—׳¨׳× ׳™׳™׳©׳׳¨ ׳¨׳™׳§
            nickname: meta.nickname || '',
            fullNameAndMother: meta.full_name_mother || '', // ׳˜׳¢׳™׳ ׳× ׳©׳ ׳”׳׳
            email: meta.contact_email || user.email || '',
            phone: meta.phone || '',
            profileImage: meta.avatar_url || null
        });
      }
      setLoading(false);
    };
    getUser();
  }, []);

  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    if (!e.target.files || !e.target.files[0]) return;
    const file = e.target.files[0];
    setUploading(true);

    try {
      const fileExt = file.name.split('.').pop();
      const fileName = `avatars/${user.id}_${Date.now()}.${fileExt}`;
      const { error } = await supabase.storage.from('trip-files').upload(fileName, file, { upsert: true });
      if (error) throw error;
      const { data } = supabase.storage.from('trip-files').getPublicUrl(fileName);
      setFormData(prev => ({ ...prev, profileImage: data.publicUrl }));
    } catch (error: any) {
      alert('׳©׳’׳™׳׳”: ' + error.message);
    } finally {
      setUploading(false);
    }
  };

  const handleSave = async () => {
      setSaving(true);
      
      // ׳©׳׳™׳¨׳” ׳©׳ ׳›׳ ׳”׳©׳“׳•׳× ׳‘׳¦׳•׳¨׳” ׳׳¡׳•׳“׳¨׳× ׳׳׳˜׳-׳“׳׳˜׳”
      const { error } = await supabase.auth.updateUser({
          data: { 
              official_name: formData.officialName,
              first_name: formData.officialName, // ׳©׳•׳׳¨׳™׳ ׳’׳ ׳•׳’׳ ׳׳™׳×׳¨ ׳‘׳™׳˜׳—׳•׳
              last_name: formData.lastName,
              nickname: formData.nickname,
              birth_date: formData.birthDate,
              full_name_mother: formData.fullNameAndMother, // ׳©׳׳™׳¨׳× ׳©׳ ׳”׳׳
              phone: formData.phone,
              contact_email: formData.email,
              avatar_url: formData.profileImage,
              // ׳׳¢׳“׳›׳ ׳™׳ ׳’׳ ׳׳× ׳”-full_name ׳”׳›׳׳׳™ ׳׳×׳¦׳•׳’׳” ׳™׳₪׳”
              full_name: `${formData.officialName} ${formData.lastName}`
          }
      });

      setSaving(false);
      
      if (error) {
          alert('׳©׳’׳™׳׳” ׳‘׳©׳׳™׳¨׳”: ' + error.message);
      } else {
          alert('׳”׳₪׳¨׳•׳₪׳™׳ ׳¢׳•׳“׳›׳ ׳‘׳”׳¦׳׳—׳”');
          window.location.reload(); // ׳¨׳¢׳ ׳•׳ ׳›׳“׳™ ׳׳¨׳׳•׳× ׳׳× ׳”׳©׳™׳ ׳•׳™׳™׳ ׳‘׳›׳•׳×׳¨׳× ׳”׳¢׳׳™׳•׳ ׳”
      }
  };

  if (loading) return <div className="h-screen flex items-center justify-center"><Loader2 className="animate-spin text-gray-400"/></div>;

  return (
    <>
      <ManagerHeader title="׳₪׳¨׳•׳₪׳™׳ ׳׳™׳©׳™ - ׳׳ ׳”׳" />
      
      <div className="p-8 max-w-5xl mx-auto pb-32 animate-fadeIn">
          
          {/* ׳›׳¨׳˜׳™׳¡ ׳¢׳׳™׳•׳ */}
          <div className="bg-white rounded-[32px] p-8 border border-gray-200 shadow-sm flex items-center gap-8 mb-8">
               <div className="relative group w-24 h-24">
                   <div className="w-full h-full bg-gray-800 rounded-3xl flex items-center justify-center text-white text-3xl font-bold overflow-hidden border-4 border-white shadow-lg">
                      {formData.profileImage ? (
                          <img src={formData.profileImage} className="w-full h-full object-cover"/>
                      ) : (
                          formData.officialName?.[0] || <User/>
                      )}
                   </div>
                   <label className="absolute inset-0 bg-black/50 rounded-3xl flex items-center justify-center opacity-0 group-hover:opacity-100 cursor-pointer transition-all text-white">
                       <Camera size={24}/>
                       <input type="file" className="hidden" onChange={handleImageUpload} disabled={uploading} />
                   </label>
               </div>
               <div>
                   <h2 className="text-3xl font-black text-gray-800">{formData.officialName} {formData.lastName}</h2>
                   <div className="flex items-center gap-2 text-gray-500 font-bold mt-1">
                       <ShieldCheck size={18} className="text-[#00BCD4]"/> ׳׳ ׳”׳ ׳׳¢׳¨׳›׳× ׳¨׳׳©׳™
                   </div>
               </div>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
              
              {/* ׳¦׳“ ׳™׳׳™׳: ׳ ׳×׳•׳ ׳™׳ ׳ ׳¢׳•׳׳™׳ (׳׳¢׳¨׳›׳×) */}
              <div className="bg-[#F1F8E9] p-6 rounded-3xl border border-green-100 h-fit">
                  <div className="flex items-center gap-2 mb-6 text-[#8BC34A] font-bold text-sm uppercase">
                      <Lock size={14}/> ׳₪׳¨׳˜׳™ ׳׳¢׳¨׳›׳×
                  </div>
                  <div className="space-y-4">
                      <div>
                          <label className="text-xs font-bold text-gray-400">׳©׳ ׳₪׳¨׳˜׳™ (׳¨׳©׳׳™)</label>
                          <div className="font-bold text-gray-800 text-lg border-b border-green-200/50 pb-1">{formData.officialName || '-'}</div>
                      </div>
                      <div>
                          <label className="text-xs font-bold text-gray-400">׳©׳ ׳׳©׳₪׳—׳”</label>
                          <div className="font-bold text-gray-800 text-lg border-b border-green-200/50 pb-1">{formData.lastName || '-'}</div>
                      </div>
                      <div>
                          <label className="text-xs font-bold text-gray-400">׳×׳¢׳•׳“׳× ׳–׳”׳•׳×</label>
                          <div className="font-bold text-gray-800 text-lg border-b border-green-200/50 pb-1 tracking-wider">{formData.idNumber || '-'}</div>
                      </div>
                      <div>
                          <label className="text-xs font-bold text-gray-400">׳×׳׳¨׳™׳ ׳׳™׳“׳”</label>
                          <div className="font-bold text-gray-800 text-lg border-b border-green-200/50 pb-1">{formData.birthDate || '-'}</div>
                      </div>
                  </div>
              </div>

              {/* ׳¦׳“ ׳©׳׳׳: ׳˜׳•׳₪׳¡ ׳¢׳¨׳™׳›׳” */}
              <div className="md:col-span-2 bg-white p-8 rounded-3xl border border-gray-200 shadow-sm">
                  <h3 className="text-xl font-bold text-gray-800 mb-6">׳¢׳“׳›׳•׳ ׳₪׳¨׳˜׳™׳</h3>
                  <div className="space-y-6">
                      
                      {/* ׳©׳•׳¨׳× ׳©׳׳•׳× ׳׳¢׳¨׳™׳›׳” */}
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                          <Input 
                            label="׳©׳ ׳₪׳¨׳˜׳™ (׳›׳₪׳™ ׳©׳׳•׳₪׳™׳¢ ׳‘׳×׳¢׳•׳“׳× ׳–׳”׳•׳×)" 
                            value={formData.officialName} 
                            onChange={e => setFormData({...formData, officialName: e.target.value})} 
                          />
                          <Input 
                            label="׳›׳™׳ ׳•׳™ / ׳©׳ ׳—׳™׳‘׳”" 
                            value={formData.nickname} 
                            onChange={e => setFormData({...formData, nickname: e.target.value})} 
                          />
                      </div>

                      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                          <Input 
                            label="׳©׳ ׳׳©׳₪׳—׳”" 
                            value={formData.lastName} 
                            onChange={e => setFormData({...formData, lastName: e.target.value})} 
                          />
                          <Input 
                            label="׳˜׳׳₪׳•׳ ׳ ׳™׳™׳“" 
                            value={formData.phone} 
                            onChange={e => setFormData({...formData, phone: e.target.value})} 
                          />
                      </div>

                      {/* ׳”׳©׳“׳” ׳”׳—׳“׳© ׳©׳‘׳™׳§׳©׳×! */}
                      <Input 
                        label="׳©׳ ׳׳׳ + ׳©׳ ׳”׳׳ (׳׳×׳₪׳™׳׳”)" 
                        value={formData.fullNameAndMother} 
                        onChange={e => setFormData({...formData, fullNameAndMother: e.target.value})} 
                        placeholder="׳׳“׳•׳’׳׳”: ׳™׳•׳¡׳£ ׳‘׳ ׳©׳¨׳”"
                      />

                      <Input 
                        label="׳׳™׳׳™׳™׳ ׳׳™׳¦׳™׳¨׳× ׳§׳©׳¨" 
                        value={formData.email} 
                        onChange={e => setFormData({...formData, email: e.target.value})} 
                        icon={<Mail size={18}/>} 
                      />
                      
                      <div className="pt-6 flex justify-end border-t border-gray-100 mt-6">
                          <Button onClick={handleSave} isLoading={saving} icon={<Save size={18}/>} className="bg-gray-800 hover:bg-gray-900 px-10 shadow-lg shadow-gray-200">
                              ׳©׳׳•׳¨ ׳©׳™׳ ׳•׳™׳™׳
                          </Button>
                      </div>
                  </div>
              </div>
          </div>
      </div>
    </>
  )
}

==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\manager\trip\[id]\page.tsx
==========================================
"use client"

import React, { useState, useEffect, use } from 'react' // ׳”׳•׳¡׳₪׳×׳™ ׳׳× use
import { createClient } from '@supabase/supabase-js'
import { ArrowRight, Calendar, MapPin, CheckCircle, XCircle, Clock, AlertTriangle, Link as LinkIcon, User, FileText, Check, X } from 'lucide-react'

const supabaseUrl = "https://ehndiifaaobawrnlcqld.supabase.co";
const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVobmRpaWZhYW9iYXdybmxjcWxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzMzY5NzAsImV4cCI6MjA4MzkxMjk3MH0.RjmlRJWHq7UXohiHPVk-Aeu34eneS5e_uBLnbA9-2X4";
const supabase = createClient(supabaseUrl, supabaseAnonKey);

// ׳”׳’׳“׳¨׳× ׳”׳˜׳™׳₪׳•׳¡׳™׳ ׳”׳—׳“׳©׳” (Promise)
export default function ManagerTripView({ params }: { params: Promise<{ id: string }> }) {
  // --- ׳”׳×׳™׳§׳•׳ ׳”׳§׳¨׳™׳˜׳™: "׳₪׳×׳™׳—׳×" ׳”׳₪׳¨׳׳˜׳¨׳™׳ ׳‘׳׳׳¦׳¢׳•׳× use ---
  const { id } = use(params); 
  
  const [trip, setTrip] = useState<any>(null);
  const [loading, setLoading] = useState(true);
  const [processing, setProcessing] = useState(false);

  useEffect(() => {
    const fetchTrip = async () => {
      // ׳׳©׳×׳׳©׳™׳ ׳‘-id ׳©׳›׳‘׳¨ ׳—׳™׳׳¦׳ ׳• ׳׳׳¢׳׳”
      const { data, error } = await supabase
        .from('trips')
        .select('*')
        .eq('id', id)
        .single();
        
      if (error) {
        console.error(error);
        alert('׳©׳’׳™׳׳” ׳‘׳˜׳¢׳™׳ ׳× ׳”׳˜׳™׳•׳');
        return;
      }
      setTrip(data);
      setLoading(false);
    };
    
    if (id) {
        fetchTrip();
    }
  }, [id]); // ׳”׳×׳׳•׳× ׳”׳™׳ ׳‘-id ׳”׳׳—׳•׳׳¥

  const handleStatusUpdate = async (newStatus: 'approved' | 'rejected') => {
      if (!confirm(`׳”׳׳ ׳׳×׳” ׳‘׳˜׳•׳— ׳©׳‘׳¨׳¦׳•׳ ׳ ${newStatus === 'approved' ? '׳׳׳©׳¨' : '׳׳“׳—׳•׳×'} ׳׳× ׳”׳˜׳™׳•׳?`)) return;
      
      setProcessing(true);
      const { error } = await supabase
        .from('trips')
        .update({ status: newStatus })
        .eq('id', trip.id);

      if (error) {
          alert('׳©׳’׳™׳׳” ׳‘׳¢׳“׳›׳•׳ ׳”׳¡׳˜׳˜׳•׳¡');
      } else {
          setTrip({ ...trip, status: newStatus });
          alert(newStatus === 'approved' ? '׳”׳˜׳™׳•׳ ׳׳•׳©׳¨ ׳‘׳”׳¦׳׳—׳”!' : '׳”׳˜׳™׳•׳ ׳ ׳“׳—׳”.');
      }
      setProcessing(false);
  };

  if (loading) return <div className="min-h-screen flex items-center justify-center"><div className="animate-spin h-10 w-10 border-4 border-[#00BCD4] rounded-full"></div></div>;

  const details = trip.details || {};
  const timeline = details.timeline || [];

  return (
    <div className="min-h-screen bg-[#F5F5F5] font-sans text-gray-800 pb-20" dir="rtl">
      <header className="bg-[#212121] text-white shadow-md sticky top-0 z-30 border-b-4 border-[#00BCD4]">
        <div className="max-w-5xl mx-auto px-6 h-16 flex items-center justify-between">
          <div className="flex items-center gap-4">
            <button onClick={() => window.history.back()} className="hover:bg-white/10 p-2 rounded-full transition-colors"><ArrowRight size={20} /></button>
            <div>
                <h1 className="font-bold text-lg">{trip.name}</h1>
                <p className="text-xs text-gray-400">׳¨׳›׳–: {trip.coordinator_name} | ׳¡׳ ׳™׳£: {trip.branch}</p>
            </div>
          </div>
          <div className={`px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1.5 
            ${trip.status === 'approved' ? 'bg-green-500 text-white' : trip.status === 'rejected' ? 'bg-red-500 text-white' : 'bg-orange-500 text-white'}`}>
            {trip.status === 'approved' ? <CheckCircle size={14}/> : trip.status === 'rejected' ? <XCircle size={14}/> : <Clock size={14}/>}
            {trip.status === 'approved' ? '׳׳׳•׳©׳¨' : trip.status === 'rejected' ? '׳ ׳“׳—׳”' : '׳׳׳×׳™׳ ׳׳׳™׳©׳•׳¨'}
          </div>
        </div>
      </header>

      <main className="max-w-5xl mx-auto p-6 space-y-6">
        <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
            <h3 className="text-lg font-black mb-4 flex items-center gap-2 text-gray-800"><FileText size={20} className="text-[#00BCD4]"/> ׳₪׳¨׳˜׳™ ׳”׳‘׳§׳©׳”</h3>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-6 bg-gray-50 p-4 rounded-xl border border-gray-100">
              <div><span className="text-xs font-bold text-gray-400 block mb-1">׳×׳׳¨׳™׳›׳™׳</span><div className="font-bold text-sm">{details.startDate} - {details.endDate}</div></div>
              <div><span className="text-xs font-bold text-gray-400 block mb-1">׳׳©׳×׳×׳₪׳™׳</span><div className="font-bold text-sm">{details.totalTravelers} (׳׳×׳•׳›׳ {details.chanichimCount} ׳—׳ ׳™׳›׳™׳)</div></div>
              <div><span className="text-xs font-bold text-gray-400 block mb-1">׳’׳™׳׳׳™׳</span><div className="font-bold text-sm">{details.gradeFrom} - {details.gradeTo}</div></div>
              <div><span className="text-xs font-bold text-gray-400 block mb-1">׳׳—׳׳§׳×</span><div className="font-bold text-sm">{trip.department || '׳›׳׳׳™'}</div></div>
            </div>
            
            {details.generalComments && (
                <div className="mt-4 pt-4 border-t">
                    <span className="text-xs font-bold text-gray-400 block mb-1">׳”׳¢׳¨׳•׳× ׳¨׳›׳–:</span>
                    <p className="text-sm bg-yellow-50 p-3 rounded-lg border border-yellow-100 text-gray-700">{details.generalComments}</p>
                </div>
            )}
        </div>

        <section>
          <div className="flex items-center justify-between mb-4">
             <h3 className="text-xl font-black text-gray-800">׳₪׳™׳¨׳•׳˜ ׳”׳₪׳¢׳™׳׳•׳× ׳•׳”׳׳™׳©׳•׳¨׳™׳</h3>
          </div>
          <div className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden divide-y divide-gray-100">
             {timeline.length === 0 && <div className="p-10 text-center text-gray-400">׳׳™׳ ׳₪׳¢׳™׳׳•׳™׳•׳× ׳׳•׳–׳ ׳•׳×</div>}
             {timeline.map((item: any, idx: number) => {
                 const isMissing = item.requiresLicense && !item.files;
                 return (
                   <div key={idx} className={`p-5 transition-colors ${isMissing ? 'bg-red-50/50' : 'hover:bg-gray-50'}`}>
                      <div className="flex items-start gap-4">
                         <div className="bg-gray-100 text-gray-600 font-bold px-3 py-1 rounded-lg text-sm min-w-[60px] text-center mt-1 border border-gray-200">
                             {item.date ? item.date.split('-').slice(1).reverse().join('/') : '?'}
                         </div>
                         <div className="flex-1">
                            <div className="flex justify-between items-start">
                               <div>
                                   <h4 className="font-bold text-gray-900 text-lg flex items-center gap-2">
                                       {item.finalSubCategory}
                                       {item.requiresLicense && <span className="bg-orange-100 text-orange-800 px-2 py-0.5 rounded text-[10px] font-bold border border-orange-200">׳“׳•׳¨׳© ׳¨׳™׳©׳•׳™</span>}
                                   </h4>
                                   <div className="flex items-center gap-4 mt-1 text-sm text-gray-500">
                                      <span className="flex items-center gap-1"><MapPin size={14} className="text-[#00BCD4]"/> {item.finalLocation}</span>
                                      <span className="text-gray-400">| {item.category}</span>
                                   </div>
                               </div>
                               {item.requiresLicense && (
                                   <div className="flex-shrink-0">
                                       {item.files ? (
                                           <a href={item.files.url} target="_blank" className="flex items-center gap-2 bg-green-50 text-green-700 border border-green-200 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-green-100 transition-colors">
                                               <LinkIcon size={14}/> ׳¦׳₪׳” ׳‘׳¨׳™׳©׳™׳•׳
                                           </a>
                                       ) : (
                                           <div className="flex items-center gap-2 bg-red-100 text-red-700 border border-red-200 px-3 py-1.5 rounded-lg text-xs font-bold">
                                               <AlertTriangle size={14}/> ׳—׳¡׳¨ ׳§׳•׳‘׳¥!
                                           </div>
                                       )}
                                   </div>
                               )}
                            </div>
                            {item.details && <div className="mt-3 text-sm text-gray-600 bg-white p-2.5 rounded border border-gray-100">{item.details}</div>}
                         </div>
                      </div>
                   </div>
                 )
             })}
          </div>
        </section>
      </main>

      <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 z-40 shadow-[0_-5px_20px_rgba(0,0,0,0.1)]">
         <div className="max-w-5xl mx-auto flex items-center justify-between gap-4">
            <div className="text-sm text-gray-500">
                ׳₪׳¢׳•׳׳•׳× ׳ ׳™׳”׳•׳ ׳¢׳‘׳•׳¨ ׳˜׳™׳•׳ #{trip.id}
            </div>
            <div className="flex gap-3">
                <button onClick={() => handleStatusUpdate('rejected')} disabled={processing} className="px-6 py-2.5 rounded-xl border border-red-200 text-red-600 font-bold hover:bg-red-50 transition-colors flex items-center gap-2 disabled:opacity-50">
                    <X size={18}/> ׳“׳—׳” ׳˜׳™׳•׳
                </button>
                <button onClick={() => handleStatusUpdate('approved')} disabled={processing} className="px-8 py-2.5 rounded-xl bg-[#00BCD4] text-white font-bold hover:bg-[#00ACC1] shadow-lg transition-all flex items-center gap-2 disabled:opacity-50">
                    {processing ? <div className="animate-spin h-4 w-4 border-2 border-white rounded-full"></div> : <Check size={18}/>}
                    ׳׳©׳¨ ׳˜׳™׳•׳ ׳׳‘׳™׳¦׳•׳¢
                </button>
            </div>
         </div>
      </div>
    </div>
  )
}

==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\manager\users\page.tsx
==========================================
"use client"

import React, { useState, useEffect } from 'react'
import { supabase } from '@/lib/supabaseClient'
import { ManagerHeader } from '@/components/layout/ManagerHeader'
import { Input } from '@/components/ui/Input'
import { Loader2, Shield, User, MapPin, CheckCircle, XCircle, Search, ChevronDown, ChevronUp } from 'lucide-react'

export default function UsersManagement() {
  const [loading, setLoading] = useState(true);
  const [users, setUsers] = useState<any[]>([]);
  const [filter, setFilter] = useState('pending'); // pending | approved | rejected
  const [expandedUser, setExpandedUser] = useState<string | null>(null);

  useEffect(() => {
    fetchUsers();
  }, []);

  const fetchUsers = async () => {
    const { data } = await supabase.from('users_management_view').select('*');
    if (data) setUsers(data);
    setLoading(false);
  };

  const updateUserStatus = async (userId: string, newStatus: string) => {
      // ׳§׳¨׳™׳׳” ׳׳₪׳•׳ ׳§׳¦׳™׳” ׳©׳™׳¦׳¨׳ ׳• ׳‘-SQL
      const { error } = await supabase.rpc('update_user_status', { 
          user_id: userId, 
          new_status: newStatus 
      });
      
      if (error) {
          alert('׳©׳’׳™׳׳” ׳‘׳¢׳“׳›׳•׳: ' + error.message);
      } else {
          // ׳¢׳“׳›׳•׳ ׳׳§׳•׳׳™ ׳›׳“׳™ ׳©׳ ׳¨׳׳” ׳׳× ׳”׳©׳™׳ ׳•׳™ ׳׳™׳“
          setUsers(prev => prev.map(u => {
              if (u.id === userId) {
                  const newMeta = { ...u.raw_user_meta_data, status: newStatus };
                  return { ...u, raw_user_meta_data: newMeta };
              }
              return u;
          }));
      }
  };

  const filteredUsers = users.filter(u => {
      const status = u.raw_user_meta_data.status || 'pending'; // ׳‘׳¨׳™׳¨׳× ׳׳—׳“׳: ׳׳׳×׳™׳
      return status === filter;
  });

  if (loading) return <div className="h-screen flex items-center justify-center"><Loader2 className="animate-spin text-gray-400"/></div>;

  return (
    <>
      <ManagerHeader title="׳ ׳™׳”׳•׳ ׳׳©׳×׳׳©׳™׳ ׳•׳¨׳›׳–׳™׳" />
      
      <div className="p-8 animate-fadeIn max-w-7xl mx-auto pb-32">
          
          {/* ׳¡׳¨׳’׳ ׳¡׳™׳ ׳•׳ */}
          <div className="flex gap-4 mb-8">
              {['pending', 'approved', 'rejected'].map(f => (
                  <button 
                    key={f}
                    onClick={() => setFilter(f)}
                    className={`px-6 py-2 rounded-xl font-bold text-sm transition-all
                    ${filter === f ? 'bg-gray-800 text-white shadow-lg' : 'bg-white text-gray-500 border border-gray-200'}`}
                  >
                      {f === 'pending' ? '׳׳׳×׳™׳ ׳™׳ ׳׳׳™׳©׳•׳¨' : f === 'approved' ? '׳׳©׳×׳׳©׳™׳ ׳₪׳¢׳™׳׳™׳' : '׳ ׳“׳—׳•/׳ ׳—׳¡׳׳•'}
                      <span className="mr-2 bg-white/20 px-2 py-0.5 rounded-full text-xs">
                          {users.filter(u => (u.raw_user_meta_data.status || 'pending') === f).length}
                      </span>
                  </button>
              ))}
          </div>

          <div className="space-y-4">
              {filteredUsers.map((u) => {
                  const meta = u.raw_user_meta_data || {};
                  const isExpanded = expandedUser === u.id;
                  const isHQ = meta.branch === '׳׳˜׳”';

                  return (
                    <div key={u.id} className="bg-white rounded-3xl border border-gray-200 shadow-sm overflow-hidden transition-all">
                        {/* ׳©׳•׳¨׳” ׳¨׳׳©׳™׳× */}
                        <div className="p-6 flex items-center gap-6 cursor-pointer hover:bg-gray-50" onClick={() => setExpandedUser(isExpanded ? null : u.id)}>
                            <div className={`w-12 h-12 rounded-2xl flex items-center justify-center text-white font-bold text-xl shrink-0 ${isHQ ? 'bg-gray-800' : 'bg-[#00BCD4]'}`}>
                                {meta.full_name?.[0] || <User/>}
                            </div>
                            
                            <div className="flex-1 grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <h3 className="font-bold text-gray-800">{meta.full_name || '׳׳׳ ׳©׳'}</h3>
                                    <div className="text-xs text-gray-500">{u.email}</div>
                                </div>
                                <div className="flex items-center gap-2">
                                    <span className={`px-2 py-1 rounded-lg text-xs font-bold flex items-center gap-1 ${isHQ ? 'bg-gray-100 text-gray-700' : 'bg-cyan-50 text-cyan-700'}`}>
                                        {isHQ ? <Shield size={12}/> : <User size={12}/>}
                                        {isHQ ? '׳׳ ׳”׳ ׳׳˜׳”' : '׳¨׳›׳– ׳¡׳ ׳™׳£'}
                                    </span>
                                </div>
                                <div className="text-sm font-medium text-gray-600 flex items-center gap-1">
                                    <MapPin size={14}/> {meta.branch || '-'} ג€¢ {meta.department || '-'}
                                </div>
                            </div>

                            <button className="text-gray-400">
                                {isExpanded ? <ChevronUp/> : <ChevronDown/>}
                            </button>
                        </div>

                        {/* ׳”׳¨׳—׳‘׳” */}
                        {isExpanded && (
                            <div className="p-6 bg-gray-50 border-t border-gray-100 animate-fadeIn">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-6">
                                    <div className="space-y-2">
                                        <p className="text-xs font-bold text-gray-400">׳×׳¢׳•׳“׳× ׳–׳”׳•׳×</p>
                                        <p className="font-medium text-gray-800">{meta.id_number || '-'}</p>
                                    </div>
                                    <div className="space-y-2">
                                        <p className="text-xs font-bold text-gray-400">׳˜׳׳₪׳•׳</p>
                                        <p className="font-medium text-gray-800">{meta.phone || '-'}</p>
                                    </div>
                                    <div className="space-y-2">
                                        <p className="text-xs font-bold text-gray-400">׳›׳×׳•׳‘׳× ׳׳׳©׳׳•׳—</p>
                                        <p className="font-medium text-gray-800">{meta.branch_address || '-'}</p>
                                    </div>
                                    <div className="space-y-2">
                                        <p className="text-xs font-bold text-gray-400">׳ ׳×׳•׳ ׳™ ׳”׳¨׳©׳׳”</p>
                                        <p className="font-medium text-gray-800">׳ ׳¨׳©׳ ׳‘: {new Date(u.created_at).toLocaleDateString('he-IL')}</p>
                                    </div>
                                </div>

                                {/* ׳›׳₪׳×׳•׳¨׳™ ׳₪׳¢׳•׳׳” */}
                                <div className="flex justify-end gap-3 pt-4 border-t border-gray-200">
                                    {filter !== 'approved' && (
                                        <button onClick={() => updateUserStatus(u.id, 'approved')} className="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-xl font-bold shadow-lg shadow-green-100 transition-all">
                                            <CheckCircle size={18}/> ׳׳©׳¨ ׳׳©׳×׳׳©
                                        </button>
                                    )}
                                    {filter !== 'rejected' && (
                                        <button onClick={() => updateUserStatus(u.id, 'rejected')} className="flex items-center gap-2 bg-white border border-red-200 text-red-600 hover:bg-red-50 px-6 py-2 rounded-xl font-bold transition-all">
                                            <XCircle size={18}/> ׳—׳¡׳•׳ / ׳“׳—׳”
                                        </button>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                  )
              })}
              {filteredUsers.length === 0 && <div className="text-center p-10 text-gray-400">׳׳ ׳ ׳׳¦׳׳• ׳׳©׳×׳׳©׳™׳ ׳‘׳¡׳˜׳˜׳•׳¡ ׳–׳”</div>}
          </div>
      </div>
    </>
  )
}

==========================================
FILE: layout.tsx
PATH: C:\Users\User\chabad-trips\app\manager\layout.tsx
==========================================
import React from 'react';
import { ManagerSidebar } from '@/components/layout/ManagerSidebar'; 

export default function ManagerLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="min-h-screen bg-[#F1F5F9] dir-rtl font-sans text-right">
      
      {/* 1. ׳”׳¡׳¨׳’׳ ׳”׳§׳‘׳•׳¢ ׳‘׳¦׳“ ׳™׳׳™׳ */}
      <ManagerSidebar />
      
      {/* 2. ׳”׳׳§׳•׳ ׳׳×׳•׳›׳ ׳”׳׳©׳×׳ ׳” (׳”׳“׳₪׳™׳ ׳¢׳¦׳׳) */}
      {/* ׳©׳™׳ ׳׳‘: ׳׳™׳ ׳›׳׳ Header. ׳”׳•׳ ׳™׳’׳™׳¢ ׳׳×׳•׳ ׳”-children */}
      <div className="mr-64 transition-all duration-300">
        {children}
      </div>
      
    </div>
  );
}

==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\manager\page.tsx
==========================================
"use client"

import React, { useState, useEffect } from 'react'
import { supabase } from '@/lib/supabaseClient'
import { ManagerHeader } from '@/components/layout/ManagerHeader'
import { Loader2, AlertCircle, CheckCircle, Clock, UserPlus } from 'lucide-react'
import Link from 'next/link'

export default function ManagerHomePage() {
  const [stats, setStats] = useState({ pendingTrips: 0, approvedTrips: 0, totalTrips: 0, pendingUsers: 0 });
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchStats = async () => {
        try {
            // 1. ׳ ׳×׳•׳ ׳™ ׳˜׳™׳•׳׳™׳
            const { count: pendingTrips } = await supabase.from('trips').select('*', { count: 'exact', head: true }).eq('status', 'pending');
            const { count: approvedTrips } = await supabase.from('trips').select('*', { count: 'exact', head: true }).eq('status', 'approved');
            const { count: totalTrips } = await supabase.from('trips').select('*', { count: 'exact', head: true });

            // 2. ׳ ׳×׳•׳ ׳™ ׳׳©׳×׳׳©׳™׳ (׳ ׳¨׳©׳׳™׳ ׳—׳“׳©׳™׳)
            // ׳׳‘׳™׳׳™׳ ׳׳× ׳›׳ ׳”׳׳©׳×׳׳©׳™׳ ׳•׳‘׳•׳“׳§׳™׳ ׳™׳“׳ ׳™׳× ׳׳׳™ ׳׳™׳ ׳¡׳˜׳˜׳•׳¡ ׳׳• ׳©׳”׳•׳ pending
            const { data: usersData } = await supabase.from('users_management_view').select('raw_user_meta_data');
            
            const pendingUsersCount = usersData?.filter((u: any) => {
                const status = u.raw_user_meta_data?.status;
                return !status || status === 'pending'; // ׳ ׳—׳©׳‘ ׳׳׳×׳™׳ ׳׳ ׳׳™׳ ׳¡׳˜׳˜׳•׳¡ ׳׳• ׳©׳”׳•׳ 'pending'
            }).length || 0;

            setStats({
                pendingTrips: pendingTrips || 0,
                approvedTrips: approvedTrips || 0,
                totalTrips: totalTrips || 0,
                pendingUsers: pendingUsersCount
            });

        } catch (error) {
            console.error('Error fetching stats:', error);
        } finally {
            setLoading(false);
        }
    };
    fetchStats();
  }, []);

  if (loading) return <div className="h-screen flex items-center justify-center"><Loader2 className="animate-spin text-gray-400"/></div>;

  return (
    <>
      <ManagerHeader title="׳׳•׳— ׳‘׳§׳¨׳” ׳¨׳׳©׳™" />
      
      <div className="p-10 animate-fadeIn pb-32">
        <header className="mb-10">
            <h2 className="text-xl font-bold text-gray-500">׳×׳׳•׳ ׳× ׳׳¦׳‘ - ׳ ׳™׳”׳•׳ ׳׳₪׳¢׳׳™׳ ׳•׳˜׳™׳•׳׳™׳</h2>
        </header>

        {/* ׳©׳™׳ ׳™׳ ׳• ׳׳× ׳”׳’׳¨׳™׳“ ׳-4 ׳¢׳׳•׳“׳•׳× ׳›׳“׳™ ׳׳”׳›׳ ׳™׳¡ ׳׳× ׳›׳¨׳˜׳™׳¡ ׳”׳׳©׳×׳׳©׳™׳ */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
             
             {/* 1. ׳›׳¨׳˜׳™׳¡ ׳׳©׳×׳׳©׳™׳ ׳—׳“׳©׳™׳ (׳—׳“׳©!) */}
             <Link href="/manager/users" className="group">
                <div className="bg-white p-6 rounded-3xl border border-gray-200 shadow-sm hover:shadow-xl hover:border-orange-500 transition-all cursor-pointer relative overflow-hidden h-full">
                    <div className="absolute top-0 right-0 w-2 h-full bg-orange-500"></div>
                    <div className="flex justify-between items-start">
                        <div>
                            <div className="text-4xl font-black text-gray-800 mb-2">{stats.pendingUsers}</div>
                            <div className="text-sm font-bold text-gray-500 group-hover:text-orange-600 transition-colors">׳ ׳¨׳©׳׳™׳ ׳׳׳™׳©׳•׳¨</div>
                        </div>
                        <div className="p-3 bg-orange-50 text-orange-500 rounded-2xl"><UserPlus size={24}/></div>
                    </div>
                </div>
            </Link>

             {/* 2. ׳›׳¨׳˜׳™׳¡ ׳˜׳™׳•׳׳™׳ ׳׳׳×׳™׳ ׳™׳ */}
             <Link href="/manager/approvals" className="group">
                <div className="bg-white p-6 rounded-3xl border border-gray-200 shadow-sm hover:shadow-xl hover:border-[#E91E63] transition-all cursor-pointer relative overflow-hidden h-full">
                    <div className="absolute top-0 right-0 w-2 h-full bg-[#E91E63]"></div>
                    <div className="flex justify-between items-start">
                        <div>
                            <div className="text-4xl font-black text-gray-800 mb-2">{stats.pendingTrips}</div>
                            <div className="text-sm font-bold text-gray-500 group-hover:text-[#E91E63] transition-colors">׳˜׳™׳•׳׳™׳ ׳׳׳™׳©׳•׳¨</div>
                        </div>
                        <div className="p-3 bg-red-50 text-[#E91E63] rounded-2xl"><AlertCircle size={24}/></div>
                    </div>
                </div>
            </Link>
            
            {/* 3. ׳›׳¨׳˜׳™׳¡ ׳׳׳•׳©׳¨׳™׳ */}
             <div className="bg-white p-6 rounded-3xl border border-gray-200 shadow-sm">
                <div className="flex justify-between items-start">
                    <div>
                        <div className="text-4xl font-black text-gray-800 mb-2">{stats.approvedTrips}</div>
                        <div className="text-sm font-bold text-gray-500">׳˜׳™׳•׳׳™׳ ׳©׳׳•׳©׳¨׳•</div>
                    </div>
                    <div className="p-3 bg-green-50 text-green-600 rounded-2xl"><CheckCircle size={24}/></div>
                </div>
            </div>

            {/* 4. ׳›׳¨׳˜׳™׳¡ ׳¡׳”"׳› */}
            <div className="bg-white p-6 rounded-3xl border border-gray-200 shadow-sm">
                <div className="flex justify-between items-start">
                    <div>
                        <div className="text-4xl font-black text-gray-800 mb-2">{stats.totalTrips}</div>
                        <div className="text-sm font-bold text-gray-500">׳¡׳”"׳› ׳₪׳¢׳™׳׳•׳×</div>
                    </div>
                    <div className="p-3 bg-blue-50 text-blue-500 rounded-2xl"><Clock size={24}/></div>
                </div>
            </div>
        </div>
      </div>
    </>
  )
}

==========================================
FILE: layout.tsx
PATH: C:\Users\User\chabad-trips\app\layout.tsx
==========================================
import type { Metadata } from "next";
import { Rubik } from "next/font/google"; // ׳©׳™׳ ׳•׳™ ׳-Rubik
import "./globals.css";

// ׳”׳’׳“׳¨׳× ׳₪׳•׳ ׳˜ Rubik
const rubik = Rubik({ 
  subsets: ["hebrew", "latin"],
  weight: ["300", "400", "500", "700", "900"], 
  variable: "--font-rubik",
});

export const metadata: Metadata = {
  title: '׳׳¢׳¨׳›׳× ׳”׳˜׳™׳•׳׳™׳ | ׳׳¨׳’׳•׳ ׳ ׳•׳¢׳¨ ׳—׳‘"׳“',
  description: '׳׳¢׳¨׳›׳× ׳׳ ׳™׳”׳•׳, ׳×׳›׳ ׳•׳ ׳•׳׳™׳©׳•׳¨ ׳˜׳™׳•׳׳™׳ ׳•׳׳™׳¨׳•׳¢׳™׳',
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="he" dir="rtl">
      <body className={`${rubik.variable} bg-[#F8F9FA] text-[#263238] font-sans antialiased`}>
        <main className="min-h-screen flex flex-col">
           {children}
        </main>
      </body>
    </html>
  );
}

==========================================
FILE: page.tsx
PATH: C:\Users\User\chabad-trips\app\page.tsx
==========================================
"use client";

import React, { useState, useEffect } from 'react';
import { supabase } from '@/lib/supabaseClient';
import { ArrowLeft, LogIn, UserPlus, ShieldCheck, Users, Briefcase } from 'lucide-react';
import { Button } from '@/components/ui/Button';
import { Input } from '@/components/ui/Input';

// --- ׳”׳’׳“׳¨׳•׳× ---
const DEPARTMENTS = ["׳‘׳× ׳׳׳", "׳‘׳ ׳•׳× ׳—׳‘\"׳“", "׳”׳₪׳ ׳¡׳׳™׳", "׳׳•׳¢׳“׳•׳ ׳™ ׳”׳׳¢׳©׳™׳ ׳”׳˜׳•׳‘׳™׳", "׳×׳׳™׳"];

// *** ׳—׳•׳‘׳” ׳׳©׳ ׳•׳× ׳׳× ׳–׳” ׳׳׳™׳™׳ ׳”׳׳׳™׳×׳™ ׳©׳׳ ***
const SUPER_ADMIN_EMAIL = 'avremihalperin@gmail.com'; 
// -----------------------------------------

export default function Home() {
  // ׳ ׳™׳”׳•׳ ׳׳¦׳‘׳™׳ (Views)
  const [view, setView] = useState<'landing' | 'login' | 'dept_selection' | 'role_selection' | 'register_form'>('landing');
  const [loading, setLoading] = useState(false);
  const [errorMsg, setErrorMsg] = useState('');
  const [successMsg, setSuccessMsg] = useState('');

  // ׳“׳׳˜׳”
  const [selectedDept, setSelectedDept] = useState(''); 
  const [selectedRoleType, setSelectedRoleType] = useState(''); 
  const [formData, setFormData] = useState({
    idNumber: '', password: '', fullName: '', phone: '', email: '', birthDate: '', branch: '', role: ''
  });

  // ׳‘׳“׳™׳§׳× ׳”׳×׳—׳‘׳¨׳•׳× ׳׳•׳˜׳•׳׳˜׳™׳× (׳׳ ׳”׳׳©׳×׳׳© ׳›׳‘׳¨ ׳׳—׳•׳‘׳¨)
  useEffect(() => {
    const checkSession = async () => {
      const { data } = await supabase.auth.getSession();
      if (data?.session) {
         // ׳‘׳•׳“׳§׳™׳ ׳”׳¨׳©׳׳•׳× ׳’׳ ׳׳ ׳”׳•׳ ׳›׳‘׳¨ ׳׳—׳•׳‘׳¨ (׳׳׳§׳¨׳” ׳©׳ ׳—׳¡׳ ׳×׳•׳ ׳›׳“׳™)
         try {
             await checkRoleAndRedirect(data.session.user);
         } catch (e: any) {
             console.log("Auto-login rejected:", e.message);
             // ׳׳ ׳”׳‘׳“׳™׳§׳” ׳ ׳›׳©׳׳”, ׳”׳•׳ ׳›׳‘׳¨ ׳ ׳–׳¨׳§ ׳”׳—׳•׳¦׳” ׳‘׳×׳•׳ ׳”׳₪׳•׳ ׳§׳¦׳™׳”
         }
      }
    };
    checkSession();
  }, []);

  // --- ׳”׳₪׳•׳ ׳§׳¦׳™׳” ׳”׳§׳¨׳™׳˜׳™׳×: ׳‘׳“׳™׳§׳× ׳׳™׳©׳•׳¨ ׳•׳ ׳™׳×׳•׳‘ ---
  const checkRoleAndRedirect = async (user: any) => {
      const meta = user.user_metadata || {};
      // ׳׳ ׳׳™׳ ׳¡׳˜׳˜׳•׳¡, ׳ ׳×׳™׳™׳—׳¡ ׳׳׳™׳• ׳›׳׳׳×׳™׳
      const status = meta.status || 'pending'; 

      // ׳‘׳“׳™׳§׳× ׳”׳©׳•׳׳¨:
      // ׳׳ ׳–׳” ׳׳ ׳”׳׳ ׳”׳ ׳”׳¨׳׳©׳™, ׳•׳”׳¡׳˜׳˜׳•׳¡ ׳׳™׳ ׳• 'approved' - ׳–׳•׳¨׳§׳™׳ ׳”׳—׳•׳¦׳”
      if (user.email !== SUPER_ADMIN_EMAIL && status !== 'approved') {
        
        await supabase.auth.signOut(); // ׳ ׳™׳×׳•׳§ ׳׳™׳™׳“׳™
        
        if (status === 'pending') {
            throw new Error('׳”׳”׳¨׳©׳׳” ׳©׳׳ ׳ ׳§׳׳˜׳” ׳׳ ׳˜׳¨׳ ׳׳•׳©׳¨׳” ׳¢׳ ׳™׳“׳™ ׳”׳׳˜׳”.');
        } else {
            throw new Error('׳”׳’׳™׳©׳” ׳׳׳¢׳¨׳›׳× ׳ ׳—׳¡׳׳”. ׳׳₪׳¨׳˜׳™׳ ׳ ׳•׳¡׳₪׳™׳ ׳₪׳ ׳” ׳׳׳˜׳”.');
        }
      }

      // ׳׳ ׳¢׳‘׳¨׳ ׳• ׳׳× ׳”׳©׳•׳׳¨ - ׳ ׳™׳×׳•׳‘ ׳׳₪׳™ ׳×׳₪׳§׳™׳“
      if (meta.department === '׳‘׳˜׳™׳—׳•׳× ׳•׳׳₪׳¢׳׳™׳' || meta.role === 'safety_admin') {
          window.location.href = '/manager';
      } else {
          window.location.href = '/dashboard';
      }
  };

  const handleInputChange = (e: any) => {
    setFormData({ ...formData, [e.target.name]: e.target.value });
  };

  // --- ׳׳•׳’׳™׳§׳” ׳׳›׳ ׳™׳¡׳” ---
  const handleLogin = async (e: any) => {
    e.preventDefault();
    setLoading(true); setErrorMsg('');

    try {
        // ׳×׳׳™׳›׳” ׳‘׳”׳×׳—׳‘׳¨׳•׳× ׳¢׳ ׳×"׳– ׳׳• ׳׳™׳׳™׳™׳
        const email = formData.idNumber.includes('@') ? formData.idNumber : `${formData.idNumber}@noar.chabad.co.il`; 
        
        const { data, error } = await supabase.auth.signInWithPassword({ email: email, password: formData.password });

        if (error) {
          setErrorMsg('׳©׳’׳™׳׳” ׳‘׳”׳×׳—׳‘׳¨׳•׳×: ׳‘׳“׳•׳§ ׳׳× ׳×׳¢׳•׳“׳× ׳”׳–׳”׳•׳× ׳•׳”׳¡׳™׳¡׳׳”.');
          setLoading(false);
          return;
        }

        // ׳׳ ׳”׳¡׳™׳¡׳׳” ׳ ׳›׳•׳ ׳”, ׳‘׳•׳“׳§׳™׳ ׳׳ ׳”׳•׳ ׳׳׳•׳©׳¨
        await checkRoleAndRedirect(data.user);
        
    } catch (err: any) {
        console.error(err);
        // ׳׳¦׳™׳’ ׳׳× ׳”׳©׳’׳™׳׳” ׳©׳ ׳–׳¨׳§׳” ׳-checkRoleAndRedirect (׳׳׳©׳: "׳˜׳¨׳ ׳׳•׳©׳¨׳×")
        setErrorMsg(err.message || '׳©׳’׳™׳׳” ׳›׳׳׳™׳× ׳‘׳׳¢׳¨׳›׳×');
        setLoading(false);
    }
  };

  // --- ׳׳•׳’׳™׳§׳” ׳׳”׳¨׳©׳׳” ---
  const handleRegister = async (e: any) => {
    e.preventDefault();
    setLoading(true); setErrorMsg('');

    try {
        const email = `${formData.idNumber}@noar.chabad.co.il`;
        const { error } = await supabase.auth.signUp({
          email: email,
          password: formData.password,
          options: {
            data: {
              full_name: formData.fullName,
              identity_number: formData.idNumber,
              department: selectedDept, 
              role: selectedRoleType,   
              branch_name: selectedRoleType === 'coordinator' ? formData.branch : null,
              phone: formData.phone,
              contact_email: formData.email,
              birth_date: formData.birthDate,
              status: 'pending' // <--- ׳”׳•׳¡׳₪׳” ׳—׳©׳•׳‘׳”: ׳‘׳¨׳™׳¨׳× ׳׳—׳“׳ ׳׳׳׳×׳™׳
            },
          },
        });

        if (error) {
          setErrorMsg(error.message);
          setLoading(false);
        } else {
          setSuccessMsg('׳ ׳¨׳©׳׳× ׳‘׳”׳¦׳׳—׳”! ׳”׳—׳©׳‘׳•׳ ׳׳׳×׳™׳ ׳׳׳™׳©׳•׳¨ ׳׳ ׳”׳.');
          setTimeout(() => {
              setSuccessMsg('');
              setView('login');
              setLoading(false);
          }, 2000);
        }
    } catch (err) {
        console.error(err);
        setLoading(false);
    }
  };

  // --- View: Landing ---
  if (view === 'landing') {
    return (
      <div className="min-h-screen flex flex-col items-center justify-center p-4 relative overflow-hidden bg-white">
        <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-brand-cyan via-brand-green to-brand-pink"></div>
        
        <main className="max-w-md w-full text-center z-10 animate-fadeIn">
          <div className="mb-8 flex justify-center">
             <div className="bg-white p-6 rounded-full shadow-xl w-40 h-40 flex items-center justify-center border-4 border-white ring-1 ring-gray-100">
                <img src="/logo.png" alt="׳׳•׳’׳• ׳ ׳•׳¢׳¨ ׳—׳‘׳´׳“" className="w-full h-full object-contain"/>
             </div>
          </div>

          <h1 className="text-3xl font-black mb-3 text-brand-green leading-tight">
            ׳‘׳¨׳•׳›׳™׳ ׳”׳‘׳׳™׳ ׳׳׳¢׳¨׳›׳× ׳”׳˜׳™׳•׳׳™׳ ׳•׳”׳׳™׳¨׳•׳¢׳™׳ ׳©׳ ׳׳¨׳’׳•׳ ׳ ׳•׳¢׳¨ ׳—׳‘"׳“
          </h1>
          
          <h2 className="text-lg text-gray-500 font-medium mb-10 px-4">
            ׳₪׳׳˜׳₪׳•׳¨׳׳× ׳”׳ ׳™׳”׳•׳ ׳׳×׳›׳ ׳•׳, ׳׳™׳©׳•׳¨ ׳•׳‘׳§׳¨׳” ג€“ ׳”׳›׳ ׳‘׳׳§׳•׳ ׳׳—׳“
          </h2>

          <div className="space-y-4">
            <Button onClick={() => setView('login')} className="w-full justify-between group" icon={<LogIn size={20} />}>
              ׳›׳ ׳™׳¡׳” ׳׳׳¢׳¨׳›׳×
              <ArrowLeft className="group-hover:-translate-x-1 transition-transform" />
            </Button>

            <div className="relative py-2">
              <div className="absolute inset-0 flex items-center"><div className="w-full border-t border-gray-100"></div></div>
              <div className="relative flex justify-center text-xs uppercase"><span className="bg-white px-2 text-gray-400">׳׳©׳×׳׳© ׳—׳“׳©?</span></div>
            </div>

            <Button onClick={() => setView('dept_selection')} variant="outline" className="w-full justify-center gap-2" icon={<UserPlus size={20} />}>
              ׳”׳¨׳©׳׳” ׳׳׳¢׳¨׳›׳×
            </Button>
          </div>

          <div className="mt-16 text-xs text-gray-300 font-medium">ֲ© ׳׳¨׳’׳•׳ ׳ ׳•׳¢׳¨ ׳—׳‘"׳“</div>
        </main>
      </div>
    );
  }

  // --- View: Login ---
  if (view === 'login') {
    return (
      <div className="min-h-screen bg-white flex flex-col items-center justify-center p-6">
        <button onClick={() => setView('landing')} className="absolute top-6 right-6 text-gray-400 hover:text-brand-cyan transition-colors">
            <ArrowLeft size={24} className="rotate-180" />
        </button>

        <div className="w-full max-w-sm animate-fadeIn">
            <div className="text-center mb-8">
                <h2 className="text-2xl font-black text-brand-dark">׳”׳×׳—׳‘׳¨׳•׳×</h2>
                <p className="text-gray-400 text-sm mt-1">׳”׳–׳ ׳׳× ׳₪׳¨׳˜׳™׳ ׳׳›׳ ׳™׳¡׳” ׳׳׳¢׳¨׳›׳×</p>
            </div>

            <form onSubmit={handleLogin} className="space-y-5">
              <Input label="׳×׳¢׳•׳“׳× ׳–׳”׳•׳×" name="idNumber" required onChange={handleInputChange} autoFocus />
              <Input label="׳¡׳™׳¡׳׳”" type="password" name="password" required onChange={handleInputChange} />

              {errorMsg && (
                  <div className="bg-red-50 text-red-600 p-3 rounded-xl text-sm font-bold border border-red-100 flex items-center gap-2">
                      <span className="block w-1.5 h-1.5 bg-red-600 rounded-full"></span>{errorMsg}
                  </div>
              )}

              <Button type="submit" isLoading={loading} className="w-full mt-4">׳›׳ ׳™׳¡׳”</Button>
            </form>
        </div>
      </div>
    );
  }

  // --- View: Dept Selection ---
  if (view === 'dept_selection') {
    return (
      <div className="min-h-screen bg-bg-light p-6 flex flex-col items-center">
        <header className="w-full max-w-md flex justify-between items-center mb-10 mt-4">
            <button onClick={() => setView('landing')} className="text-gray-400 hover:text-brand-cyan"><ArrowLeft className="rotate-180"/></button>
            <div className="text-xs font-bold text-gray-300">׳©׳׳‘ 1 ׳׳×׳•׳ 3</div>
        </header>

        <main className="w-full max-w-md animate-fadeIn">
          <h2 className="text-2xl font-black text-brand-dark mb-2 text-center">׳׳׳™׳–׳• ׳׳—׳׳§׳” ׳‘׳׳¨׳’׳•׳ ׳׳×/׳” ׳©׳™׳™׳/׳×?</h2>
          <p className="text-center text-gray-400 mb-8 text-sm">׳‘׳—׳¨ ׳׳× ׳”׳׳—׳׳§׳” ׳”׳¨׳׳•׳•׳ ׳˜׳™׳× ׳׳”׳׳©׳ ׳”׳”׳¨׳©׳׳”</p>
          
          <div className="space-y-3">
            {DEPARTMENTS.map((dept) => (
                <button key={dept} onClick={() => { setSelectedDept(dept); setView('role_selection'); }}
                  className="w-full bg-white p-5 rounded-2xl shadow-sm border border-gray-100 hover:border-brand-cyan hover:shadow-md transition-all text-right font-bold text-gray-700 hover:text-brand-cyan flex justify-between items-center group">
                  <span className="text-lg">{dept}</span>
                  <ArrowLeft size={18} className="text-gray-300 group-hover:text-brand-cyan transition-colors" />
                </button>
            ))}
          </div>

          <div className="mt-10 border-t border-gray-200 pt-6">
             <Button variant="dark" onClick={() => { setSelectedDept('׳‘׳˜׳™׳—׳•׳× ׳•׳׳₪׳¢׳׳™׳'); setSelectedRoleType('safety_admin'); setView('register_form'); }} className="w-full" icon={<ShieldCheck size={20} className="text-brand-green" />}>
                ׳”׳¨׳©׳׳” ׳׳׳—׳׳§׳× ׳‘׳˜׳™׳—׳•׳× ׳•׳׳₪׳¢׳׳™׳
             </Button>
          </div>
        </main>
      </div>
    );
  }

  // --- View: Role Selection ---
  if (view === 'role_selection') {
    return (
      <div className="min-h-screen bg-bg-light p-6 flex flex-col items-center">
        <header className="w-full max-w-md flex justify-between items-center mb-10 mt-4">
            <button onClick={() => setView('dept_selection')} className="text-gray-400 hover:text-brand-cyan"><ArrowLeft className="rotate-180"/></button>
            <div className="text-xs font-bold text-gray-300">׳©׳׳‘ 2 ׳׳×׳•׳ 3</div>
        </header>

        <main className="w-full max-w-md animate-fadeIn">
          <h2 className="text-2xl font-black text-brand-dark mb-2 text-center">׳”׳’׳“׳¨׳× ׳×׳₪׳§׳™׳“</h2>
          <p className="text-center text-gray-400 mb-8">׳׳—׳׳§׳” ׳ ׳‘׳—׳¨׳×: <span className="font-bold text-brand-cyan">{selectedDept}</span></p>
          
          <div className="space-y-4">
            <button onClick={() => { setSelectedRoleType('coordinator'); setView('register_form'); }}
              className="w-full bg-white p-6 rounded-2xl shadow-sm border border-transparent hover:border-brand-cyan text-right group relative overflow-hidden transition-all">
              <div className="flex items-center justify-between relative z-10">
                  <div>
                    <h3 className="font-bold text-lg text-gray-900 group-hover:text-brand-cyan">׳¨׳›׳–/׳× ׳¡׳ ׳™׳£</h3>
                    <p className="text-sm text-gray-400 mt-1">׳ ׳™׳”׳•׳ ׳₪׳¢׳™׳׳•׳× ׳¡׳ ׳™׳₪׳™׳× ׳•׳”׳’׳©׳× ׳˜׳™׳•׳׳™׳</p>
                  </div>
                  <Users className="text-gray-200 group-hover:text-brand-cyan transition-colors" size={32} />
              </div>
            </button>

            <button onClick={() => { setSelectedRoleType('dept_staff'); setView('register_form'); }}
              className="w-full bg-white p-6 rounded-2xl shadow-sm border border-transparent hover:border-brand-pink text-right group relative overflow-hidden transition-all">
              <div className="flex items-center justify-between relative z-10">
                  <div>
                    <h3 className="font-bold text-lg text-gray-900 group-hover:text-brand-pink">׳¦׳•׳•׳× ׳׳˜׳”</h3>
                    <p className="text-sm text-gray-400 mt-1">׳׳˜׳” {selectedDept} (׳׳׳ ׳”׳¨׳©׳׳•׳× ׳‘׳˜׳™׳—׳•׳×)</p>
                  </div>
                  <Briefcase className="text-gray-200 group-hover:text-brand-pink transition-colors" size={32} />
              </div>
            </button>
          </div>
        </main>
      </div>
    );
  }

  // --- View: Register Form ---
  if (view === 'register_form') {
    const isSafety = selectedRoleType === 'safety_admin';

    return (
      <div className="min-h-screen bg-bg-light p-6 flex flex-col items-center">
        <header className="w-full max-w-md flex justify-between items-center mb-6 mt-4">
            <button onClick={() => isSafety ? setView('dept_selection') : setView('role_selection')} className="text-gray-400 hover:text-brand-cyan"><ArrowLeft className="rotate-180"/></button>
            <div className="text-xs font-bold text-gray-300">׳©׳׳‘ 3 ׳׳×׳•׳ 3</div>
        </header>

        <main className="w-full max-w-md bg-white p-8 rounded-3xl shadow-sm border border-gray-100 animate-fadeIn">
            
            <h2 className="text-2xl font-black text-brand-dark mb-2">׳™׳¦׳™׳¨׳× ׳—׳©׳‘׳•׳</h2>
            <div className="flex items-center gap-2 mb-6">
                <span className={`h-2 w-2 rounded-full ${isSafety ? 'bg-brand-green' : 'bg-brand-cyan'}`}></span>
                <p className="text-sm text-gray-500 font-bold">
                    {isSafety ? '׳׳—׳׳§׳× ׳‘׳˜׳™׳—׳•׳× ׳•׳׳₪׳¢׳׳™׳' : `${selectedDept} - ${selectedRoleType === 'coordinator' ? '׳¨׳›׳– ׳¡׳ ׳™׳£' : '׳¦׳•׳•׳× ׳׳˜׳”'}`}
                </p>
            </div>

            <form onSubmit={handleRegister} className="space-y-4">
              
              {selectedRoleType === 'coordinator' && (
                <Input label="׳©׳ ׳”׳¡׳ ׳™׳£" name="branch" required onChange={handleInputChange} />
              )}

              <div className="grid grid-cols-2 gap-4">
                <Input label="׳©׳ ׳׳׳" name="fullName" required onChange={handleInputChange} />
                <Input label="׳˜׳׳₪׳•׳ ׳ ׳™׳™׳“" name="phone" type="tel" required onChange={handleInputChange} />
              </div>

              <Input label="׳×׳¢׳•׳“׳× ׳–׳”׳•׳×" name="idNumber" required maxLength={9} onChange={handleInputChange} />

              <div className="grid grid-cols-2 gap-4">
                 <Input label="׳׳™׳׳™׳™׳" name="email" type="email" required onChange={handleInputChange} />
                 <Input label="׳×׳׳¨׳™׳ ׳׳™׳“׳”" name="birthDate" type="date" required onChange={handleInputChange} />
              </div>

              <Input label="׳¡׳™׳¡׳׳”" name="password" type="password" required minLength={6} placeholder="׳׳₪׳—׳•׳× 6 ׳×׳•׳•׳™׳" onChange={handleInputChange} />

              {errorMsg && <p className="text-red-600 text-sm bg-red-50 p-2 rounded-lg font-bold border border-red-100 text-center">{errorMsg}</p>}
              {successMsg && <div className="text-green-700 text-sm bg-green-50 p-4 rounded-lg font-bold border border-green-200 text-center">{successMsg}</div>}

              <Button type="submit" isLoading={loading} variant={isSafety ? 'dark' : 'primary'} className="w-full mt-6">
                ׳¡׳™׳•׳ ׳”׳¨׳©׳׳”
              </Button>
            </form>
        </main>
      </div>
    );
  }

  return null;
}

==========================================
FILE: Header.tsx
PATH: C:\Users\User\chabad-trips\components\layout\Header.tsx
==========================================
"use client";

import React, { useEffect, useState } from 'react';
import { supabase } from '@/lib/supabaseClient';
import { Bell } from 'lucide-react';

// ׳©׳™׳‘ ׳׳‘: ׳׳ ׳• ׳׳©׳×׳׳©׳™׳ ׳‘-export const (׳•׳׳ default) ׳›׳“׳™ ׳©׳”׳™׳™׳‘׳•׳ ׳‘׳©׳׳¨ ׳”׳“׳₪׳™׳ ׳™׳¢׳‘׳•׳“ ׳—׳׳§
export const Header = ({ title }: { title: string }) => {
  const [user, setUser] = useState<any>(null);
  const [avatarUrl, setAvatarUrl] = useState<string | null>(null);

  useEffect(() => {
    // 1. ׳˜׳¢׳™׳ ׳” ׳¨׳׳©׳•׳ ׳™׳×
    const getUser = async () => {
      const { data } = await supabase.auth.getUser();
      if (data.user) {
        setUser(data.user);
        setAvatarUrl(data.user.user_metadata?.avatar_url || null);
      }
    };
    getUser();
    
    // 2. ׳”׳׳–׳ ׳” ׳׳©׳™׳ ׳•׳™׳™׳ (׳›׳“׳™ ׳©׳׳ ׳×׳¢׳׳” ׳×׳׳•׳ ׳”, ׳–׳” ׳™׳×׳¢׳“׳›׳ ׳›׳׳ ׳׳™׳“)
    const { data: authListener } = supabase.auth.onAuthStateChange((event, session) => {
      if (session?.user) {
        setUser(session.user);
        setAvatarUrl(session.user.user_metadata?.avatar_url || null);
      }
    });

    return () => {
      authListener.subscription.unsubscribe();
    };
  }, []);

  return (
    <header className="h-24 sticky top-0 z-40 px-8 flex items-center justify-between transition-all bg-[#F8F9FA]/90 backdrop-blur-md border-b border-gray-200">
      
      {/* ׳¦׳“ ׳™׳׳™׳: ׳›׳•׳×׳¨׳× */}
      <div>
        <h1 className="text-3xl font-bold text-gray-800 tracking-tight">{title}</h1>
      </div>
      
      {/* ׳¦׳“ ׳©׳׳׳: ׳׳–׳•׳¨ ׳׳™׳©׳™ */}
      <div className="flex items-center h-full">
        
        {/* ׳₪׳¢׳׳•׳ ׳”׳×׳¨׳׳•׳× */}
        <button className="text-gray-400 hover:text-[#00BCD4] transition-colors relative p-3 bg-white rounded-2xl shadow-sm border border-gray-100 hover:border-[#00BCD4] group">
            <Bell size={22} className="group-hover:rotate-12 transition-transform" />
            <span className="absolute top-2 right-2 w-2.5 h-2.5 bg-[#E91E63] rounded-full border-2 border-white"></span>
        </button>

        {/* ׳§׳• ׳”׳₪׳¨׳“׳” */}
        <div className="h-10 w-px bg-gray-300 mx-6 opacity-50"></div>

        {/* ׳₪׳¨׳•׳₪׳™׳ ׳׳©׳×׳׳© */}
        <div className="flex items-center gap-4">
            <div className="text-left hidden md:block">
                <div className="text-lg font-bold text-gray-800 leading-none mb-1">
                    {user?.user_metadata?.full_name} 
                </div>
                <div className="text-sm text-gray-500 font-medium">
                    {user?.user_metadata?.department} ג€¢ {user?.user_metadata?.branch || '׳׳˜׳”'}
                </div>
            </div>
            
            {/* ׳×׳׳•׳ ׳× ׳₪׳¨׳•׳₪׳™׳ */}
            <div className="w-14 h-14 rounded-2xl bg-gradient-to-tr from-[#00BCD4] to-cyan-400 flex items-center justify-center text-white font-bold text-2xl shadow-lg shadow-cyan-100 border-[3px] border-white ring-1 ring-gray-100 shrink-0 overflow-hidden relative">
              {avatarUrl ? (
                <img src={avatarUrl} alt="Profile" className="w-full h-full object-cover" />
              ) : (
                user?.user_metadata?.full_name?.[0]
              )}
            </div>
        </div>
      </div>
    </header>
  );
};

==========================================
FILE: ManagerHeader.tsx
PATH: C:\Users\User\chabad-trips\components\layout\ManagerHeader.tsx
==========================================
"use client";

import React, { useEffect, useState } from 'react';
import { supabase } from '@/lib/supabaseClient';
import { Bell, UserPlus } from 'lucide-react';
import Link from 'next/link';

export const ManagerHeader = ({ title }: { title: string }) => {
  const [user, setUser] = useState<any>(null);
  const [counts, setCounts] = useState({ newUsers: 0, newMessages: 0 });

  useEffect(() => {
    const fetchData = async () => {
      // 1. ׳”׳‘׳׳× ׳₪׳¨׳˜׳™ ׳”׳׳ ׳”׳ ׳”׳ ׳•׳›׳—׳™
      const { data: userData } = await supabase.auth.getUser();
      setUser(userData.user);

      // 2. ׳¡׳₪׳™׳¨׳× ׳׳©׳×׳׳©׳™׳ ׳—׳“׳©׳™׳ ׳”׳׳׳×׳™׳ ׳™׳ ׳׳׳™׳©׳•׳¨
      // ׳׳ ׳—׳ ׳• ׳׳•׳©׳›׳™׳ ׳׳× ׳›׳ ׳”׳׳©׳×׳׳©׳™׳ ׳׳”-VIEW ׳•׳‘׳•׳“׳§׳™׳ ׳׳׳™ ׳׳™׳ ׳¡׳˜׳˜׳•׳¡ ׳׳• ׳©׳”׳¡׳˜׳˜׳•׳¡ ׳”׳•׳ pending
      const { data: usersData } = await supabase.from('users_management_view').select('raw_user_meta_data');
      
      const pendingUsersCount = usersData?.filter((u: any) => {
          const status = u.raw_user_meta_data?.status;
          return !status || status === 'pending';
      }).length || 0;

      // 3. ׳¡׳₪׳™׳¨׳× ׳”׳•׳“׳¢׳•׳× ׳©׳׳ ׳˜׳•׳₪׳׳•
      const { count: pendingMessagesCount } = await supabase
        .from('contact_messages')
        .select('*', { count: 'exact', head: true })
        .neq('status', 'treated'); // ׳›׳ ׳׳” ׳©׳׳ "׳˜׳•׳₪׳"

      setCounts({
          newUsers: pendingUsersCount,
          newMessages: pendingMessagesCount || 0
      });
    };

    fetchData();
  }, []);

  return (
    <header className="h-24 sticky top-0 z-40 px-8 flex items-center justify-between transition-all bg-white/90 backdrop-blur-md border-b border-gray-200">
      
      {/* ׳¦׳“ ׳™׳׳™׳: ׳›׳•׳×׳¨׳× */}
      <div>
        <h1 className="text-2xl font-black text-gray-800 tracking-tight">{title}</h1>
      </div>
      
      {/* ׳¦׳“ ׳©׳׳׳: ׳›׳׳™׳ */}
      <div className="flex items-center h-full gap-4">
        
        {/* ׳₪׳¢׳׳•׳ 1: ׳׳™׳©׳•׳¨ ׳׳©׳×׳׳©׳™׳ ׳—׳“׳©׳™׳ */}
        <Link href="/manager/users">
            <button className="text-gray-400 hover:text-[#00BCD4] transition-colors relative p-2.5 bg-white rounded-xl border border-gray-100 shadow-sm group">
                <UserPlus size={20} className="group-hover:scale-110 transition-transform"/>
                
                {/* ׳ ׳§׳•׳“׳” ׳›׳×׳•׳׳” ׳¨׳§ ׳׳ ׳™׳© ׳׳©׳×׳׳©׳™׳ ׳—׳“׳©׳™׳ */}
                {counts.newUsers > 0 && (
                    <span className="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-orange-500 text-[10px] text-white font-bold border border-white">
                        {counts.newUsers}
                    </span>
                )}
            </button>
        </Link>

        {/* ׳₪׳¢׳׳•׳ 2: ׳”׳×׳¨׳׳•׳× / ׳”׳•׳“׳¢׳•׳× */}
        <Link href="/manager/inbox">
            <button className="text-gray-400 hover:text-[#00BCD4] transition-colors relative p-2.5 bg-white rounded-xl border border-gray-100 shadow-sm group">
                <Bell size={20} className="group-hover:rotate-12 transition-transform" />
                
                {/* ׳ ׳§׳•׳“׳” ׳׳“׳•׳׳” ׳¨׳§ ׳׳ ׳™׳© ׳”׳•׳“׳¢׳•׳× ׳—׳“׳©׳•׳× */}
                {counts.newMessages > 0 && (
                    <span className="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] text-white font-bold border border-white">
                        {counts.newMessages}
                    </span>
                )}
            </button>
        </Link>

        <div className="h-8 w-px bg-gray-200 mx-2"></div>

        {/* ׳₪׳¨׳•׳₪׳™׳ ׳׳ ׳”׳ */}
        <Link href="/manager/profile">
            <div className="flex items-center gap-3 cursor-pointer group">
                <div className="text-left hidden md:block">
                    <div className="text-sm font-bold text-gray-800 leading-none mb-1 group-hover:text-[#00BCD4] transition-colors">
                        {user?.user_metadata?.full_name || '׳׳ ׳”׳ ׳׳¢׳¨׳›׳×'}
                    </div>
                    <div className="text-xs text-gray-500 font-medium">
                        ׳׳˜׳” ׳׳¨׳¦׳™
                    </div>
                </div>
                
                <div className="w-10 h-10 rounded-xl bg-[#1E293B] flex items-center justify-center text-white font-bold text-lg shadow-md border-2 border-white ring-1 ring-gray-100 group-hover:scale-105 transition-transform">
                {user?.user_metadata?.full_name?.[0] || 'M'}
                </div>
            </div>
        </Link>
      </div>
    </header>
  );
};

==========================================
FILE: ManagerSidebar.tsx
PATH: C:\Users\User\chabad-trips\components\layout\ManagerSidebar.tsx
==========================================
"use client"

import React, { useEffect, useState } from 'react'
import Link from 'next/link'
import Image from 'next/image'
import { usePathname } from 'next/navigation'
import { supabase } from '@/lib/supabaseClient'
import { 
  LayoutDashboard, CheckSquare, Users, FileBarChart, Settings, LogOut, Mail, UserCircle
} from 'lucide-react'

export const ManagerSidebar = () => {
  const pathname = usePathname();
  const [isSuperAdmin, setIsSuperAdmin] = useState(false);

  useEffect(() => {
    const checkRole = async () => {
        const { data: { user } } = await supabase.auth.getUser();
        
        // ---------------------------------------------------------
        // ׳—׳•׳‘׳” ׳׳©׳ ׳•׳× ׳›׳׳ ׳׳׳™׳׳™׳™׳ ׳©׳׳!
        const myEmail = 'avremihalperin@gmail.com'; 
        // ---------------------------------------------------------

        if (user?.email === myEmail) {
            setIsSuperAdmin(true);
        }
    };
    checkRole();
  }, []);

  // ׳¨׳©׳™׳׳× ׳”׳×׳₪׳¨׳™׳˜׳™׳ ׳”׳‘׳¡׳™׳¡׳™׳× (׳©׳›׳•׳׳ ׳¨׳•׳׳™׳)
  const baseItems = [
    { label: '׳׳•׳— ׳‘׳§׳¨׳” ׳¨׳׳©׳™', href: '/manager', icon: LayoutDashboard, exact: true },
    { label: '׳“׳•׳׳¨ ׳ ׳›׳ ׳¡ ׳•׳”׳•׳“׳¢׳•׳×', href: '/manager/inbox', icon: Mail },
    { label: '׳׳™׳©׳•׳¨ ׳˜׳™׳•׳׳™׳', href: '/manager/approvals', icon: CheckSquare },
    { label: '׳ ׳™׳”׳•׳ ׳׳©׳×׳׳©׳™׳', href: '/manager/users', icon: Users },
    { label: '׳“׳•׳—׳•׳× ׳•׳ ׳×׳•׳ ׳™׳', href: '/manager/reports', icon: FileBarChart },
    { label: '׳₪׳¨׳•׳₪׳™׳ ׳׳™׳©׳™', href: '/manager/profile', icon: UserCircle },
  ];

  // ׳”׳•׳¡׳₪׳× "׳”׳’׳“׳¨׳•׳×" ׳¨׳§ ׳׳ ׳׳×׳” ׳”׳׳ ׳”׳ ׳”׳¨׳׳©׳™
  const menuItems = isSuperAdmin 
    ? [...baseItems, { label: '׳”׳’׳“׳¨׳•׳× ׳׳¢׳¨׳›׳×', href: '/manager/settings', icon: Settings }]
    : baseItems;

  const handleLogout = async () => {
    await supabase.auth.signOut();
    window.location.href = '/';
  };

  return (
    <aside className="w-64 bg-[#1E293B] text-white h-screen fixed right-0 top-0 z-50 flex flex-col shadow-xl border-l border-gray-700">
      
      {/* ׳׳•׳’׳• ׳›׳”׳” ׳׳׳ ׳”׳׳™׳ */}
      <div className="h-32 flex flex-col items-center justify-center border-b border-gray-700 p-6 bg-[#0F172A]">
          <div className="relative w-full h-16 flex items-center justify-center mb-2">
             <Image 
               src="/logo.png" 
               alt="Logo" 
               width={120} 
               height={60} 
               className="object-contain"
             />
          </div>
          <div className="text-[10px] text-gray-400 font-bold bg-gray-800 px-3 py-1 rounded-full uppercase tracking-wider">
              ׳׳׳©׳§ ׳ ׳™׳”׳•׳ ׳‘׳˜׳™׳—׳•׳×
          </div>
      </div>

      <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
        {menuItems.map((item) => {
          const isActive = item.exact 
            ? pathname === item.href
            : pathname?.startsWith(item.href);
          const Icon = item.icon;

          return (
            <Link 
              key={item.href} 
              href={item.href}
              className={`flex items-center gap-3 px-4 py-3.5 rounded-xl transition-all duration-200 font-bold text-sm
                ${isActive 
                  ? 'bg-[#00BCD4] text-white shadow-lg shadow-cyan-900/20' 
                  : 'text-gray-400 hover:bg-gray-800 hover:text-white'
                }`}
            >
              <Icon size={20} strokeWidth={isActive ? 2.5 : 2} />
              {item.label}
            </Link>
          )
        })}
      </nav>

      <div className="p-4 border-t border-gray-700 bg-[#0F172A]">
        <button onClick={handleLogout} className="flex items-center gap-3 px-4 py-3.5 rounded-xl w-full text-red-400 hover:bg-red-900/20 transition-all font-bold text-sm">
          <LogOut size={20} />
          ׳™׳¦׳™׳׳” ׳׳׳•׳‘׳˜׳—׳×
        </button>
      </div>
    </aside>
  )
}

==========================================
FILE: Sidebar.tsx
PATH: C:\Users\User\chabad-trips\components\layout\Sidebar.tsx
==========================================
"use client"

import React from 'react'
import Link from 'next/link'
import Image from 'next/image'
import { usePathname } from 'next/navigation'
import { supabase } from '@/lib/supabaseClient'
import { 
  Home, PlusCircle, FileText, User, MessageSquare, LogOut, Bell
} from 'lucide-react'

export const Sidebar = () => {
  const pathname = usePathname();

  const menuItems = [
    { label: '׳¨׳׳©׳™', href: '/dashboard', icon: Home, exact: true },
    { label: '׳”׳•׳“׳¢׳•׳× ׳•׳¢׳“׳›׳•׳ ׳™׳', href: '/dashboard/inbox', icon: Bell }, // ׳”׳—׳“׳©!
    { label: '׳˜׳™׳•׳ ׳—׳“׳©', href: '/dashboard/new-trip', icon: PlusCircle },
    { label: '׳”׳˜׳™׳•׳׳™׳ ׳©׳׳™', href: '/dashboard/my-trips', icon: FileText },
    { label: '׳₪׳¨׳•׳₪׳™׳ ׳׳™׳©׳™', href: '/dashboard/profile', icon: User },
    { label: '׳¢׳–׳¨׳” ׳•׳×׳׳™׳›׳”', href: '/dashboard/contact', icon: MessageSquare } // ׳”׳©׳ ׳¢׳•׳“׳›׳
  ];

  const handleLogout = async () => {
    await supabase.auth.signOut();
    window.location.href = '/';
  };

  return (
    <aside className="w-64 bg-white border-l border-gray-200 h-screen fixed right-0 top-0 z-50 flex flex-col shadow-sm">
      
      <div className="h-32 flex items-center justify-center border-b border-gray-100 p-6">
          <div className="relative w-full h-full flex items-center justify-center">
             <Image 
               src="/logo.png" 
               alt="׳ ׳•׳¢׳¨ ׳—׳‘׳´׳“" 
               width={160} 
               height={80} 
               className="object-contain max-h-20"
               priority
             />
          </div>
      </div>

      <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
        {menuItems.map((item) => {
          const isActive = item.exact 
            ? pathname === item.href
            : pathname?.startsWith(item.href);
          const Icon = item.icon;

          return (
            <Link 
              key={item.href} 
              href={item.href}
              className={`flex items-center gap-3 px-4 py-3.5 rounded-2xl transition-all duration-200 font-bold text-sm
                ${isActive 
                  ? 'bg-cyan-50 text-[#00BCD4] shadow-sm' 
                  : 'text-gray-500 hover:bg-gray-50 hover:text-gray-900'
                }`}
            >
              <Icon size={20} strokeWidth={isActive ? 2.5 : 2} />
              {item.label}
            </Link>
          )
        })}
      </nav>

      <div className="p-4 border-t border-gray-100">
        <button onClick={handleLogout} className="flex items-center gap-3 px-4 py-3.5 rounded-2xl w-full text-red-500 hover:bg-red-50 transition-all font-bold text-sm">
          <LogOut size={20} />
          ׳”׳×׳ ׳×׳§
        </button>
      </div>
    </aside>
  )
}

==========================================
FILE: Button.tsx
PATH: C:\Users\User\chabad-trips\components\ui\Button.tsx
==========================================
import React from 'react';
import { Loader2 } from 'lucide-react';

interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'danger' | 'outline' | 'ghost' | 'dark';
  isLoading?: boolean;
  icon?: React.ReactNode;
}

export const Button = ({ 
  children, 
  variant = 'primary', 
  isLoading, 
  icon, 
  className = '', 
  disabled,
  ...props 
}: ButtonProps) => {
  
  // Base: ׳’׳•׳‘׳” 60px (׳׳• padding ׳×׳•׳׳), ׳₪׳™׳ ׳•׳× ׳¢׳’׳•׳׳•׳× ׳׳׳•׳“, ׳₪׳•׳ ׳˜ ׳׳•׳“׳’׳©
  const baseStyles = "relative flex items-center justify-center gap-2 font-bold rounded-2xl transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed h-[60px]";
  
  const variants = {
    primary: "bg-brand-cyan hover:bg-[#00ACC1] text-white shadow-lg shadow-cyan-100 text-lg",
    secondary: "bg-brand-green hover:bg-[#7CB342] text-white shadow-lg shadow-green-100 text-lg",
    danger: "bg-brand-pink hover:bg-[#D81B60] text-white shadow-lg shadow-pink-100",
    dark: "bg-brand-dark hover:bg-black text-white shadow-lg",
    outline: "bg-white border-2 border-brand-pink text-brand-pink hover:bg-pink-50",
    ghost: "bg-transparent hover:bg-gray-100 text-gray-500 h-auto py-2" // Ghost ׳׳ ׳—׳™׳™׳‘ ׳׳”׳™׳•׳× ׳¢׳ ׳§
  };

  return (
    <button 
      className={`${baseStyles} ${variants[variant]} ${className}`}
      disabled={disabled || isLoading}
      {...props}
    >
      {isLoading ? <Loader2 className="w-6 h-6 animate-spin" /> : (
        <>
          {children}
          {icon && <span className="shrink-0">{icon}</span>}
        </>
      )}
    </button>
  );
};

==========================================
FILE: Input.tsx
PATH: C:\Users\User\chabad-trips\components\ui\Input.tsx
==========================================
import React from 'react';

interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  label?: string;
  error?: string;
  icon?: React.ReactNode; // ׳”׳•׳¡׳₪׳ ׳• ׳׳× ׳–׳” ׳›׳“׳™ ׳׳׳ ׳•׳¢ ׳׳× ׳”׳©׳’׳™׳׳”
}

export const Input = ({ label, error, icon, className = '', ...props }: InputProps) => {
  return (
    <div className="w-full">
      {label && <label className="block text-xs font-bold text-gray-500 mb-1.5 mr-1">{label}</label>}
      
      <div className="relative">
        {/* ׳׳ ׳”׳•׳¢׳‘׳¨ ׳׳™׳™׳§׳•׳, ׳ ׳¦׳™׳’ ׳׳•׳×׳• */}
        {icon && (
            <div className="absolute top-1/2 right-4 -translate-y-1/2 text-gray-400 pointer-events-none">
                {icon}
            </div>
        )}
        
        <input 
          className={`w-full h-[60px] rounded-xl border outline-none font-bold text-sm transition-all
          ${icon ? 'pr-12 pl-4' : 'px-4'} /* ׳¨׳™׳•׳•׳— ׳׳•׳˜׳•׳׳˜׳™ ׳׳׳™׳™׳§׳•׳ */
          ${error 
            ? 'border-red-200 bg-red-50 text-red-600 placeholder-red-300' 
            : 'bg-white border-gray-200 focus:border-[#E91E63] focus:ring-1 focus:ring-[#E91E63] text-[#263238]'
          } ${className}`}
          {...props}
        />
      </div>
      
      {error && <p className="text-xs text-red-500 font-bold mt-1 mr-1">{error}</p>}
    </div>
  );
};

==========================================
FILE: supabaseClient.ts
PATH: C:\Users\User\chabad-trips\lib\supabaseClient.ts
==========================================
import { createClient } from '@supabase/supabase-js';

// 1. ׳§׳¨׳™׳׳” ׳׳׳©׳×׳ ׳™ ׳”׳¡׳‘׳™׳‘׳” (׳”׳¡׳™׳׳ ! ׳׳•׳׳¨ ׳׳˜׳™׳™׳₪׳¡׳§׳¨׳™׳₪׳˜: "׳¡׳׳•׳ ׳¢׳׳™, ׳–׳” ׳§׳™׳™׳")
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

// 2. ׳‘׳“׳™׳§׳× ׳‘׳˜׳™׳—׳•׳× - ׳׳ ׳׳™׳ ׳׳₪׳×׳—׳•׳×, ׳ ׳¢׳¦׳•׳¨ ׳׳× ׳”׳׳₪׳׳™׳§׳¦׳™׳” ׳¢׳ ׳©׳’׳™׳׳” ׳‘׳¨׳•׳¨׳”
if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase Environment Variables! Check your .env.local file.');
}

// 3. ׳™׳¦׳™׳¨׳× ׳”׳§׳׳™׳™׳ ׳˜ ׳”׳׳¨׳›׳–׳™
export const supabase = createClient(supabaseUrl, supabaseAnonKey);

// 4. ׳₪׳•׳ ׳§׳¦׳™׳™׳× ׳”׳¢׳–׳¨ (׳©׳™׳׳¨׳ ׳• ׳׳•׳×׳” ׳׳”׳§׳•׳‘׳¥ ׳”׳§׳•׳“׳)
// ׳׳׳™׳¨׳” ׳×׳¢׳•׳“׳× ׳–׳”׳•׳× ׳׳›׳×׳•׳‘׳× ׳׳™׳׳™׳™׳ ׳₪׳™׳§׳˜׳™׳‘׳™׳× ׳׳¦׳•׳¨׳ ׳”׳×׳—׳‘׳¨׳•׳× ׳”׳׳¢׳¨׳›׳×
export const getIdAsEmail = (idNumber: string) => {
  return `${idNumber}@noar.chabad.co.il`;
};

